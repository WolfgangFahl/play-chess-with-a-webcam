
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>play-chess-with-a-webcam API Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#play-chess-with-a-webcam-api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="play-chess-with-a-webcam API Documentation" class="md-header__button md-logo" aria-label="play-chess-with-a-webcam API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            play-chess-with-a-webcam API Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="play-chess-with-a-webcam API Documentation" class="md-nav__button md-logo" aria-label="play-chess-with-a-webcam API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    play-chess-with-a-webcam API Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pcwawc" class="md-nav__link">
    <span class="md-ellipsis">
      pcwawc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
    <nav class="md-nav" aria-label="args">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.args.Args" class="md-nav__link">
    <span class="md-ellipsis">
      Args
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.board" class="md-nav__link">
    <span class="md-ellipsis">
      board
    </span>
  </a>
  
    <nav class="md-nav" aria-label="board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.board.Board" class="md-nav__link">
    <span class="md-ellipsis">
      Board
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.board.Board.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.boarddetector" class="md-nav__link">
    <span class="md-ellipsis">
      boarddetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boarddetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boarddetector.BoardDetector" class="md-nav__link">
    <span class="md-ellipsis">
      BoardDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BoardDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boarddetector.BoardDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.boardfinder" class="md-nav__link">
    <span class="md-ellipsis">
      boardfinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boardfinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder" class="md-nav__link">
    <span class="md-ellipsis">
      BoardFinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BoardFinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.expand" class="md-nav__link">
    <span class="md-ellipsis">
      expand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.fieldColor" class="md-nav__link">
    <span class="md-ellipsis">
      fieldColor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findChessBoard" class="md-nav__link">
    <span class="md-ellipsis">
      findChessBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findCorners" class="md-nav__link">
    <span class="md-ellipsis">
      findCorners
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findOuterCorners" class="md-nav__link">
    <span class="md-ellipsis">
      findOuterCorners
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.getColorFiltered" class="md-nav__link">
    <span class="md-ellipsis">
      getColorFiltered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.getHistograms" class="md-nav__link">
    <span class="md-ellipsis">
      getHistograms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.maskCornerPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      maskCornerPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.maskPolygon" class="md-nav__link">
    <span class="md-ellipsis">
      maskPolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.showHistogramDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showHistogramDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.showPolygonDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showPolygonDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.sortPoints" class="md-nav__link">
    <span class="md-ellipsis">
      sortPoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners" class="md-nav__link">
    <span class="md-ellipsis">
      Corners
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corners">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.debugSorting" class="md-nav__link">
    <span class="md-ellipsis">
      debugSorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.asPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      asPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.calcPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      calcPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.calcTrapez" class="md-nav__link">
    <span class="md-ellipsis">
      calcTrapez
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.findPattern" class="md-nav__link">
    <span class="md-ellipsis">
      findPattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.genChessPatterns" class="md-nav__link">
    <span class="md-ellipsis">
      genChessPatterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.safeXY" class="md-nav__link">
    <span class="md-ellipsis">
      safeXY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.showDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.showTrapezDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showTrapezDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.sort" class="md-nav__link">
    <span class="md-ellipsis">
      sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.trapezColRows" class="md-nav__link">
    <span class="md-ellipsis">
      trapezColRows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessengine" class="md-nav__link">
    <span class="md-ellipsis">
      chessengine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessengine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine" class="md-nav__link">
    <span class="md-ellipsis">
      Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.findEngines" class="md-nav__link">
    <span class="md-ellipsis">
      findEngines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessimage" class="md-nav__link">
    <span class="md-ellipsis">
      chessimage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessimage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardImageSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessBoardImageSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet.placeHolder" class="md-nav__link">
    <span class="md-ellipsis">
      placeHolder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet.warpAndRotate" class="md-nav__link">
    <span class="md-ellipsis">
      warpAndRotate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardVision" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardVision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp" class="md-nav__link">
    <span class="md-ellipsis">
      Warp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.addPoint" class="md-nav__link">
    <span class="md-ellipsis">
      addPoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.updatePoints" class="md-nav__link">
    <span class="md-ellipsis">
      updatePoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      chesstrapezoid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chesstrapezoid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare" class="md-nav__link">
    <span class="md-ellipsis">
      ChessTSquare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessTSquare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.checkMoved" class="md-nav__link">
    <span class="md-ellipsis">
      checkMoved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.drawDebug" class="md-nav__link">
    <span class="md-ellipsis">
      drawDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.drawState" class="md-nav__link">
    <span class="md-ellipsis">
      drawState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.getSquareImage" class="md-nav__link">
    <span class="md-ellipsis">
      getSquareImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.setPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      setPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.squareChange" class="md-nav__link">
    <span class="md-ellipsis">
      squareChange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      ChessTrapezoid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessTrapezoid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.analyzeColors" class="md-nav__link">
    <span class="md-ellipsis">
      analyzeColors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.checkColors" class="md-nav__link">
    <span class="md-ellipsis">
      checkColors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.detectChanges" class="md-nav__link">
    <span class="md-ellipsis">
      detectChanges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawCircle" class="md-nav__link">
    <span class="md-ellipsis">
      drawCircle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawDebug" class="md-nav__link">
    <span class="md-ellipsis">
      drawDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawFieldStates" class="md-nav__link">
    <span class="md-ellipsis">
      drawFieldStates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawRCircle" class="md-nav__link">
    <span class="md-ellipsis">
      drawRCircle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.genSquares" class="md-nav__link">
    <span class="md-ellipsis">
      genSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.idealColoredBoard" class="md-nav__link">
    <span class="md-ellipsis">
      idealColoredBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.preMoveBoard" class="md-nav__link">
    <span class="md-ellipsis">
      preMoveBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.prepareImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      prepareImageSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.rotateIndices" class="md-nav__link">
    <span class="md-ellipsis">
      rotateIndices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.tSquareAt" class="md-nav__link">
    <span class="md-ellipsis">
      tSquareAt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.updatePieces" class="md-nav__link">
    <span class="md-ellipsis">
      updatePieces
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color" class="md-nav__link">
    <span class="md-ellipsis">
      Color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color.fixMeans" class="md-nav__link">
    <span class="md-ellipsis">
      fixMeans
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.FieldColorStats" class="md-nav__link">
    <span class="md-ellipsis">
      FieldColorStats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.SquareChange" class="md-nav__link">
    <span class="md-ellipsis">
      SquareChange
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SquareChange">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.SquareChange.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Transformation" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square" class="md-nav__link">
    <span class="md-ellipsis">
      Trapez2Square
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trapez2Square">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square.relativeToTrapezXY" class="md-nav__link">
    <span class="md-ellipsis">
      relativeToTrapezXY
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessvision" class="md-nav__link">
    <span class="md-ellipsis">
      chessvision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessvision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.FieldState" class="md-nav__link">
    <span class="md-ellipsis">
      FieldState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoard
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.divideInSquares" class="md-nav__link">
    <span class="md-ellipsis">
      divideInSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.genSquares" class="md-nav__link">
    <span class="md-ellipsis">
      genSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.updatePieces" class="md-nav__link">
    <span class="md-ellipsis">
      updatePieces
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImage.diffBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      diffBoardImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardImageSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardImageSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet.prepareGUI" class="md-nav__link">
    <span class="md-ellipsis">
      prepareGUI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet.warpAndRotate" class="md-nav__link">
    <span class="md-ellipsis">
      warpAndRotate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardVision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardVision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.debug" class="md-nav__link">
    <span class="md-ellipsis">
      debug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.readChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      readChessBoardImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IGame" class="md-nav__link">
    <span class="md-ellipsis">
      IGame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector" class="md-nav__link">
    <span class="md-ellipsis">
      IMoveDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMoveDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector.onChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      onChessBoardImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IPiece" class="md-nav__link">
    <span class="md-ellipsis">
      IPiece
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.ISquare" class="md-nav__link">
    <span class="md-ellipsis">
      ISquare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ISquare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.ISquare.getSquareImage" class="md-nav__link">
    <span class="md-ellipsis">
      getSquareImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp" class="md-nav__link">
    <span class="md-ellipsis">
      IWarp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IWarp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.addPoint" class="md-nav__link">
    <span class="md-ellipsis">
      addPoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.updatePoints" class="md-nav__link">
    <span class="md-ellipsis">
      updatePoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.config.Config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.detectorfactory" class="md-nav__link">
    <span class="md-ellipsis">
      detectorfactory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.detectstate" class="md-nav__link">
    <span class="md-ellipsis">
      detectstate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="detectstate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.ChangeState" class="md-nav__link">
    <span class="md-ellipsis">
      ChangeState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState" class="md-nav__link">
    <span class="md-ellipsis">
      DetectColorState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DetectColorState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState.inRange" class="md-nav__link">
    <span class="md-ellipsis">
      inRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState.squareState" class="md-nav__link">
    <span class="md-ellipsis">
      squareState
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState" class="md-nav__link">
    <span class="md-ellipsis">
      DetectState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DetectState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState.check" class="md-nav__link">
    <span class="md-ellipsis">
      check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment.inContinuousIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      inContinuousIntegration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.environment4test" class="md-nav__link">
    <span class="md-ellipsis">
      environment4test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment4test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test" class="md-nav__link">
    <span class="md-ellipsis">
      Environment4Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment4Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getImage" class="md-nav__link">
    <span class="md-ellipsis">
      getImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getImageWithVideo" class="md-nav__link">
    <span class="md-ellipsis">
      getImageWithVideo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getVideo" class="md-nav__link">
    <span class="md-ellipsis">
      getVideo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.prepareFromImageInfo" class="md-nav__link">
    <span class="md-ellipsis">
      prepareFromImageInfo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.ImageInfo" class="md-nav__link">
    <span class="md-ellipsis">
      ImageInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.ImageInfo.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.eventhandling" class="md-nav__link">
    <span class="md-ellipsis">
      eventhandling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="eventhandling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.eventhandling.Event" class="md-nav__link">
    <span class="md-ellipsis">
      Event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.eventhandling.Observable" class="md-nav__link">
    <span class="md-ellipsis">
      Observable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Field" class="md-nav__link">
    <span class="md-ellipsis">
      Field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Field.interPolate" class="md-nav__link">
    <span class="md-ellipsis">
      interPolate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.FieldROI" class="md-nav__link">
    <span class="md-ellipsis">
      FieldROI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldROI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.FieldROI.pixelList" class="md-nav__link">
    <span class="md-ellipsis">
      pixelList
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Grid" class="md-nav__link">
    <span class="md-ellipsis">
      Grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.SquareKind" class="md-nav__link">
    <span class="md-ellipsis">
      SquareKind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.fpscheck" class="md-nav__link">
    <span class="md-ellipsis">
      fpscheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fpscheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.fpscheck.FPSCheck" class="md-nav__link">
    <span class="md-ellipsis">
      FPSCheck
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.game" class="md-nav__link">
    <span class="md-ellipsis">
      game
    </span>
  </a>
  
    <nav class="md-nav" aria-label="game">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.game.Game" class="md-nav__link">
    <span class="md-ellipsis">
      Game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.game.WebCamGame" class="md-nav__link">
    <span class="md-ellipsis">
      WebCamGame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.histogram" class="md-nav__link">
    <span class="md-ellipsis">
      histogram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="histogram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Histogram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram.colorMask" class="md-nav__link">
    <span class="md-ellipsis">
      colorMask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Stats" class="md-nav__link">
    <span class="md-ellipsis">
      Stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Stats.range" class="md-nav__link">
    <span class="md-ellipsis">
      range
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.jsonablemixin" class="md-nav__link">
    <span class="md-ellipsis">
      jsonablemixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="jsonablemixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.jsonablemixin.JsonAbleMixin" class="md-nav__link">
    <span class="md-ellipsis">
      JsonAbleMixin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge" class="md-nav__link">
    <span class="md-ellipsis">
      lichessbridge
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lichessbridge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Account" class="md-nav__link">
    <span class="md-ellipsis">
      Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Game" class="md-nav__link">
    <span class="md-ellipsis">
      Game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Lichess" class="md-nav__link">
    <span class="md-ellipsis">
      Lichess
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lichess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Lichess.waitForChallenge" class="md-nav__link">
    <span class="md-ellipsis">
      waitForChallenge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.State" class="md-nav__link">
    <span class="md-ellipsis">
      State
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.plotlib" class="md-nav__link">
    <span class="md-ellipsis">
      plotlib
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plotlib">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotLib" class="md-nav__link">
    <span class="md-ellipsis">
      PlotLib
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlotLib">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotLib.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotType" class="md-nav__link">
    <span class="md-ellipsis">
      PlotType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.runningstats" class="md-nav__link">
    <span class="md-ellipsis">
      runningstats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="runningstats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.ColorStats" class="md-nav__link">
    <span class="md-ellipsis">
      ColorStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ColorStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.ColorStats.distance" class="md-nav__link">
    <span class="md-ellipsis">
      distance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats" class="md-nav__link">
    <span class="md-ellipsis">
      IStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats.mean" class="md-nav__link">
    <span class="md-ellipsis">
      mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats.push" class="md-nav__link">
    <span class="md-ellipsis">
      push
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MinMaxStats" class="md-nav__link">
    <span class="md-ellipsis">
      MinMaxStats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MovingAverage" class="md-nav__link">
    <span class="md-ellipsis">
      MovingAverage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MovingAverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MovingAverage.push" class="md-nav__link">
    <span class="md-ellipsis">
      push
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.RunningStats" class="md-nav__link">
    <span class="md-ellipsis">
      RunningStats
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.simpledetector" class="md-nav__link">
    <span class="md-ellipsis">
      simpledetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="simpledetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.ImageChange" class="md-nav__link">
    <span class="md-ellipsis">
      ImageChange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.Simple8x8Detector" class="md-nav__link">
    <span class="md-ellipsis">
      Simple8x8Detector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.SimpleDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimpleDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.SimpleDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.video" class="md-nav__link">
    <span class="md-ellipsis">
      video
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video" class="md-nav__link">
    <span class="md-ellipsis">
      Video
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Video">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.createBlank" class="md-nav__link">
    <span class="md-ellipsis">
      createBlank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.drawPolygon" class="md-nav__link">
    <span class="md-ellipsis">
      drawPolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.drawTrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      drawTrapezoid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.getEmptyImage" class="md-nav__link">
    <span class="md-ellipsis">
      getEmptyImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.getEmptyImage4WidthAndHeight" class="md-nav__link">
    <span class="md-ellipsis">
      getEmptyImage4WidthAndHeight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.houghTransform" class="md-nav__link">
    <span class="md-ellipsis">
      houghTransform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.houghTransformP" class="md-nav__link">
    <span class="md-ellipsis">
      houghTransformP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.maskImage" class="md-nav__link">
    <span class="md-ellipsis">
      maskImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.showImage" class="md-nav__link">
    <span class="md-ellipsis">
      showImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.warp" class="md-nav__link">
    <span class="md-ellipsis">
      warp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.VideoStream" class="md-nav__link">
    <span class="md-ellipsis">
      VideoStream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.videoanalyze" class="md-nav__link">
    <span class="md-ellipsis">
      videoanalyze
    </span>
  </a>
  
    <nav class="md-nav" aria-label="videoanalyze">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.videoanalyze.VideoAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      VideoAnalyzer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.webapp" class="md-nav__link">
    <span class="md-ellipsis">
      webapp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="webapp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp" class="md-nav__link">
    <span class="md-ellipsis">
      WebApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp.getEvent" class="md-nav__link">
    <span class="md-ellipsis">
      getEvent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.webchesscam" class="md-nav__link">
    <span class="md-ellipsis">
      webchesscam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="webchesscam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webchesscam.WebChessCamArgs" class="md-nav__link">
    <span class="md-ellipsis">
      WebChessCamArgs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.webchesscam.chessUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      chessUpdate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.yamlablemixin" class="md-nav__link">
    <span class="md-ellipsis">
      yamlablemixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yamlablemixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.yamlablemixin.YamlAbleMixin" class="md-nav__link">
    <span class="md-ellipsis">
      YamlAbleMixin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pcwawc" class="md-nav__link">
    <span class="md-ellipsis">
      pcwawc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
    <nav class="md-nav" aria-label="args">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.args.Args" class="md-nav__link">
    <span class="md-ellipsis">
      Args
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.board" class="md-nav__link">
    <span class="md-ellipsis">
      board
    </span>
  </a>
  
    <nav class="md-nav" aria-label="board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.board.Board" class="md-nav__link">
    <span class="md-ellipsis">
      Board
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.board.Board.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.boarddetector" class="md-nav__link">
    <span class="md-ellipsis">
      boarddetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boarddetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boarddetector.BoardDetector" class="md-nav__link">
    <span class="md-ellipsis">
      BoardDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BoardDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boarddetector.BoardDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.boardfinder" class="md-nav__link">
    <span class="md-ellipsis">
      boardfinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boardfinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder" class="md-nav__link">
    <span class="md-ellipsis">
      BoardFinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BoardFinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.expand" class="md-nav__link">
    <span class="md-ellipsis">
      expand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.fieldColor" class="md-nav__link">
    <span class="md-ellipsis">
      fieldColor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findChessBoard" class="md-nav__link">
    <span class="md-ellipsis">
      findChessBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findCorners" class="md-nav__link">
    <span class="md-ellipsis">
      findCorners
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.findOuterCorners" class="md-nav__link">
    <span class="md-ellipsis">
      findOuterCorners
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.getColorFiltered" class="md-nav__link">
    <span class="md-ellipsis">
      getColorFiltered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.getHistograms" class="md-nav__link">
    <span class="md-ellipsis">
      getHistograms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.maskCornerPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      maskCornerPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.maskPolygon" class="md-nav__link">
    <span class="md-ellipsis">
      maskPolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.showHistogramDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showHistogramDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.showPolygonDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showPolygonDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.BoardFinder.sortPoints" class="md-nav__link">
    <span class="md-ellipsis">
      sortPoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners" class="md-nav__link">
    <span class="md-ellipsis">
      Corners
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corners">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.debugSorting" class="md-nav__link">
    <span class="md-ellipsis">
      debugSorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.asPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      asPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.calcPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      calcPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.calcTrapez" class="md-nav__link">
    <span class="md-ellipsis">
      calcTrapez
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.findPattern" class="md-nav__link">
    <span class="md-ellipsis">
      findPattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.genChessPatterns" class="md-nav__link">
    <span class="md-ellipsis">
      genChessPatterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.safeXY" class="md-nav__link">
    <span class="md-ellipsis">
      safeXY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.showDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.showTrapezDebug" class="md-nav__link">
    <span class="md-ellipsis">
      showTrapezDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.sort" class="md-nav__link">
    <span class="md-ellipsis">
      sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.boardfinder.Corners.trapezColRows" class="md-nav__link">
    <span class="md-ellipsis">
      trapezColRows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessengine" class="md-nav__link">
    <span class="md-ellipsis">
      chessengine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessengine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine" class="md-nav__link">
    <span class="md-ellipsis">
      Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.findEngines" class="md-nav__link">
    <span class="md-ellipsis">
      findEngines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessengine.Engine.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessimage" class="md-nav__link">
    <span class="md-ellipsis">
      chessimage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessimage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardImageSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessBoardImageSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet.placeHolder" class="md-nav__link">
    <span class="md-ellipsis">
      placeHolder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardImageSet.warpAndRotate" class="md-nav__link">
    <span class="md-ellipsis">
      warpAndRotate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.ChessBoardVision" class="md-nav__link">
    <span class="md-ellipsis">
      ChessBoardVision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp" class="md-nav__link">
    <span class="md-ellipsis">
      Warp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.addPoint" class="md-nav__link">
    <span class="md-ellipsis">
      addPoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessimage.Warp.updatePoints" class="md-nav__link">
    <span class="md-ellipsis">
      updatePoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      chesstrapezoid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chesstrapezoid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare" class="md-nav__link">
    <span class="md-ellipsis">
      ChessTSquare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessTSquare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.checkMoved" class="md-nav__link">
    <span class="md-ellipsis">
      checkMoved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.drawDebug" class="md-nav__link">
    <span class="md-ellipsis">
      drawDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.drawState" class="md-nav__link">
    <span class="md-ellipsis">
      drawState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.getSquareImage" class="md-nav__link">
    <span class="md-ellipsis">
      getSquareImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.setPolygons" class="md-nav__link">
    <span class="md-ellipsis">
      setPolygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTSquare.squareChange" class="md-nav__link">
    <span class="md-ellipsis">
      squareChange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      ChessTrapezoid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChessTrapezoid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.analyzeColors" class="md-nav__link">
    <span class="md-ellipsis">
      analyzeColors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.checkColors" class="md-nav__link">
    <span class="md-ellipsis">
      checkColors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.detectChanges" class="md-nav__link">
    <span class="md-ellipsis">
      detectChanges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawCircle" class="md-nav__link">
    <span class="md-ellipsis">
      drawCircle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawDebug" class="md-nav__link">
    <span class="md-ellipsis">
      drawDebug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawFieldStates" class="md-nav__link">
    <span class="md-ellipsis">
      drawFieldStates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.drawRCircle" class="md-nav__link">
    <span class="md-ellipsis">
      drawRCircle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.genSquares" class="md-nav__link">
    <span class="md-ellipsis">
      genSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.idealColoredBoard" class="md-nav__link">
    <span class="md-ellipsis">
      idealColoredBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.preMoveBoard" class="md-nav__link">
    <span class="md-ellipsis">
      preMoveBoard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.prepareImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      prepareImageSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.rotateIndices" class="md-nav__link">
    <span class="md-ellipsis">
      rotateIndices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.tSquareAt" class="md-nav__link">
    <span class="md-ellipsis">
      tSquareAt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.ChessTrapezoid.updatePieces" class="md-nav__link">
    <span class="md-ellipsis">
      updatePieces
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color" class="md-nav__link">
    <span class="md-ellipsis">
      Color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Color.fixMeans" class="md-nav__link">
    <span class="md-ellipsis">
      fixMeans
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.FieldColorStats" class="md-nav__link">
    <span class="md-ellipsis">
      FieldColorStats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.SquareChange" class="md-nav__link">
    <span class="md-ellipsis">
      SquareChange
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SquareChange">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.SquareChange.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Transformation" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square" class="md-nav__link">
    <span class="md-ellipsis">
      Trapez2Square
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trapez2Square">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chesstrapezoid.Trapez2Square.relativeToTrapezXY" class="md-nav__link">
    <span class="md-ellipsis">
      relativeToTrapezXY
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.chessvision" class="md-nav__link">
    <span class="md-ellipsis">
      chessvision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chessvision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.FieldState" class="md-nav__link">
    <span class="md-ellipsis">
      FieldState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoard
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.divideInSquares" class="md-nav__link">
    <span class="md-ellipsis">
      divideInSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.genSquares" class="md-nav__link">
    <span class="md-ellipsis">
      genSquares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoard.updatePieces" class="md-nav__link">
    <span class="md-ellipsis">
      updatePieces
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImage.diffBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      diffBoardImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardImageSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardImageSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet.prepareGUI" class="md-nav__link">
    <span class="md-ellipsis">
      prepareGUI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardImageSet.warpAndRotate" class="md-nav__link">
    <span class="md-ellipsis">
      warpAndRotate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision" class="md-nav__link">
    <span class="md-ellipsis">
      IChessBoardVision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IChessBoardVision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.debug" class="md-nav__link">
    <span class="md-ellipsis">
      debug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IChessBoardVision.readChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      readChessBoardImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IGame" class="md-nav__link">
    <span class="md-ellipsis">
      IGame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector" class="md-nav__link">
    <span class="md-ellipsis">
      IMoveDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMoveDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector.onChessBoardImage" class="md-nav__link">
    <span class="md-ellipsis">
      onChessBoardImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IMoveDetector.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IPiece" class="md-nav__link">
    <span class="md-ellipsis">
      IPiece
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.ISquare" class="md-nav__link">
    <span class="md-ellipsis">
      ISquare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ISquare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.ISquare.getSquareImage" class="md-nav__link">
    <span class="md-ellipsis">
      getSquareImage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp" class="md-nav__link">
    <span class="md-ellipsis">
      IWarp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IWarp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.addPoint" class="md-nav__link">
    <span class="md-ellipsis">
      addPoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.chessvision.IWarp.updatePoints" class="md-nav__link">
    <span class="md-ellipsis">
      updatePoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.config.Config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.detectorfactory" class="md-nav__link">
    <span class="md-ellipsis">
      detectorfactory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.detectstate" class="md-nav__link">
    <span class="md-ellipsis">
      detectstate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="detectstate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.ChangeState" class="md-nav__link">
    <span class="md-ellipsis">
      ChangeState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState" class="md-nav__link">
    <span class="md-ellipsis">
      DetectColorState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DetectColorState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState.inRange" class="md-nav__link">
    <span class="md-ellipsis">
      inRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectColorState.squareState" class="md-nav__link">
    <span class="md-ellipsis">
      squareState
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState" class="md-nav__link">
    <span class="md-ellipsis">
      DetectState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DetectState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.detectstate.DetectState.check" class="md-nav__link">
    <span class="md-ellipsis">
      check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment.Environment.inContinuousIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      inContinuousIntegration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.environment4test" class="md-nav__link">
    <span class="md-ellipsis">
      environment4test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment4test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test" class="md-nav__link">
    <span class="md-ellipsis">
      Environment4Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment4Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getImage" class="md-nav__link">
    <span class="md-ellipsis">
      getImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getImageWithVideo" class="md-nav__link">
    <span class="md-ellipsis">
      getImageWithVideo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.getVideo" class="md-nav__link">
    <span class="md-ellipsis">
      getVideo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.Environment4Test.prepareFromImageInfo" class="md-nav__link">
    <span class="md-ellipsis">
      prepareFromImageInfo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.ImageInfo" class="md-nav__link">
    <span class="md-ellipsis">
      ImageInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.environment4test.ImageInfo.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.eventhandling" class="md-nav__link">
    <span class="md-ellipsis">
      eventhandling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="eventhandling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.eventhandling.Event" class="md-nav__link">
    <span class="md-ellipsis">
      Event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.eventhandling.Observable" class="md-nav__link">
    <span class="md-ellipsis">
      Observable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Field" class="md-nav__link">
    <span class="md-ellipsis">
      Field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Field.interPolate" class="md-nav__link">
    <span class="md-ellipsis">
      interPolate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.FieldROI" class="md-nav__link">
    <span class="md-ellipsis">
      FieldROI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldROI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.FieldROI.pixelList" class="md-nav__link">
    <span class="md-ellipsis">
      pixelList
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.Grid" class="md-nav__link">
    <span class="md-ellipsis">
      Grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.field.SquareKind" class="md-nav__link">
    <span class="md-ellipsis">
      SquareKind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.fpscheck" class="md-nav__link">
    <span class="md-ellipsis">
      fpscheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fpscheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.fpscheck.FPSCheck" class="md-nav__link">
    <span class="md-ellipsis">
      FPSCheck
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.game" class="md-nav__link">
    <span class="md-ellipsis">
      game
    </span>
  </a>
  
    <nav class="md-nav" aria-label="game">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.game.Game" class="md-nav__link">
    <span class="md-ellipsis">
      Game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.game.WebCamGame" class="md-nav__link">
    <span class="md-ellipsis">
      WebCamGame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.histogram" class="md-nav__link">
    <span class="md-ellipsis">
      histogram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="histogram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Histogram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Histogram.colorMask" class="md-nav__link">
    <span class="md-ellipsis">
      colorMask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Stats" class="md-nav__link">
    <span class="md-ellipsis">
      Stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.histogram.Stats.range" class="md-nav__link">
    <span class="md-ellipsis">
      range
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.jsonablemixin" class="md-nav__link">
    <span class="md-ellipsis">
      jsonablemixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="jsonablemixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.jsonablemixin.JsonAbleMixin" class="md-nav__link">
    <span class="md-ellipsis">
      JsonAbleMixin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge" class="md-nav__link">
    <span class="md-ellipsis">
      lichessbridge
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lichessbridge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Account" class="md-nav__link">
    <span class="md-ellipsis">
      Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Game" class="md-nav__link">
    <span class="md-ellipsis">
      Game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Lichess" class="md-nav__link">
    <span class="md-ellipsis">
      Lichess
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lichess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.Lichess.waitForChallenge" class="md-nav__link">
    <span class="md-ellipsis">
      waitForChallenge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.lichessbridge.State" class="md-nav__link">
    <span class="md-ellipsis">
      State
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.plotlib" class="md-nav__link">
    <span class="md-ellipsis">
      plotlib
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plotlib">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotLib" class="md-nav__link">
    <span class="md-ellipsis">
      PlotLib
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlotLib">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotLib.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.plotlib.PlotType" class="md-nav__link">
    <span class="md-ellipsis">
      PlotType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.runningstats" class="md-nav__link">
    <span class="md-ellipsis">
      runningstats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="runningstats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.ColorStats" class="md-nav__link">
    <span class="md-ellipsis">
      ColorStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ColorStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.ColorStats.distance" class="md-nav__link">
    <span class="md-ellipsis">
      distance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats" class="md-nav__link">
    <span class="md-ellipsis">
      IStats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IStats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats.mean" class="md-nav__link">
    <span class="md-ellipsis">
      mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.IStats.push" class="md-nav__link">
    <span class="md-ellipsis">
      push
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MinMaxStats" class="md-nav__link">
    <span class="md-ellipsis">
      MinMaxStats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MovingAverage" class="md-nav__link">
    <span class="md-ellipsis">
      MovingAverage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MovingAverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.MovingAverage.push" class="md-nav__link">
    <span class="md-ellipsis">
      push
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.runningstats.RunningStats" class="md-nav__link">
    <span class="md-ellipsis">
      RunningStats
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.simpledetector" class="md-nav__link">
    <span class="md-ellipsis">
      simpledetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="simpledetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.ImageChange" class="md-nav__link">
    <span class="md-ellipsis">
      ImageChange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.Simple8x8Detector" class="md-nav__link">
    <span class="md-ellipsis">
      Simple8x8Detector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.SimpleDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimpleDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.simpledetector.SimpleDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.video" class="md-nav__link">
    <span class="md-ellipsis">
      video
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video" class="md-nav__link">
    <span class="md-ellipsis">
      Video
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Video">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.createBlank" class="md-nav__link">
    <span class="md-ellipsis">
      createBlank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.drawPolygon" class="md-nav__link">
    <span class="md-ellipsis">
      drawPolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.drawTrapezoid" class="md-nav__link">
    <span class="md-ellipsis">
      drawTrapezoid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.getEmptyImage" class="md-nav__link">
    <span class="md-ellipsis">
      getEmptyImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.getEmptyImage4WidthAndHeight" class="md-nav__link">
    <span class="md-ellipsis">
      getEmptyImage4WidthAndHeight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.houghTransform" class="md-nav__link">
    <span class="md-ellipsis">
      houghTransform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.houghTransformP" class="md-nav__link">
    <span class="md-ellipsis">
      houghTransformP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.maskImage" class="md-nav__link">
    <span class="md-ellipsis">
      maskImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.showImage" class="md-nav__link">
    <span class="md-ellipsis">
      showImage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.Video.warp" class="md-nav__link">
    <span class="md-ellipsis">
      warp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.video.VideoStream" class="md-nav__link">
    <span class="md-ellipsis">
      VideoStream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.videoanalyze" class="md-nav__link">
    <span class="md-ellipsis">
      videoanalyze
    </span>
  </a>
  
    <nav class="md-nav" aria-label="videoanalyze">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.videoanalyze.VideoAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      VideoAnalyzer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.webapp" class="md-nav__link">
    <span class="md-ellipsis">
      webapp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="webapp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp" class="md-nav__link">
    <span class="md-ellipsis">
      WebApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.webapp.WebApp.getEvent" class="md-nav__link">
    <span class="md-ellipsis">
      getEvent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.webchesscam" class="md-nav__link">
    <span class="md-ellipsis">
      webchesscam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="webchesscam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.webchesscam.WebChessCamArgs" class="md-nav__link">
    <span class="md-ellipsis">
      WebChessCamArgs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcwawc.webchesscam.chessUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      chessUpdate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcwawc.yamlablemixin" class="md-nav__link">
    <span class="md-ellipsis">
      yamlablemixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yamlablemixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcwawc.yamlablemixin.YamlAbleMixin" class="md-nav__link">
    <span class="md-ellipsis">
      YamlAbleMixin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="play-chess-with-a-webcam-api-documentation">play-chess-with-a-webcam API Documentation</h1>


<div class="doc doc-object doc-module">



<a id="pcwawc"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="pcwawc.args" class="doc doc-heading">
            <code>args</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-08</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.args.Args" class="doc doc-heading">
            <code>Args</code>


</h3>


    <div class="doc doc-contents ">


      <p>Command Line argument handling</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/args.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Args</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command Line argument handling&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--input&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Manually set the input device.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--autowarp&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;automatically find and warp chessboard&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--black&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PGN Black header&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show debug output&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--detector&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;simple8x8&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;move detector to be used&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--event&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PGN Event header&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--fen&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Forsyth–Edwards Notation to start with&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--game&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;game to initialize with&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--lichess&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;activate lichess integration&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--nomoves&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;do not show each individual move&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--nowarp&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;chessboard vision is already squared e.g. recorded that way&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--round&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PGN Round header&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--rotation&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;rotation of chessboard 0,90,180 or 270&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--site&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PGN Site header&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--startframe&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;video frame at which to start detection&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--speedup&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;detection speedup - higher speedup means less precision&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--white&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PGN White header&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--warp&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;warp points&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--distance&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;detection pixel distance - number of pixels analyzed i square of this&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--step&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;detection pixel steps - distance*step is the grid size being analyzed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">warpPointList</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">warp</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.board" class="doc doc-heading">
            <code>board</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.board.Board" class="doc doc-heading">
            <code>Board</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>This class is used to hold the state of a chessboard with pieces positions and the current player's color which player needs to play. It uses the python-chess library by default</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/board.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IChessBoard</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is used to hold the state of a chessboard with pieces positions and the current player&#39;s color which player needs to play. It uses the python-chess library by default&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">EMPTY_FEN</span> <span class="o">=</span> <span class="s2">&quot;8/8/8/8/8/8/8/8 w - -&quot;</span>
    <span class="n">START_FEN</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">STARTING_BOARD_FEN</span>

    <span class="c1"># initialize the board</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">Board</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldsByAn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">WebCamGame</span><span class="o">.</span><span class="n">fromArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Field</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Field</span><span class="o">.</span><span class="n">cols</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Field</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Field</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fieldsByAn</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">an</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>

    <span class="k">def</span> <span class="nf">fieldAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">genSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldsByAn</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">field</span>

    <span class="k">def</span> <span class="nf">divideInSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="c1"># interpolate the centers of the 8x8 fields from a squared image</span>
        <span class="n">fieldHeight</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">Field</span><span class="o">.</span><span class="n">rows</span>
        <span class="n">fieldWidth</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">Field</span><span class="o">.</span><span class="n">cols</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">field</span><span class="o">.</span><span class="n">setRect</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">fieldWidth</span><span class="p">,</span> <span class="n">fieldHeight</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fieldStateCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># there are 6 different FieldStats</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldsByAn</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">fieldState</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getFieldState</span><span class="p">()</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counts</span>

    <span class="k">def</span> <span class="nf">piecesOfColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldsByAn</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">piece</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getPiece</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">piece</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">color</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="c1"># perform the given move</span>
    <span class="k">def</span> <span class="nf">performMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
        <span class="n">fromCell</span><span class="p">,</span> <span class="n">toCell</span> <span class="o">=</span> <span class="n">move</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ucimove</span><span class="p">(</span><span class="n">fromCell</span> <span class="o">+</span> <span class="n">toCell</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ucimove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ucimove</span><span class="p">):</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">Move</span><span class="o">.</span><span class="n">from_uci</span><span class="p">(</span><span class="n">ucimove</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;perform the given move&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trying to perform move </span><span class="si">%s</span><span class="s2"> on&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">()))</span>
            <span class="n">san</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">san</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed with error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nomoves</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;move </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">san</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">san</span>

    <span class="k">def</span> <span class="nf">takeback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">lockGame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># @TODO implement locking of a saved game to make it immutable</span>
        <span class="n">gameid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">gameid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">gameid</span>

    <span class="c1"># set my board and game from the given pgn</span>
    <span class="k">def</span> <span class="nf">setPgn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">pgn</span>
        <span class="n">pgnIo</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">pgn</span><span class="p">)</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">pgn</span><span class="o">.</span><span class="n">read_game</span><span class="p">(</span><span class="n">pgnIo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO log a warning</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">board</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">game</span><span class="o">.</span><span class="n">mainline_moves</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">Board</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>

    <span class="c1"># get my fen description</span>
    <span class="k">def</span> <span class="nf">updateFen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">board_fen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">fen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fen</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fen</span>

    <span class="c1"># get my unicode representation</span>
    <span class="k">def</span> <span class="nf">unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unicode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">unicode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">unicode</span>

    <span class="k">def</span> <span class="nf">changeToMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">sq1</span><span class="p">,</span> <span class="n">sq2</span> <span class="o">=</span> <span class="n">change</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; convert the given change in the physical board to a move &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">legal_moves</span><span class="p">:</span>
            <span class="n">movestr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sq1</span> <span class="o">+</span> <span class="n">sq2</span> <span class="o">==</span> <span class="n">movestr</span> <span class="ow">or</span> <span class="n">sq2</span> <span class="o">+</span> <span class="n">sq1</span> <span class="o">==</span> <span class="n">movestr</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">move</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.board.Board.move" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move</span><span class="p">(</span><span class="n">move</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>perform the given move</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/board.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;perform the given move&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trying to perform move </span><span class="si">%s</span><span class="s2"> on&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">()))</span>
        <span class="n">san</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">san</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed with error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateFen</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nomoves</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;move </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">san</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">san</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.boarddetector" class="doc doc-heading">
            <code>boarddetector</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.boarddetector.BoardDetector" class="doc doc-heading">
            <code>BoardDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.eventhandling.Observable" href="#pcwawc.eventhandling.Observable">Observable</a></code></p>


      <p>detect a chess board's state from the given image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/boarddetector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IMoveDetector</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BoardDetector</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;detect a chess board&#39;s state from the given image&quot;&quot;&quot;</span>

    <span class="n">frameDebug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
        <span class="c1"># make me observable</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BoardDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">vision</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span> <span class="o">=</span> <span class="n">vision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">board</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">sortByFieldState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># get a dict of fields sorted by field state</span>
        <span class="n">sortedByFieldState</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">fieldsByAn</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">field</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">getFieldState</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">fieldStateCounts</span><span class="p">()</span>
        <span class="n">sortedFields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fromIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">FieldState</span><span class="p">:</span>
            <span class="n">toIndex</span> <span class="o">=</span> <span class="n">fromIndex</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span>
            <span class="n">sortedFields</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="n">sortedByFieldState</span><span class="p">[</span><span class="n">fromIndex</span><span class="p">:</span><span class="n">toIndex</span><span class="p">]</span>
            <span class="n">fromIndex</span> <span class="o">=</span> <span class="n">toIndex</span>
        <span class="k">return</span> <span class="n">sortedFields</span>

    <span class="k">def</span> <span class="nf">analyzeFields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">roiLambda</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">field</span><span class="o">.</span><span class="n">divideInROIs</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">roiLambda</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">roi</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">rois</span><span class="p">:</span>
                <span class="n">roi</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">analyzeColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">field</span><span class="o">.</span><span class="n">analyzeColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsv</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageEvent</span><span class="p">):</span>
        <span class="n">cbImageSet</span> <span class="o">=</span> <span class="n">imageEvent</span><span class="o">.</span><span class="n">cbImageSet</span>
        <span class="n">vision</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">vision</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">args</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">distance</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">step</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="c1"># analyze the given image</span>
    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">frameIndex</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">frameIndex</span>
        <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">divideInSquares</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzeColors</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">sortedFields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sortByFieldState</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">fieldState</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">sortedFields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">luminance</span>
                <span class="k">if</span> <span class="n">BoardDetector</span><span class="o">.</span><span class="n">frameDebug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;frame </span><span class="si">%5d</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> luminance: </span><span class="si">%3.0f</span><span class="s2"> ± </span><span class="si">%3.0f</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">) rgbColorKey: </span><span class="si">%3.0f</span><span class="s2"> colorKey: </span><span class="si">%.0f</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="n">frameIndex</span><span class="p">,</span>
                            <span class="n">field</span><span class="o">.</span><span class="n">an</span><span class="p">,</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">(),</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
                            <span class="n">field</span><span class="o">.</span><span class="n">rgbColorKey</span><span class="p">,</span>
                            <span class="n">field</span><span class="o">.</span><span class="n">colorKey</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">fieldState</span><span class="p">)</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># Transparency factor.</span>
                    <span class="c1"># Following line overlays transparent rectangle over the image</span>
                    <span class="n">image_new</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">image_new</span>
                    <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDebug</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.boarddetector.BoardDetector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boarddetector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
    <span class="c1"># make me observable</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">BoardDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.boardfinder" class="doc doc-heading">
            <code>boardfinder</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.boardfinder.BoardFinder" class="doc doc-heading">
            <code>BoardFinder</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>find a chess board in the given image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BoardFinder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find a chess board in the given image&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">white</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">darkGrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">lightGrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me from the given input image&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="c1"># guess the topleft color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">centerXY</span><span class="p">(</span><span class="n">xylist</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">xylist</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">l</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">l</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sortPoints</span><span class="p">(</span><span class="n">xylist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;sort points clockwise see https://stackoverflow.com/a/59115565/1497139&quot;&quot;&quot;</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">centerXY</span><span class="p">(</span><span class="n">xylist</span><span class="p">)</span>
        <span class="n">xy_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xylist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">xy_sorted</span>

    <span class="k">def</span> <span class="nf">findOuterCorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find my outer corners as limited by the OpenCV findChessBoard algorithm - to be later expanded&quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findCorners</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="n">searchWidth</span><span class="p">)</span>
        <span class="c1"># we expected to find a board</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no corners found&quot;</span><span class="p">)</span>
        <span class="n">chesspattern</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">found</span><span class="p">))</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">found</span><span class="p">[</span><span class="n">chesspattern</span><span class="p">]</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">calcPolygons</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Corners</span><span class="o">.</span><span class="n">safetyMargin</span><span class="p">)</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">calcTrapez</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">corners</span>

    <span class="k">def</span> <span class="nf">preparefindCorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
        <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="k">if</span> <span class="n">sw</span> <span class="o">&gt;</span> <span class="n">searchWidth</span><span class="p">:</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="n">searchWidth</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">sw</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">searchimage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">sw</span><span class="p">,</span> <span class="n">sh</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;BoardFinder for </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> image resized to </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">sh</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">searchimage</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">fullSizeGray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gray</span><span class="p">,</span> <span class="n">fullSizeGray</span>

    <span class="k">def</span> <span class="nf">findCorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;start finding the chessboard with the given limit and the given maximum width of the search image&quot;&quot;&quot;</span>
        <span class="n">startt</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">gray</span><span class="p">,</span> <span class="n">fullSizeGray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preparefindCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">searchWidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chesspattern</span> <span class="ow">in</span> <span class="n">Corners</span><span class="o">.</span><span class="n">genChessPatterns</span><span class="p">():</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">Corners</span><span class="p">(</span><span class="n">chesspattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">corners</span><span class="o">.</span><span class="n">findPattern</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">corners</span><span class="o">.</span><span class="n">findPattern</span><span class="p">(</span><span class="n">fullSizeGray</span><span class="p">):</span>
                <span class="n">corners</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">[</span><span class="n">chesspattern</span><span class="p">]</span> <span class="o">=</span> <span class="n">corners</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">endt</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found </span><span class="si">%d</span><span class="s2"> patterns in </span><span class="si">%.1f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">),</span> <span class="p">(</span><span class="n">endt</span> <span class="o">-</span> <span class="n">startt</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">found</span>

    <span class="k">def</span> <span class="nf">findChessBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find a chess board in the given image and return the trapez polygon for it&quot;&quot;&quot;</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findOuterCorners</span><span class="p">()</span>
        <span class="n">histograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHistograms</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corners</span>

    <span class="k">def</span> <span class="nf">fieldColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;determine the field color at the given position&quot;&quot;&quot;</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="c1"># the color of the topleft field might be different then A8=WHITE when we have a rotated image</span>
        <span class="n">oddeven</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c1"># calculate the chessboard color of the given position based on the topleft color</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">oddeven</span> <span class="k">else</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="k">return</span> <span class="n">color</span>

    <span class="k">def</span> <span class="nf">maskPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;mask the given image with the given polygon&quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masked</span>

    <span class="k">def</span> <span class="nf">maskCornerPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">filterColor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;mask the polygons derived from the given corner points&quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="n">Corners</span><span class="o">.</span><span class="n">safetyMargin</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">posColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">posColor</span> <span class="o">==</span> <span class="n">filterColor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
                    <span class="n">mask</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span>
                <span class="p">)</span>
        <span class="c1"># if BoardFinder.debug:</span>
        <span class="c1">#    cv2.imshow(&quot;mask&quot;,mask)</span>
        <span class="c1">#    cv2.waitKey(1000)</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masked</span>

    <span class="k">def</span> <span class="nf">getHistograms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the two histograms for the given corners we don&#39;t no what the color of the topleft corner is so we start with a guess&quot;&quot;&quot;</span>
        <span class="n">histograms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">filterColor</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskCornerPolygons</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">filterColor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;masked-O-&quot;</span> <span class="k">if</span> <span class="n">filterColor</span> <span class="k">else</span> <span class="s2">&quot;masked-X-&quot;</span>
                <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
            <span class="n">histograms</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>

        <span class="c1"># do we need to fix our guess?</span>
        <span class="c1"># is the mean color of black (being filtered) higher then when white is filtered?</span>
        <span class="k">if</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span><span class="o">.</span><span class="n">color</span> <span class="o">&gt;</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
            <span class="c1"># swap entries</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span>
            <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span>
            <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="k">return</span> <span class="n">histograms</span>

    <span class="k">def</span> <span class="nf">getColorFiltered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get color filtered images based on the given histograms&quot;&quot;&quot;</span>
        <span class="n">colorFiltered</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">colorMask</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">filterColor</span> <span class="ow">in</span> <span class="p">(</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">,</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">):</span>
            <span class="n">histogram</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span>
            <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">lowerColor</span><span class="p">,</span> <span class="n">upperColor</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="c1"># make sure the colors are numpy arrays</span>
            <span class="n">lowerColor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lowerColor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">upperColor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upperColor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="c1"># if we would know that the empty fields would be the extreme colors we could do the following:</span>
            <span class="c1"># if filterColor==chess.WHITE:</span>
            <span class="c1">#    upperColor=(255,255,255)</span>
            <span class="c1"># else:</span>
            <span class="c1">#    lowerColor=(0,0,0)</span>
            <span class="c1"># lower,upper=histogram.mincolor, histogram.maxcolor</span>
            <span class="n">colorMask</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">lowerColor</span><span class="p">,</span> <span class="n">upperColor</span><span class="p">)</span>
            <span class="c1"># colorMask[filterColor]=histogram.colorMask(imageCopy, 1.5)</span>
            <span class="n">colorFiltered</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span>
                <span class="n">imageCopy</span><span class="p">,</span> <span class="n">colorMask</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">colorName</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">filterColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
                <span class="n">bl</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">rl</span> <span class="o">=</span> <span class="n">lowerColor</span>
                <span class="n">bu</span><span class="p">,</span> <span class="n">gu</span><span class="p">,</span> <span class="n">ru</span> <span class="o">=</span> <span class="n">upperColor</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;bgr </span><span class="si">%s</span><span class="s2">: </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">colorName</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">bu</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">gu</span><span class="p">,</span> <span class="n">rl</span><span class="p">,</span> <span class="n">ru</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;colorFiltered-</span><span class="si">%s</span><span class="s2">-&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colorName</span><span class="p">)</span>
                <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">colorFiltered</span><span class="p">[</span><span class="n">filterColor</span><span class="p">],</span> <span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="n">backGroundFilter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_or</span><span class="p">(</span><span class="n">colorMask</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">],</span> <span class="n">colorMask</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">backGroundFilter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span>
                <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">],</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;colorFiltered-background-&quot;</span>
            <span class="p">)</span>
        <span class="c1"># side effect - add background histogram</span>
        <span class="n">histograms</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
            <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">],</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">colorFiltered</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;expand the image finding to 8x8 with the given histograms and corners that are e.g. 7x7,7x5,5x5, ...&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">showTrapezDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="c1"># create a mask for the</span>
        <span class="n">masked8x8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskPolygon</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked8x8</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez-masked&quot;</span><span class="p">)</span>
        <span class="c1"># draw a 10x10 sized white trapez</span>
        <span class="n">white10x10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">white10x10</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez10x10</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">white10x10</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
        <span class="n">masked10x10</span> <span class="o">=</span> <span class="n">white10x10</span> <span class="o">+</span> <span class="n">masked8x8</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked10x10</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez-white&quot;</span><span class="p">)</span>
        <span class="c1"># 9x9 test fails due to a few pixels which are in the way</span>
        <span class="c1"># commented out to speed up</span>
        <span class="c1"># gray8x8,fullSizeGray8x8=self.preparefindCorners(masked10x10)</span>
        <span class="c1"># corners8x8=Corners((9,9),self.video)</span>
        <span class="c1"># if corners8x8.findPattern(fullSizeGray8x8):</span>
        <span class="c1">#    if BoardFinder.debug:</span>
        <span class="c1">#        print(&quot;Successfully found 8x8 for %s&quot;+title)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorFiltered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColorFiltered</span><span class="p">(</span>
            <span class="n">masked8x8</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">whiteColor</span><span class="p">,</span> <span class="n">blackColor</span><span class="p">):</span>
        <span class="n">posColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">blackColor</span> <span class="k">if</span> <span class="n">posColor</span> <span class="k">else</span> <span class="n">whiteColor</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showPolygonDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw polygons for debugging on a copy of the given image with the given corners and write result to the debugImagePath with the given title&quot;&quot;&quot;</span>
        <span class="n">imagecopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
                <span class="n">imagecopy</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">lightGrey</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">darkGrey</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">pos</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">centerXY</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span>
                    <span class="n">imagecopy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imagecopy</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;polygons&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showHistogramDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; the debug information for the given histograms by writing a plotted histogram image to the debugImagePath&quot;&quot;&quot;</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">preparePlot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">histograms</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">histograms</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">histograms</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;histogram&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">,</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">histograms</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me from the given input image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me from the given input image&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
    <span class="c1"># guess the topleft color</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.expand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>expand the image finding to 8x8 with the given histograms and corners that are e.g. 7x7,7x5,5x5, ...</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;expand the image finding to 8x8 with the given histograms and corners that are e.g. 7x7,7x5,5x5, ...&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">showTrapezDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
    <span class="c1"># create a mask for the</span>
    <span class="n">masked8x8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskPolygon</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked8x8</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez-masked&quot;</span><span class="p">)</span>
    <span class="c1"># draw a 10x10 sized white trapez</span>
    <span class="n">white10x10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">white10x10</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez10x10</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">white10x10</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">masked10x10</span> <span class="o">=</span> <span class="n">white10x10</span> <span class="o">+</span> <span class="n">masked8x8</span>
    <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked10x10</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez-white&quot;</span><span class="p">)</span>
    <span class="c1"># 9x9 test fails due to a few pixels which are in the way</span>
    <span class="c1"># commented out to speed up</span>
    <span class="c1"># gray8x8,fullSizeGray8x8=self.preparefindCorners(masked10x10)</span>
    <span class="c1"># corners8x8=Corners((9,9),self.video)</span>
    <span class="c1"># if corners8x8.findPattern(fullSizeGray8x8):</span>
    <span class="c1">#    if BoardFinder.debug:</span>
    <span class="c1">#        print(&quot;Successfully found 8x8 for %s&quot;+title)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">colorFiltered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColorFiltered</span><span class="p">(</span>
        <span class="n">masked8x8</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.fieldColor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fieldColor</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>determine the field color at the given position</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fieldColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;determine the field color at the given position&quot;&quot;&quot;</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="c1"># the color of the topleft field might be different then A8=WHITE when we have a rotated image</span>
    <span class="n">oddeven</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="c1"># calculate the chessboard color of the given position based on the topleft color</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">oddeven</span> <span class="k">else</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="k">return</span> <span class="n">color</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.findChessBoard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">findChessBoard</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>find a chess board in the given image and return the trapez polygon for it</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">findChessBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find a chess board in the given image and return the trapez polygon for it&quot;&quot;&quot;</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findOuterCorners</span><span class="p">()</span>
    <span class="n">histograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHistograms</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">corners</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.findCorners" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">findCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>start finding the chessboard with the given limit and the given maximum width of the search image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">findCorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;start finding the chessboard with the given limit and the given maximum width of the search image&quot;&quot;&quot;</span>
    <span class="n">startt</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="n">gray</span><span class="p">,</span> <span class="n">fullSizeGray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preparefindCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">searchWidth</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">chesspattern</span> <span class="ow">in</span> <span class="n">Corners</span><span class="o">.</span><span class="n">genChessPatterns</span><span class="p">():</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">Corners</span><span class="p">(</span><span class="n">chesspattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">corners</span><span class="o">.</span><span class="n">findPattern</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">corners</span><span class="o">.</span><span class="n">findPattern</span><span class="p">(</span><span class="n">fullSizeGray</span><span class="p">):</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">[</span><span class="n">chesspattern</span><span class="p">]</span> <span class="o">=</span> <span class="n">corners</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">endt</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found </span><span class="si">%d</span><span class="s2"> patterns in </span><span class="si">%.1f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">),</span> <span class="p">(</span><span class="n">endt</span> <span class="o">-</span> <span class="n">startt</span><span class="p">)))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">found</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.findOuterCorners" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">findOuterCorners</span><span class="p">(</span><span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>find my outer corners as limited by the OpenCV findChessBoard algorithm - to be later expanded</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">findOuterCorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find my outer corners as limited by the OpenCV findChessBoard algorithm - to be later expanded&quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findCorners</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">searchWidth</span><span class="o">=</span><span class="n">searchWidth</span><span class="p">)</span>
    <span class="c1"># we expected to find a board</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no corners found&quot;</span><span class="p">)</span>
    <span class="n">chesspattern</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">found</span><span class="p">))</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">found</span><span class="p">[</span><span class="n">chesspattern</span><span class="p">]</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">calcPolygons</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Corners</span><span class="o">.</span><span class="n">safetyMargin</span><span class="p">)</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">calcTrapez</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">corners</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.getColorFiltered" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getColorFiltered</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get color filtered images based on the given histograms</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getColorFiltered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get color filtered images based on the given histograms&quot;&quot;&quot;</span>
    <span class="n">colorFiltered</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">colorMask</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">filterColor</span> <span class="ow">in</span> <span class="p">(</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">,</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">):</span>
        <span class="n">histogram</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span>
        <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lowerColor</span><span class="p">,</span> <span class="n">upperColor</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># make sure the colors are numpy arrays</span>
        <span class="n">lowerColor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lowerColor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">upperColor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upperColor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="c1"># if we would know that the empty fields would be the extreme colors we could do the following:</span>
        <span class="c1"># if filterColor==chess.WHITE:</span>
        <span class="c1">#    upperColor=(255,255,255)</span>
        <span class="c1"># else:</span>
        <span class="c1">#    lowerColor=(0,0,0)</span>
        <span class="c1"># lower,upper=histogram.mincolor, histogram.maxcolor</span>
        <span class="n">colorMask</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">lowerColor</span><span class="p">,</span> <span class="n">upperColor</span><span class="p">)</span>
        <span class="c1"># colorMask[filterColor]=histogram.colorMask(imageCopy, 1.5)</span>
        <span class="n">colorFiltered</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span>
            <span class="n">imageCopy</span><span class="p">,</span> <span class="n">colorMask</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">colorName</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">filterColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
            <span class="n">bl</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">rl</span> <span class="o">=</span> <span class="n">lowerColor</span>
            <span class="n">bu</span><span class="p">,</span> <span class="n">gu</span><span class="p">,</span> <span class="n">ru</span> <span class="o">=</span> <span class="n">upperColor</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;bgr </span><span class="si">%s</span><span class="s2">: </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">-</span><span class="si">%3d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">colorName</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">bu</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">gu</span><span class="p">,</span> <span class="n">rl</span><span class="p">,</span> <span class="n">ru</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;colorFiltered-</span><span class="si">%s</span><span class="s2">-&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colorName</span><span class="p">)</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">colorFiltered</span><span class="p">[</span><span class="n">filterColor</span><span class="p">],</span> <span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="n">backGroundFilter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_or</span><span class="p">(</span><span class="n">colorMask</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">],</span> <span class="n">colorMask</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">backGroundFilter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span>
            <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">],</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;colorFiltered-background-&quot;</span>
        <span class="p">)</span>
    <span class="c1"># side effect - add background histogram</span>
    <span class="n">histograms</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">colorFiltered</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">],</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">colorFiltered</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.getHistograms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getHistograms</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the two histograms for the given corners we don't no what the color of the topleft corner is so we start with a guess</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getHistograms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the two histograms for the given corners we don&#39;t no what the color of the topleft corner is so we start with a guess&quot;&quot;&quot;</span>
    <span class="n">histograms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">filterColor</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskCornerPolygons</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">filterColor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;masked-O-&quot;</span> <span class="k">if</span> <span class="n">filterColor</span> <span class="k">else</span> <span class="s2">&quot;masked-X-&quot;</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="n">histograms</span><span class="p">[</span><span class="n">filterColor</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>

    <span class="c1"># do we need to fix our guess?</span>
    <span class="c1"># is the mean color of black (being filtered) higher then when white is filtered?</span>
    <span class="k">if</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span><span class="o">.</span><span class="n">color</span> <span class="o">&gt;</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="c1"># swap entries</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span>
        <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span>
        <span class="n">histograms</span><span class="p">[</span><span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">histograms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.maskCornerPolygons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">maskCornerPolygons</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">filterColor</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>mask the polygons derived from the given corner points</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">maskCornerPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">filterColor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;mask the polygons derived from the given corner points&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="n">Corners</span><span class="o">.</span><span class="n">safetyMargin</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">posColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">posColor</span> <span class="o">==</span> <span class="n">filterColor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
                <span class="n">mask</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span>
            <span class="p">)</span>
    <span class="c1"># if BoardFinder.debug:</span>
    <span class="c1">#    cv2.imshow(&quot;mask&quot;,mask)</span>
    <span class="c1">#    cv2.waitKey(1000)</span>
    <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">masked</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.maskPolygon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">maskPolygon</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>mask the given image with the given polygon</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">maskPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;mask the given image with the given polygon&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
    <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">masked</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.showHistogramDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">showHistogramDebug</span><span class="p">(</span><span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>'show' the debug information for the given histograms by writing a plotted histogram image to the debugImagePath</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">showHistogramDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; the debug information for the given histograms by writing a plotted histogram image to the debugImagePath&quot;&quot;&quot;</span>
    <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">preparePlot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">histograms</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">histograms</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">histograms</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;histogram&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">title</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">,</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">histograms</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.showPolygonDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">showPolygonDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw polygons for debugging on a copy of the given image with the given corners and write result to the debugImagePath with the given title</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">showPolygonDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw polygons for debugging on a copy of the given image with the given corners and write result to the debugImagePath with the given title&quot;&quot;&quot;</span>
    <span class="n">imagecopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
            <span class="n">imagecopy</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">lightGrey</span><span class="p">,</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">darkGrey</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">centerXY</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span>
                <span class="n">imagecopy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imagecopy</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;polygons&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.BoardFinder.sortPoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sortPoints</span><span class="p">(</span><span class="n">xylist</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>sort points clockwise see https://stackoverflow.com/a/59115565/1497139</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">sortPoints</span><span class="p">(</span><span class="n">xylist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;sort points clockwise see https://stackoverflow.com/a/59115565/1497139&quot;&quot;&quot;</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">centerXY</span><span class="p">(</span><span class="n">xylist</span><span class="p">)</span>
    <span class="n">xy_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xylist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">xy_sorted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.boardfinder.Corners" class="doc doc-heading">
            <code>Corners</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Chess board corners</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Corners</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chess board corners&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">debugSorting</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; pixel margin for masked polygons&quot;&quot;&quot;</span>
    <span class="n">safetyMargin</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">video</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initialize me with the given rows and columns&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>
        <span class="c1"># prepare the dict for my polygons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">genChessPatterns</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generate the patterns 7x7, 5x7, 3x7, 5x5, 5x3, 3x3&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sortXY</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;sort the corners - this step is currently not implemented so the corners stay rotated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trying to sort </span><span class="si">%d</span><span class="s2"> points&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)))</span>
        <span class="n">cornerssorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">Corners</span><span class="o">.</span><span class="n">sortXY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cornerssorted</span><span class="p">)</span>
        <span class="c1"># self.corners = np.empty(shape=(len(self.corners),2),dtype=np.float32)</span>
        <span class="c1"># for i,val in enumerate(cornerssorted):</span>
        <span class="c1">#    self.corners[i]=val</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">findPattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;try finding the chess board corners in the given image with the given pattern&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findChessboardCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> in </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> after </span><span class="si">%.3f</span><span class="s2"> s: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">),</span>
                    <span class="s2">&quot;✔&quot;</span> <span class="k">if</span> <span class="n">ret</span> <span class="k">else</span> <span class="s2">&quot;❌&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">safeXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the given x,y tuple shifted by dx,dy making sure the result is not out of my width and height bounds&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">asPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safetyMargin</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the polygons for my corner points&quot;&quot;&quot;</span>
        <span class="c1"># reshape the array</span>
        <span class="n">cps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">safetyMargin</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># top left</span>
                <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># left bottom</span>
                <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># right bottom</span>
                <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># top right</span>
                <span class="n">clockwise</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">sortPoints</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span> <span class="o">=</span> <span class="n">clockwise</span>
                <span class="c1"># https://stackoverflow.com/questions/19190484/what-is-the-opencv-findchessboardcorners-convention</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">polygons</span><span class="p">[(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">row</span><span class="p">)]</span> <span class="o">=</span> <span class="n">polygon</span>
        <span class="k">return</span> <span class="n">polygons</span>

    <span class="k">def</span> <span class="nf">calcPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">safetyMargins</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;calculate polygons for the given safety margins&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">safetyMargin</span> <span class="ow">in</span> <span class="n">safetyMargins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="n">safetyMargin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asPolygons</span><span class="p">(</span><span class="n">safetyMargin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calcTrapez</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;calculate the relevant quadrilaterals&quot;&quot;&quot;</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">rowend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">rowend</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rowend</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span> <span class="o">=</span> <span class="n">Trapez2Square</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez8x8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapezColRows</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez10x10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapezColRows</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span><span class="o">.</span><span class="n">relativeTrapezToTrapezXY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">trapezColRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return an expanded trapez with the given number of columns and rows&quot;&quot;&quot;</span>
        <span class="n">relDeltaRows</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">relDeltaCols</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">trapez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span><span class="o">.</span><span class="n">relativeTrapezToTrapezXY</span><span class="p">(</span>
            <span class="o">-</span><span class="n">relDeltaRows</span><span class="p">,</span> <span class="o">-</span><span class="n">relDeltaCols</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">relDeltaRows</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">relDeltaCols</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">trapez</span>

    <span class="k">def</span> <span class="nf">showTrapezDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; a debug picture with the extrapolated quadrilaterals by writing an image to the debugImagePath&quot;&quot;&quot;</span>
        <span class="n">overlay</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># draw polytons from outer to inner</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez10x10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>  <span class="c1"># orange</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>  <span class="c1"># grey</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="p">,</span> <span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">65</span><span class="p">))</span>  <span class="c1"># royal blue</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># Transparency factor.</span>
        <span class="c1"># overlay the</span>
        <span class="n">imageAlpha</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imageAlpha</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; the debug picture of the chessboard corners by drawing the corners and writing the result to the given testImagePath&quot;&quot;&quot;</span>
        <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">drawChessboardCorners</span><span class="p">(</span>
            <span class="n">imageCopy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">patternWasFound</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span>
                    <span class="n">imageCopy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">fontScale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># if Corners.debugSorting:</span>
        <span class="c1">#    for index,corner in enumerate(self.corners):</span>
        <span class="c1">#        x,y=corner[0]</span>
        <span class="c1">#        text=&quot;%d&quot; % (index)</span>
        <span class="c1">#        self.video.drawCenteredText(imageCopy, text, int(x), int(y), fontScale=0.5,fontBGRColor=(128,128,128))</span>
        <span class="c1"># cv2.imshow(&#39;corners&#39;, self.image)</span>
        <span class="c1"># cv2.waitKey(50)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;corners&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">writeDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
            <span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">),</span>
            <span class="n">image</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="pcwawc.boardfinder.Corners.debugSorting" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debugSorting</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>pixel margin for masked polygons</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">video</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>initialize me with the given rows and columns</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">video</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;initialize me with the given rows and columns&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>
    <span class="c1"># prepare the dict for my polygons</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.asPolygons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">asPolygons</span><span class="p">(</span><span class="n">safetyMargin</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the polygons for my corner points</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">asPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safetyMargin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the polygons for my corner points&quot;&quot;&quot;</span>
    <span class="c1"># reshape the array</span>
    <span class="n">cps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">safetyMargin</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># top left</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># left bottom</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># right bottom</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">cps</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># top right</span>
            <span class="n">clockwise</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="o">.</span><span class="n">sortPoints</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span> <span class="o">=</span> <span class="n">clockwise</span>
            <span class="c1"># https://stackoverflow.com/questions/19190484/what-is-the-opencv-findchessboardcorners-convention</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">safeXY</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">polygons</span><span class="p">[(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">row</span><span class="p">)]</span> <span class="o">=</span> <span class="n">polygon</span>
    <span class="k">return</span> <span class="n">polygons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.calcPolygons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calcPolygons</span><span class="p">(</span><span class="o">*</span><span class="n">safetyMargins</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>calculate polygons for the given safety margins</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calcPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">safetyMargins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculate polygons for the given safety margins&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">safetyMargin</span> <span class="ow">in</span> <span class="n">safetyMargins</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="n">safetyMargin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asPolygons</span><span class="p">(</span><span class="n">safetyMargin</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.calcTrapez" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calcTrapez</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>calculate the relevant quadrilaterals</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calcTrapez</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculate the relevant quadrilaterals&quot;&quot;&quot;</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
    <span class="n">rowend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">rowend</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rowend</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span> <span class="o">=</span> <span class="n">Trapez2Square</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez8x8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapezColRows</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez10x10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapezColRows</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span><span class="o">.</span><span class="n">relativeTrapezToTrapezXY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.findPattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">findPattern</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>try finding the chess board corners in the given image with the given pattern</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">findPattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;try finding the chess board corners in the given image with the given pattern&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="n">ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findChessboardCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> in </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> after </span><span class="si">%.3f</span><span class="s2"> s: </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">),</span>
                <span class="s2">&quot;✔&quot;</span> <span class="k">if</span> <span class="n">ret</span> <span class="k">else</span> <span class="s2">&quot;❌&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.genChessPatterns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">genChessPatterns</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>generate the patterns 7x7, 5x7, 3x7, 5x5, 5x3, 3x3</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">genChessPatterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generate the patterns 7x7, 5x7, 3x7, 5x5, 5x3, 3x3&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.safeXY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safeXY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>return the given x,y tuple shifted by dx,dy making sure the result is not out of my width and height bounds</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">safeXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return the given x,y tuple shifted by dx,dy making sure the result is not out of my width and height bounds&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.showDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">showDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>'show' the debug picture of the chessboard corners by drawing the corners and writing the result to the given testImagePath</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; the debug picture of the chessboard corners by drawing the corners and writing the result to the given testImagePath&quot;&quot;&quot;</span>
    <span class="n">imageCopy</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">drawChessboardCorners</span><span class="p">(</span>
        <span class="n">imageCopy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">patternWasFound</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span>
                <span class="n">imageCopy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">fontScale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># if Corners.debugSorting:</span>
    <span class="c1">#    for index,corner in enumerate(self.corners):</span>
    <span class="c1">#        x,y=corner[0]</span>
    <span class="c1">#        text=&quot;%d&quot; % (index)</span>
    <span class="c1">#        self.video.drawCenteredText(imageCopy, text, int(x), int(y), fontScale=0.5,fontBGRColor=(128,128,128))</span>
    <span class="c1"># cv2.imshow(&#39;corners&#39;, self.image)</span>
    <span class="c1"># cv2.waitKey(50)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imageCopy</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;corners&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.showTrapezDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">showTrapezDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>'show' a debug picture with the extrapolated quadrilaterals by writing an image to the debugImagePath</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">showTrapezDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&#39;show&#39; a debug picture with the extrapolated quadrilaterals by writing an image to the debugImagePath&quot;&quot;&quot;</span>
    <span class="n">overlay</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># draw polytons from outer to inner</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez10x10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>  <span class="c1"># orange</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez8x8</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>  <span class="c1"># grey</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="p">,</span> <span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">65</span><span class="p">))</span>  <span class="c1"># royal blue</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># Transparency factor.</span>
    <span class="c1"># overlay the</span>
    <span class="n">imageAlpha</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">writeDebug</span><span class="p">(</span><span class="n">imageAlpha</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot;trapez&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.sort" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>sort the corners - this step is currently not implemented so the corners stay rotated</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;sort the corners - this step is currently not implemented so the corners stay rotated&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trying to sort </span><span class="si">%d</span><span class="s2"> points&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)))</span>
    <span class="n">cornerssorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">Corners</span><span class="o">.</span><span class="n">sortXY</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Corners</span><span class="o">.</span><span class="n">debugSorting</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cornerssorted</span><span class="p">)</span>
    <span class="c1"># self.corners = np.empty(shape=(len(self.corners),2),dtype=np.float32)</span>
    <span class="c1"># for i,val in enumerate(cornerssorted):</span>
    <span class="c1">#    self.corners[i]=val</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.boardfinder.Corners.trapezColRows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trapezColRows</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>return an expanded trapez with the given number of columns and rows</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/boardfinder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trapezColRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return an expanded trapez with the given number of columns and rows&quot;&quot;&quot;</span>
    <span class="n">relDeltaRows</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">relDeltaCols</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">trapez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez2Square</span><span class="o">.</span><span class="n">relativeTrapezToTrapezXY</span><span class="p">(</span>
        <span class="o">-</span><span class="n">relDeltaRows</span><span class="p">,</span> <span class="o">-</span><span class="n">relDeltaCols</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">relDeltaRows</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">relDeltaCols</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">trapez</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.chessengine" class="doc doc-heading">
            <code>chessengine</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-16</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessengine.Engine" class="doc doc-heading">
            <code>Engine</code>


</h3>


    <div class="doc doc-contents ">


      <p>Chess Engines support e.g. Universal Chess Interface see https://chessprogramming.wikispaces.com/UCI</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessengine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Engine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chess Engines support e.g. Universal Chess Interface see https://chessprogramming.wikispaces.com/UCI&quot;&quot;&quot;</span>

    <span class="c1"># shall we output debug information?</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># list of engines to search for</span>
    <span class="n">engineConfigs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Crafty Computer Chess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;crafty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.craftychess.com/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;GNU Chess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;gnuchess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.gnu.org/software/chess/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="s2">&quot;--uci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;uci&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stockfish Chess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;stockfish&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://stockfishchess.org/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;uci&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;XBoard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;xboard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.gnu.org/software/xboard/manual/xboard.html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;xboard&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engineConfig</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        construct me with the given engineConfiguration and timeout</span>

<span class="sd">        Args:</span>
<span class="sd">            engineConfig(dict): the engine configuration to use</span>
<span class="sd">            timeout(float): the number of seconds to wait of the given engine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engineCmd</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enginePath</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">engineConfig</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">==</span> <span class="s2">&quot;uci&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">UciProtocol</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">==</span> <span class="s2">&quot;xboard&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">XBoardProtocol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="c1"># asyncio.set_event_loop_policy(chess.engine.EventLoopPolicy())</span>
        <span class="c1"># https://python-chess.readthedocs.io/en/latest/engine.html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        open this chess engine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown protocol for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">engineCmd</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                    <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SimpleEngine</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">Engine</span><span class="o">.</span><span class="n">debug</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">te</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">te</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        close the given engine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">_base</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="c1"># so what?</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;timeout after %1.f secs for </span><span class="si">%s</span><span class="s2"> on close forcing close now ...&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;chess engine </span><span class="si">%s</span><span class="s2"> called via </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engineCmd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enginePath</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">findEngines</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check which engines from the Engine configurations are installed</span>
<span class="sd">        on this computer and return a dict of these</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: map of Engines by Command e.g. &quot;gnuchess&quot; or &quot;stockfish&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">engineDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">engineConfig</span> <span class="ow">in</span> <span class="n">Engine</span><span class="o">.</span><span class="n">engineConfigs</span><span class="p">:</span>
            <span class="n">engineCmd</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span>
            <span class="n">enginePath</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">engineCmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enginePath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Engine</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found </span><span class="si">%s</span><span class="s2"> engine at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">engineCmd</span><span class="p">,</span> <span class="n">enginePath</span><span class="p">))</span>
                <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enginePath</span>
                <span class="n">engineDict</span><span class="p">[</span><span class="n">engineCmd</span><span class="p">]</span> <span class="o">=</span> <span class="n">engineConfig</span>
        <span class="k">return</span> <span class="n">engineDict</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessengine.Engine.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">engineConfig</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me with the given engineConfiguration and timeout</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>engineConfig(dict)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the engine configuration to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timeout(float)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of seconds to wait of the given engine</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessengine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engineConfig</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    construct me with the given engineConfiguration and timeout</span>

<span class="sd">    Args:</span>
<span class="sd">        engineConfig(dict): the engine configuration to use</span>
<span class="sd">        timeout(float): the number of seconds to wait of the given engine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engineCmd</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enginePath</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">engineConfig</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">==</span> <span class="s2">&quot;uci&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">UciProtocol</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocolName</span> <span class="o">==</span> <span class="s2">&quot;xboard&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">XBoardProtocol</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
    <span class="c1"># asyncio.set_event_loop_policy(chess.engine.EventLoopPolicy())</span>
    <span class="c1"># https://python-chess.readthedocs.io/en/latest/engine.html</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessengine.Engine.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>close the given engine</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessengine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    close the given engine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">_base</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="c1"># so what?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;timeout after %1.f secs for </span><span class="si">%s</span><span class="s2"> on close forcing close now ...&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessengine.Engine.findEngines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">findEngines</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>check which engines from the Engine configurations are installed
on this computer and return a dict of these</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>map of Engines by Command e.g. "gnuchess" or "stockfish"</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessengine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">findEngines</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    check which engines from the Engine configurations are installed</span>
<span class="sd">    on this computer and return a dict of these</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: map of Engines by Command e.g. &quot;gnuchess&quot; or &quot;stockfish&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engineDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">engineConfig</span> <span class="ow">in</span> <span class="n">Engine</span><span class="o">.</span><span class="n">engineConfigs</span><span class="p">:</span>
        <span class="n">engineCmd</span> <span class="o">=</span> <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span>
        <span class="n">enginePath</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">engineCmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enginePath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Engine</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found </span><span class="si">%s</span><span class="s2"> engine at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">engineCmd</span><span class="p">,</span> <span class="n">enginePath</span><span class="p">))</span>
            <span class="n">engineConfig</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enginePath</span>
            <span class="n">engineDict</span><span class="p">[</span><span class="n">engineCmd</span><span class="p">]</span> <span class="o">=</span> <span class="n">engineConfig</span>
    <span class="k">return</span> <span class="n">engineDict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessengine.Engine.open" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">open</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>open this chess engine</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessengine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    open this chess engine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown protocol for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">engineCmd</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SimpleEngine</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">Engine</span><span class="o">.</span><span class="n">debug</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">te</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">te</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.chessimage" class="doc doc-heading">
            <code>chessimage</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-10</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessimage.ChessBoardImage" class="doc doc-heading">
            <code>ChessBoardImage</code>


</h3>


    <div class="doc doc-contents ">


      <p>a chessboard image and it's transformations</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IChessBoardImage</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChessBoardImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a chessboard image and it&#39;s transformations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

    <span class="k">def</span> <span class="nf">diffBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbOther</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cbOther</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;other is None for diff&quot;</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">ho</span><span class="p">,</span> <span class="n">wo</span> <span class="o">=</span> <span class="n">cbOther</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">cbOther</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span> <span class="o">==</span> <span class="n">ho</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">w</span> <span class="o">==</span> <span class="n">wo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;image </span><span class="si">%d</span><span class="s2"> x </span><span class="si">%d</span><span class="s2"> has to have same size as other </span><span class="si">%d</span><span class="s2"> x </span><span class="si">%d</span><span class="s2"> for diff&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">wo</span><span class="p">,</span> <span class="n">ho</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># return np.subtract(self.image,other)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">absdiff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cbOther</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyWait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="n">video</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">keyWait</span><span class="o">=</span><span class="n">keyWait</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessimage.ChessBoardImageSet" class="doc doc-heading">
            <code>ChessBoardImageSet</code>


</h3>


    <div class="doc doc-contents ">


      <p>a set of images of the current chess board</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IChessBoardImageSet</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChessBoardImageSet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a set of images of the current chess board&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vision</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">frameIndex</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span> <span class="o">=</span> <span class="n">vision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frameIndex</span> <span class="o">=</span> <span class="n">frameIndex</span>
        <span class="c1"># see https://stackoverflow.com/questions/47743246/getting-timestamp-of-each-frame-in-a-video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeStamp</span> <span class="o">=</span> <span class="n">timeStamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;chessboard&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbGUI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbIdeal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbPreMove</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbDiff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbDebug</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">placeHolder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return an empty image if the image is not available&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cbImage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">createBlank</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span>

    <span class="k">def</span> <span class="nf">debugImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbDebug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbDebug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugImage2x2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbIdeal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbDiff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbPreMove</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbDebug</span>

    <span class="k">def</span> <span class="nf">debugImage2x2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">image3</span><span class="p">,</span> <span class="n">image4</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">as2x2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placeHolder</span><span class="p">(</span><span class="n">image1</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placeHolder</span><span class="p">(</span><span class="n">image2</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placeHolder</span><span class="p">(</span><span class="n">image3</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placeHolder</span><span class="p">(</span><span class="n">image4</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">video</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugImage</span><span class="p">()</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warpAndRotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nowarp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;warp and rotate the image as necessary - add timestamp if in debug mode&quot;&quot;&quot;</span>
        <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
        <span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
        <span class="k">if</span> <span class="n">warp</span><span class="o">.</span><span class="n">warping</span> <span class="ow">or</span> <span class="n">nowarp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nowarp</span><span class="p">:</span>
                <span class="n">warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warped</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warped</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="s2">&quot;warped&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepareGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
        <span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbGUI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugImage</span><span class="p">()</span>
            <span class="n">video</span><span class="o">.</span><span class="n">addTimeStamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbGUI</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbGUI</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;gui&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">warp</span><span class="o">.</span><span class="n">warping</span><span class="p">:</span>
                <span class="n">video</span><span class="o">.</span><span class="n">drawTrapezoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbGUI</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">bgrColor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessimage.ChessBoardImageSet.placeHolder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">placeHolder</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>return an empty image if the image is not available</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">placeHolder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return an empty image if the image is not available&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cbImage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">createBlank</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessimage.ChessBoardImageSet.warpAndRotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warpAndRotate</span><span class="p">(</span><span class="n">nowarp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>warp and rotate the image as necessary - add timestamp if in debug mode</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">warpAndRotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nowarp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;warp and rotate the image as necessary - add timestamp if in debug mode&quot;&quot;&quot;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
    <span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
    <span class="k">if</span> <span class="n">warp</span><span class="o">.</span><span class="n">warping</span> <span class="ow">or</span> <span class="n">nowarp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nowarp</span><span class="p">:</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cbWarped</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="s2">&quot;warped&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessimage.ChessBoardVision" class="doc doc-heading">
            <code>ChessBoardVision</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.jsonablemixin.JsonAbleMixin" href="#pcwawc.jsonablemixin.JsonAbleMixin">JsonAbleMixin</a></code></p>


      <p>implements access to chessboard images</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IChessBoardVision</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChessBoardVision</span><span class="p">(</span><span class="n">JsonAbleMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;implements access to chessboard images&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">Video</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">inContinuousIntegration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showDebug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quitWanted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasImage</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>
        <span class="k">if</span> <span class="n">board</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">board</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">fen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">fen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warp</span> <span class="o">=</span> <span class="n">Warp</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">rotation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nowarp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">warping</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedup</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">speedup</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">readChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speedup</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasImage</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quitWanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showDebug</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quitWanted</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">frames</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chessBoardImageSet</span> <span class="o">=</span> <span class="n">ChessBoardImageSet</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">frames</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedup</span><span class="p">,</span> <span class="n">timestamp</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chessBoardImageSet</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Video</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">devicepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span> <span class="n">devicepath</span><span class="p">])</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">devicepath</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;games/videos&quot;</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
        <span class="n">savepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">projectPath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">path</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">jsonFile</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeJson</span><span class="p">(</span><span class="n">jsonFile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessimage.Warp" class="doc doc-heading">
            <code>Warp</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.yamlablemixin.YamlAbleMixin" href="#pcwawc.yamlablemixin.YamlAbleMixin">YamlAbleMixin</a></code>, <code><a class="autorefs autorefs-internal" title="pcwawc.jsonablemixin.JsonAbleMixin" href="#pcwawc.jsonablemixin.JsonAbleMixin">JsonAbleMixin</a></code></p>


      <p>holds the trapezoid points to be use for warping an image take from a peculiar angle</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IWarp</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Warp</span><span class="p">(</span><span class="n">YamlAbleMixin</span><span class="p">,</span> <span class="n">JsonAbleMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;holds the trapezoid points to be use for warping an image take from a peculiar angle&quot;&quot;&quot;</span>

    <span class="c1"># construct me from the given setting</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pointList</span><span class="o">=</span><span class="p">[],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bgrColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgrColor</span> <span class="o">=</span> <span class="n">bgrColor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointList</span> <span class="o">=</span> <span class="n">pointList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;rotate me by the given angle&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+</span> <span class="n">angle</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">%</span> <span class="mi">360</span>

    <span class="k">def</span> <span class="nf">updatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;update my points&quot;&quot;&quot;</span>
        <span class="n">pointLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pointLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warping</span> <span class="o">=</span> <span class="n">pointLen</span> <span class="o">==</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add a point with the given px,py coordinate</span>
<span class="sd">        to the warp points make sure we have a maximum of 4 warpPoints if warppoints are complete when adding reset them</span>
<span class="sd">        this allows to support click UIs that need an unwarped image before setting new warp points.</span>
<span class="sd">        px,py is irrelevant for reset&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessimage.Warp.addPoint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addPoint</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>add a point with the given px,py coordinate
to the warp points make sure we have a maximum of 4 warpPoints if warppoints are complete when adding reset them
this allows to support click UIs that need an unwarped image before setting new warp points.
px,py is irrelevant for reset</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;add a point with the given px,py coordinate</span>
<span class="sd">    to the warp points make sure we have a maximum of 4 warpPoints if warppoints are complete when adding reset them</span>
<span class="sd">    this allows to support click UIs that need an unwarped image before setting new warp points.</span>
<span class="sd">    px,py is irrelevant for reset&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessimage.Warp.rotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>rotate me by the given angle</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rotate me by the given angle&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+</span> <span class="n">angle</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">%</span> <span class="mi">360</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessimage.Warp.updatePoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">updatePoints</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>update my points</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessimage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">updatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;update my points&quot;&quot;&quot;</span>
    <span class="n">pointLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pointLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">warping</span> <span class="o">=</span> <span class="n">pointLen</span> <span class="o">==</span> <span class="mi">4</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.chesstrapezoid" class="doc doc-heading">
            <code>chesstrapezoid</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.ChessTSquare" class="doc doc-heading">
            <code>ChessTSquare</code>


</h3>


    <div class="doc doc-contents ">


      <p>a chess square in it's trapezoidal perspective</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">ISquare</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChessTSquare</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a chess square in it&#39;s trapezoidal perspective&quot;&quot;&quot;</span>

    <span class="c1"># relative position and size of original square</span>
    <span class="n">rw</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">rh</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>

    <span class="n">showDebugChange</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trapez</span><span class="p">,</span> <span class="n">square</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me from the given trapez  and square&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span> <span class="o">=</span> <span class="n">trapez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span> <span class="o">=</span> <span class="n">MinMaxStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">square</span> <span class="o">=</span> <span class="n">square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">an</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARE_NAMES</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
        <span class="c1"># rank are rows in Algebraic Notation from 1 to 8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">chess</span><span class="o">.</span><span class="n">square_rank</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
        <span class="c1"># files are columns in Algebraic Notation from A to H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">square_file</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
        <span class="c1"># https://gamedev.stackexchange.com/a/44998/133453</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postMoveImage</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rPieceRadius</span> <span class="o">=</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span> <span class="o">/</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">PieceRadiusFactor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">*</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">*</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rcx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">trapez</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPolygons</span><span class="p">(</span>
            <span class="n">trapez</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setPolygons</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trapez</span><span class="p">,</span> <span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">,</span> <span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">,</span> <span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">,</span> <span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set my relative and warped polygons from the given relative corner coordinates from top left via top right, bottom right to bottom left&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpolygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idealPolygon</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpolygon</span> <span class="o">*</span> <span class="n">trapez</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="c1"># function to use to calculate polygon</span>
        <span class="n">r2t</span> <span class="o">=</span> <span class="n">trapez</span><span class="o">.</span><span class="n">relativeToTrapezXY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">r2t</span><span class="p">(</span><span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipolygon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">transformation</span> <span class="o">==</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">ORIGINAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipolygon</span>
        <span class="k">elif</span> <span class="n">transformation</span> <span class="o">==</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">RELATIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpolygon</span>
        <span class="k">elif</span> <span class="n">transformation</span> <span class="o">==</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealPolygon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;invalid transformation </span><span class="si">%d</span><span class="s2"> for getPolygon&quot;</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getFieldState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span>
        <span class="k">if</span> <span class="n">piece</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span>
        <span class="k">elif</span> <span class="n">piece</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_WHITE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_WHITE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_BLACK</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_BLACK</span>
        <span class="c1"># this can&#39;t happen</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">drawState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw my state onto the given image with the given transformation and number of channels&quot;&quot;&quot;</span>
        <span class="c1"># default is drawing a single channel mask</span>
        <span class="n">squareImageColor</span> <span class="o">=</span> <span class="mi">64</span>
        <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="n">squareImageColor</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                    <span class="n">squareImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span>
                        <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">color</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">squareImageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">white</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                    <span class="n">squareImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span>
                        <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">color</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">squareImageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">black</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPolygon</span><span class="p">(</span><span class="n">transformation</span><span class="p">),</span> <span class="n">squareImageColor</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channels</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                    <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span><span class="p">]</span><span class="o">.</span><span class="n">color</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">Color</span><span class="o">.</span><span class="n">darkgrey</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
                        <span class="k">else</span> <span class="n">Color</span><span class="o">.</span><span class="n">lightgrey</span>
                    <span class="p">)</span>
            <span class="n">rcenter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcenter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">drawRCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rcenter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rPieceRadius</span><span class="p">,</span> <span class="n">pieceImageColor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rcx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">rcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rcx</span><span class="p">,</span> <span class="n">rcy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rxy2xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span>
        <span class="n">dw</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span>

    <span class="k">def</span> <span class="nf">addPreMoveImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxy2xy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw debug information onto the given image using the given color&quot;&quot;&quot;</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">piece</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>
            <span class="p">)</span>  <span class="c1"># @TODO piece.unicode_symbol() - needs other font!</span>
        <span class="n">squareHint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">an</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">symbol</span>
        <span class="n">rcx</span><span class="p">,</span> <span class="n">rcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcenter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">drawRCenteredText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">squareHint</span><span class="p">,</span> <span class="n">rcx</span><span class="p">,</span> <span class="n">rcy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the image of me within the given image&quot;&quot;&quot;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxy2xy</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">squareImage</span> <span class="o">=</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">squareImage</span>

    <span class="k">def</span> <span class="nf">squareChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">diffImage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check the changes analyzing the difference image of this square&quot;&quot;&quot;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxy2xy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffImage</span> <span class="o">=</span> <span class="n">diffImage</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
        <span class="n">diffSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffImage</span><span class="p">)</span>
        <span class="c1"># the value is 64 times lower then the per pixel value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span> <span class="o">=</span> <span class="n">SquareChange</span><span class="p">(</span><span class="n">diffSum</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span>

    <span class="k">def</span> <span class="nf">checkMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectState</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check a figure has been moved, so that the state of this square has changed&quot;&quot;&quot;</span>
        <span class="n">squareChange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span>
        <span class="c1"># if the whole board is valid</span>
        <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validBoard</span><span class="p">:</span>
            <span class="c1"># if we come from an stable invalid period then this is likely a move</span>
            <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidStable</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postMoveImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span>
                    <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">onPieceMoveDetected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">detectState</span><span class="o">.</span><span class="n">onPieceMoveDetected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">detectState</span><span class="o">.</span><span class="n">invalidEnd</span><span class="p">()</span>
            <span class="c1"># add the current change statistics to my statistics</span>
            <span class="n">squareChange</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="p">,</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># if we have been valid for a long enough period of time</span>
            <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validStable</span><span class="p">:</span>
                <span class="c1"># remember my image - we are ready to detect a move</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidStarted</span><span class="p">:</span>
                <span class="n">detectState</span><span class="o">.</span><span class="n">validEnd</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">trapez</span><span class="p">,</span> <span class="n">square</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me from the given trapez  and square</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trapez</span><span class="p">,</span> <span class="n">square</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me from the given trapez  and square&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span> <span class="o">=</span> <span class="n">trapez</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span> <span class="o">=</span> <span class="n">MinMaxStats</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">square</span> <span class="o">=</span> <span class="n">square</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">an</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARE_NAMES</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
    <span class="c1"># rank are rows in Algebraic Notation from 1 to 8</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">chess</span><span class="o">.</span><span class="n">square_rank</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
    <span class="c1"># files are columns in Algebraic Notation from A to H</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">square_file</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
    <span class="c1"># https://gamedev.stackexchange.com/a/44998/133453</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">postMoveImage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rPieceRadius</span> <span class="o">=</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span> <span class="o">/</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">PieceRadiusFactor</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">*</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">*</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rcx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">trapez</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setPolygons</span><span class="p">(</span>
        <span class="n">trapez</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rw</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="o">+</span> <span class="n">ChessTSquare</span><span class="o">.</span><span class="n">rh</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.checkMoved" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkMoved</span><span class="p">(</span><span class="n">detectState</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>check a figure has been moved, so that the state of this square has changed</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check a figure has been moved, so that the state of this square has changed&quot;&quot;&quot;</span>
    <span class="n">squareChange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span>
    <span class="c1"># if the whole board is valid</span>
    <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validBoard</span><span class="p">:</span>
        <span class="c1"># if we come from an stable invalid period then this is likely a move</span>
        <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidStable</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postMoveImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span>
                <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">onPieceMoveDetected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">detectState</span><span class="o">.</span><span class="n">onPieceMoveDetected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">detectState</span><span class="o">.</span><span class="n">invalidEnd</span><span class="p">()</span>
        <span class="c1"># add the current change statistics to my statistics</span>
        <span class="n">squareChange</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="p">,</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># if we have been valid for a long enough period of time</span>
        <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validStable</span><span class="p">:</span>
            <span class="c1"># remember my image - we are ready to detect a move</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preMoveImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidStarted</span><span class="p">:</span>
            <span class="n">detectState</span><span class="o">.</span><span class="n">validEnd</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.drawDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw debug information onto the given image using the given color</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw debug information onto the given image using the given color&quot;&quot;&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">piece</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># @TODO piece.unicode_symbol() - needs other font!</span>
    <span class="n">squareHint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">an</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">symbol</span>
    <span class="n">rcx</span><span class="p">,</span> <span class="n">rcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcenter</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">drawRCenteredText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">squareHint</span><span class="p">,</span> <span class="n">rcx</span><span class="p">,</span> <span class="n">rcy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.drawState" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawState</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw my state onto the given image with the given transformation and number of channels</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw my state onto the given image with the given transformation and number of channels&quot;&quot;&quot;</span>
    <span class="c1"># default is drawing a single channel mask</span>
    <span class="n">squareImageColor</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="n">squareImageColor</span>
    <span class="k">if</span> <span class="n">channels</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                <span class="n">squareImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span>
                    <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span>
                <span class="p">]</span><span class="o">.</span><span class="n">color</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">squareImageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">white</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                <span class="n">squareImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span>
                    <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span>
                <span class="p">]</span><span class="o">.</span><span class="n">color</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">squareImageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">black</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawPolygon</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPolygon</span><span class="p">(</span><span class="n">transformation</span><span class="p">),</span> <span class="n">squareImageColor</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">:</span>
                <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldState</span><span class="p">]</span><span class="o">.</span><span class="n">color</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pieceImageColor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">Color</span><span class="o">.</span><span class="n">darkgrey</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">piece</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">BLACK</span>
                    <span class="k">else</span> <span class="n">Color</span><span class="o">.</span><span class="n">lightgrey</span>
                <span class="p">)</span>
        <span class="n">rcenter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcenter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">drawRCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rcenter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rPieceRadius</span><span class="p">,</span> <span class="n">pieceImageColor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.getSquareImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getSquareImage</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the image of me within the given image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the image of me within the given image&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxy2xy</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">squareImage</span> <span class="o">=</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">squareImage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.setPolygons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setPolygons</span><span class="p">(</span><span class="n">trapez</span><span class="p">,</span> <span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">,</span> <span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">,</span> <span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">,</span> <span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>set my relative and warped polygons from the given relative corner coordinates from top left via top right, bottom right to bottom left</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setPolygons</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">trapez</span><span class="p">,</span> <span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">,</span> <span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">,</span> <span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">,</span> <span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;set my relative and warped polygons from the given relative corner coordinates from top left via top right, bottom right to bottom left&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rpolygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">),</span> <span class="p">(</span><span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">idealPolygon</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpolygon</span> <span class="o">*</span> <span class="n">trapez</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="c1"># function to use to calculate polygon</span>
    <span class="n">r2t</span> <span class="o">=</span> <span class="n">trapez</span><span class="o">.</span><span class="n">relativeToTrapezXY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">r2t</span><span class="p">(</span><span class="n">rtl_x</span><span class="p">,</span> <span class="n">rtl_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rtr_x</span><span class="p">,</span> <span class="n">rtr_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rbr_x</span><span class="p">,</span> <span class="n">rbr_y</span><span class="p">),</span> <span class="n">r2t</span><span class="p">(</span><span class="n">rbl_x</span><span class="p">,</span> <span class="n">rbl_y</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ipolygon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTSquare.squareChange" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">squareChange</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">diffImage</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>check the changes analyzing the difference image of this square</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">squareChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">diffImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check the changes analyzing the difference image of this square&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxy2xy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">squareImage</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diffImage</span> <span class="o">=</span> <span class="n">diffImage</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
    <span class="n">diffSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffImage</span><span class="p">)</span>
    <span class="c1"># the value is 64 times lower then the per pixel value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span> <span class="o">=</span> <span class="n">SquareChange</span><span class="p">(</span><span class="n">diffSum</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeStats</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentChange</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.ChessTrapezoid" class="doc doc-heading">
            <code>ChessTrapezoid</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.chesstrapezoid.Trapez2Square" href="#pcwawc.chesstrapezoid.Trapez2Square">Trapez2Square</a></code></p>


      <p>Chess board Trapezoid (UK) / Trapezium (US) / Trapez (DE)  as seen via a webcam image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ChessTrapezoid</span><span class="p">(</span><span class="n">Trapez2Square</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chess board Trapezoid (UK) / Trapezium (US) / Trapez (DE)  as seen via a webcam image&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">colorDebug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">showDebugImage</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="c1"># default radius of pieces</span>
    <span class="n">PieceRadiusFactor</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DiffSumMovingAverageLength</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trapezPoints</span><span class="p">,</span> <span class="n">idealSize</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="c1"># trapezPoints=[topLeft,topRight,bottomRight,bottomLeft]</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">//</span> <span class="mi">90</span>
        <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shifts</span><span class="p">):</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">trapezPoints</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">trapezPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">trapezPoints</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">idealSize</span><span class="p">,</span> <span class="n">video</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idealSize</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># video access (for debugging and partly hiding open cv details)</span>
        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span> <span class="o">=</span> <span class="n">idealSize</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">idealSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts_IdealSquare</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inverseTransform</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pts_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts_IdealSquare</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># dict for average Colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffSumAverage</span> <span class="o">=</span> <span class="n">MovingAverage</span><span class="p">(</span><span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">DiffSumMovingAverageLength</span><span class="p">)</span>
        <span class="c1"># trapezoid representation of squares</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">:</span>
            <span class="n">tsquare</span> <span class="o">=</span> <span class="n">ChessTSquare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">square</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">tsquare</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">square</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsquare</span>

    <span class="k">def</span> <span class="nf">relativeToIdealXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ry</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">tSquareAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the trapezoid chessboard square for the given row and column&quot;&quot;&quot;</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotateIndices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
        <span class="n">squareIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">+</span> <span class="n">col</span>
        <span class="n">square</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">[</span><span class="n">squareIndex</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">rotateIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;rotate the indices or rows and columns according to the board rotation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span>
        <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span>
        <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span><span class="p">,</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">col</span>
        <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">270</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">col</span><span class="p">,</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;invalid rotation </span><span class="si">%d</span><span class="s2"> for rotateIndices&quot;</span> <span class="o">%</span> <span class="n">rotation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">genSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generator for all chess squares&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">:</span>
            <span class="n">tsquare</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">tsquare</span>

    <span class="k">def</span> <span class="nf">drawCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw a circle onto the given image at the given center point with the given radius, color and thickness.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawRCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">rcenter</span><span class="p">,</span> <span class="n">rradius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw a circle with relative coordinates&quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rradius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span>
        <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rcenter</span>
        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeToIdealXY</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawRCenteredText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeToIdealXY</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fontBGRColor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;update the piece positions according to the given FEN&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">Board</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">piece_at</span><span class="p">(</span><span class="n">tsquare</span><span class="o">.</span><span class="n">square</span><span class="p">)</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">piece</span> <span class="o">=</span> <span class="n">piece</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">fieldState</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">getFieldState</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">drawFieldStates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">fieldStates</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">ORIGINAL</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw the states for fields with the given field states e.g. to set the mask image that will filter the trapezoid view according to piece positions when using maskImage&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">fieldState</span> <span class="ow">in</span> <span class="n">fieldStates</span><span class="p">:</span>
                    <span class="n">tsquare</span><span class="o">.</span><span class="n">drawState</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepareImageSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare the image set&quot;&quot;&quot;</span>
        <span class="n">cbWarped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpedBoardImage</span><span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">averageColors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzeColors</span><span class="p">(</span><span class="n">cbWarped</span><span class="p">)</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbWarped</span>
        <span class="n">cbIdeal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealColoredBoard</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbIdeal</span> <span class="o">=</span> <span class="n">cbIdeal</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbPreMove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveBoard</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDiff</span> <span class="o">=</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">diffBoardImage</span><span class="p">(</span><span class="n">cbIdeal</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">averageColors</span>

    <span class="k">def</span> <span class="nf">warpedBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverseTransform</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="s2">&quot;warped&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">diffSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># diffImage=self.diff(other)</span>
        <span class="c1"># return diffImage.sum()</span>
        <span class="c1"># https://stackoverflow.com/questions/17829092/opencv-cv2-absdiffimg1-img2-sum-without-temporary-img</span>
        <span class="n">diffSumValue</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;diffSum </span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">diffSumValue</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">diffSumValue</span>

    <span class="k">def</span> <span class="nf">idealColoredBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw an &#39;ideal&#39; colored board according to a given set of parameters e.g. fieldColor, pieceColor, pieceRadius&quot;&quot;&quot;</span>
        <span class="n">idealImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">drawState</span><span class="p">(</span><span class="n">idealImage</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">idealImage</span><span class="p">,</span> <span class="s2">&quot;ideal&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">preMoveBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get an image of the board as it was before any move&quot;&quot;&quot;</span>
        <span class="n">refImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">addPreMoveImage</span><span class="p">(</span><span class="n">refImage</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">refImage</span><span class="p">,</span> <span class="s2">&quot;preMove ref&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw debug information e.g. piecel symbol and an onto the given image&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">:</span>
            <span class="n">tsquare</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">drawDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">byFieldState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># get a dict of fields sorted by field state</span>
        <span class="n">sortedTSquares</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">FieldState</span><span class="p">:</span>
            <span class="n">sortedTSquares</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">sortedTSquares</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">fieldState</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsquare</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sortedTSquares</span>

    <span class="k">def</span> <span class="nf">analyzeColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the average colors per fieldState&quot;&quot;&quot;</span>
        <span class="n">byFieldState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byFieldState</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">byFieldState</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawFieldStates</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="n">fieldState</span><span class="p">],</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="n">countedFields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">byFieldState</span><span class="p">[</span><span class="n">fieldState</span><span class="p">])</span>
            <span class="n">averageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="n">averageColor</span>
            <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">showDebugImage</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">colorDebug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%15s</span><span class="s2"> (</span><span class="si">%2d</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">countedFields</span><span class="p">,</span> <span class="n">averageColor</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span>

    <span class="k">def</span> <span class="nf">optimizeColorCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">optimalSelectivity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
        <span class="n">colorStats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">41</span><span class="p">)]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;optimize the factor for the color check&quot;&quot;&quot;</span>
            <span class="n">startc</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="n">fieldColorStatsCandidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkColors</span><span class="p">(</span><span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
            <span class="n">endc</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="n">fieldColorStatsCandidate</span><span class="o">.</span><span class="n">analyzeStats</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">endc</span> <span class="o">-</span> <span class="n">startc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fieldColorStatsCandidate</span><span class="o">.</span><span class="n">minSelectivity</span> <span class="o">&gt;</span> <span class="n">optimalSelectivity</span><span class="p">:</span>
                <span class="n">optimalSelectivity</span> <span class="o">=</span> <span class="n">fieldColorStatsCandidate</span><span class="o">.</span><span class="n">minSelectivity</span>
                <span class="n">colorStats</span> <span class="o">=</span> <span class="n">fieldColorStatsCandidate</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;selectivity </span><span class="si">%5.1f</span><span class="s2"> white: </span><span class="si">%5.1f</span><span class="s2"> black: </span><span class="si">%5.1f</span><span class="s2"> &quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">minSelectivity</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">whiteSelectivity</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">blackSelectivity</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">colorStats</span>

    <span class="k">def</span> <span class="nf">checkColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check the colors against the expectation&quot;&quot;&quot;</span>
        <span class="n">byFieldState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byFieldState</span><span class="p">()</span>
        <span class="n">colorStats</span> <span class="o">=</span> <span class="n">FieldColorStats</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">byFieldState</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># https://stackoverflow.com/questions/54019108/how-to-count-the-pixels-of-a-certain-color-with-opencv</span>
            <span class="k">if</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_BLACK</span><span class="p">,</span>
                <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span><span class="p">,</span>
                <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_WHITE</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">averageColor</span> <span class="o">=</span> <span class="n">averageColors</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">averageColor</span> <span class="o">=</span> <span class="n">averageColors</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">byFieldState</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">averageColor</span><span class="o">.</span><span class="n">colorRange</span><span class="p">(</span><span class="n">rangeFactor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">colorDebug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%25s</span><span class="s2"> (</span><span class="si">%2d</span><span class="s2">): </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span> <span class="n">averageColor</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">squareImage</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">getSquareImage</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span>
                <span class="n">asExpected</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">squareImage</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">squareImage</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">pixels</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span>
                <span class="n">nonzero</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">asExpected</span><span class="p">)</span>
                <span class="n">colorStats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fieldState</span><span class="p">,</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">nonzero</span> <span class="o">/</span> <span class="n">pixels</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                <span class="c1"># self.video.showImage(asExpected,tsquare.an)</span>
        <span class="k">return</span> <span class="n">colorStats</span>

    <span class="k">def</span> <span class="nf">detectChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">,</span> <span class="n">detectState</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;detect the changes of the given imageset using the given detect state machine&quot;&quot;&quot;</span>
        <span class="n">detectState</span><span class="o">.</span><span class="n">nextFrame</span><span class="p">()</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">validChanges</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">diffSum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cbImage</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbImage</span>
        <span class="n">cbDiff</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDiff</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">squareChange</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">squareChange</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cbDiff</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="n">changes</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">]</span> <span class="o">=</span> <span class="n">squareChange</span>
            <span class="n">diffSum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">squareChange</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="n">validChanges</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># if self.frames==1:</span>
            <span class="c1">#    tsquare.preMoveImage=np.copy(tsquare.squareImage)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diffSumAverage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">diffSum</span><span class="p">)</span>
        <span class="n">diffSumDelta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffSumAverage</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">diffSum</span>
        <span class="n">detectState</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
            <span class="n">validChanges</span><span class="p">,</span> <span class="n">diffSum</span><span class="p">,</span> <span class="n">diffSumDelta</span><span class="p">,</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">meanFrameCount</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">squareChange</span> <span class="o">=</span> <span class="n">changes</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">]</span>
            <span class="n">tsquare</span><span class="o">.</span><span class="n">checkMoved</span><span class="p">(</span><span class="n">detectState</span><span class="p">)</span>

        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;validBoard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validBoard</span>
        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validChanges</span>
        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;diffSum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diffSum</span>
        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;diffSumDelta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diffSumDelta</span>
        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;validFrames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validFrames</span>
        <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;invalidFrames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidFrames</span>
        <span class="k">return</span> <span class="n">changes</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.analyzeColors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyzeColors</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the average colors per fieldState</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">analyzeColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the average colors per fieldState&quot;&quot;&quot;</span>
    <span class="n">byFieldState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byFieldState</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">byFieldState</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawFieldStates</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="n">fieldState</span><span class="p">],</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">maskImage</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="n">countedFields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">byFieldState</span><span class="p">[</span><span class="n">fieldState</span><span class="p">])</span>
        <span class="n">averageColor</span> <span class="o">=</span> <span class="n">Color</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="n">averageColor</span>
        <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">showDebugImage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">colorDebug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%15s</span><span class="s2"> (</span><span class="si">%2d</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">countedFields</span><span class="p">,</span> <span class="n">averageColor</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.checkColors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkColors</span><span class="p">(</span><span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>check the colors against the expectation</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">checkColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check the colors against the expectation&quot;&quot;&quot;</span>
    <span class="n">byFieldState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byFieldState</span><span class="p">()</span>
    <span class="n">colorStats</span> <span class="o">=</span> <span class="n">FieldColorStats</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">byFieldState</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># https://stackoverflow.com/questions/54019108/how-to-count-the-pixels-of-a-certain-color-with-opencv</span>
        <span class="k">if</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_BLACK</span><span class="p">,</span>
            <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span><span class="p">,</span>
            <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_WHITE</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">averageColor</span> <span class="o">=</span> <span class="n">averageColors</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">averageColor</span> <span class="o">=</span> <span class="n">averageColors</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">byFieldState</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">averageColor</span><span class="o">.</span><span class="n">colorRange</span><span class="p">(</span><span class="n">rangeFactor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">colorDebug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%25s</span><span class="s2"> (</span><span class="si">%2d</span><span class="s2">): </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span> <span class="n">averageColor</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">squareImage</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">getSquareImage</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span>
            <span class="n">asExpected</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">squareImage</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">squareImage</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">pixels</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span>
            <span class="n">nonzero</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">asExpected</span><span class="p">)</span>
            <span class="n">colorStats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fieldState</span><span class="p">,</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">nonzero</span> <span class="o">/</span> <span class="n">pixels</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="c1"># self.video.showImage(asExpected,tsquare.an)</span>
    <span class="k">return</span> <span class="n">colorStats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.detectChanges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detectChanges</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">,</span> <span class="n">detectState</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>detect the changes of the given imageset using the given detect state machine</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detectChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">,</span> <span class="n">detectState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;detect the changes of the given imageset using the given detect state machine&quot;&quot;&quot;</span>
    <span class="n">detectState</span><span class="o">.</span><span class="n">nextFrame</span><span class="p">()</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">validChanges</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">diffSum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cbImage</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbImage</span>
    <span class="n">cbDiff</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDiff</span>
    <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
        <span class="n">squareChange</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">squareChange</span><span class="p">(</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cbDiff</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">changes</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">]</span> <span class="o">=</span> <span class="n">squareChange</span>
        <span class="n">diffSum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">squareChange</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">validChanges</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># if self.frames==1:</span>
        <span class="c1">#    tsquare.preMoveImage=np.copy(tsquare.squareImage)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">diffSumAverage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">diffSum</span><span class="p">)</span>
    <span class="n">diffSumDelta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffSumAverage</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">diffSum</span>
    <span class="n">detectState</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
        <span class="n">validChanges</span><span class="p">,</span> <span class="n">diffSum</span><span class="p">,</span> <span class="n">diffSumDelta</span><span class="p">,</span> <span class="n">squareChange</span><span class="o">.</span><span class="n">meanFrameCount</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
        <span class="n">squareChange</span> <span class="o">=</span> <span class="n">changes</span><span class="p">[</span><span class="n">tsquare</span><span class="o">.</span><span class="n">an</span><span class="p">]</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">checkMoved</span><span class="p">(</span><span class="n">detectState</span><span class="p">)</span>

    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;validBoard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validBoard</span>
    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validChanges</span>
    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;diffSum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diffSum</span>
    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;diffSumDelta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diffSumDelta</span>
    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;validFrames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">validFrames</span>
    <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;invalidFrames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectState</span><span class="o">.</span><span class="n">invalidFrames</span>
    <span class="k">return</span> <span class="n">changes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.drawCircle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw a circle onto the given image at the given center point with the given radius, color and thickness.</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw a circle onto the given image at the given center point with the given radius, color and thickness.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.drawDebug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw debug information e.g. piecel symbol and an onto the given image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw debug information e.g. piecel symbol and an onto the given image&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">:</span>
        <span class="n">tsquare</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">drawDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.drawFieldStates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawFieldStates</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fieldStates</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">ORIGINAL</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw the states for fields with the given field states e.g. to set the mask image that will filter the trapezoid view according to piece positions when using maskImage</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawFieldStates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">fieldStates</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">ORIGINAL</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw the states for fields with the given field states e.g. to set the mask image that will filter the trapezoid view according to piece positions when using maskImage&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">fieldState</span> <span class="ow">in</span> <span class="n">fieldStates</span><span class="p">:</span>
                <span class="n">tsquare</span><span class="o">.</span><span class="n">drawState</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.drawRCircle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawRCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rcenter</span><span class="p">,</span> <span class="n">rradius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw a circle with relative coordinates</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawRCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">rcenter</span><span class="p">,</span> <span class="n">rradius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw a circle with relative coordinates&quot;&quot;&quot;</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rradius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealSize</span><span class="p">)</span>
    <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rcenter</span>
    <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeToIdealXY</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drawCircle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.genSquares" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">genSquares</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>generator for all chess squares</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">genSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generator for all chess squares&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">:</span>
        <span class="n">tsquare</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">tsquare</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.idealColoredBoard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">idealColoredBoard</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw an 'ideal' colored board according to a given set of parameters e.g. fieldColor, pieceColor, pieceRadius</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">idealColoredBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">Transformation</span><span class="o">.</span><span class="n">IDEAL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw an &#39;ideal&#39; colored board according to a given set of parameters e.g. fieldColor, pieceColor, pieceRadius&quot;&quot;&quot;</span>
    <span class="n">idealImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">drawState</span><span class="p">(</span><span class="n">idealImage</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">idealImage</span><span class="p">,</span> <span class="s2">&quot;ideal&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.preMoveBoard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preMoveBoard</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get an image of the board as it was before any move</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preMoveBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get an image of the board as it was before any move&quot;&quot;&quot;</span>
    <span class="n">refImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">addPreMoveImage</span><span class="p">(</span><span class="n">refImage</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ChessBoardImage</span><span class="p">(</span><span class="n">refImage</span><span class="p">,</span> <span class="s2">&quot;preMove ref&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.prepareImageSet" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepareImageSet</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>prepare the image set</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepareImageSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;prepare the image set&quot;&quot;&quot;</span>
    <span class="n">cbWarped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpedBoardImage</span><span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">averageColors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzeColors</span><span class="p">(</span><span class="n">cbWarped</span><span class="p">)</span>
    <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbWarped</span>
    <span class="n">cbIdeal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idealColoredBoard</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
    <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbIdeal</span> <span class="o">=</span> <span class="n">cbIdeal</span>
    <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbPreMove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveBoard</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
    <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDiff</span> <span class="o">=</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">diffBoardImage</span><span class="p">(</span><span class="n">cbIdeal</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">averageColors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.rotateIndices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotateIndices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>rotate the indices or rows and columns according to the board rotation</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotateIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rotate the indices or rows and columns according to the board rotation&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span>
    <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span>
    <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span><span class="p">,</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">col</span>
    <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">270</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">col</span><span class="p">,</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;invalid rotation </span><span class="si">%d</span><span class="s2"> for rotateIndices&quot;</span> <span class="o">%</span> <span class="n">rotation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.tSquareAt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tSquareAt</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the trapezoid chessboard square for the given row and column</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tSquareAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the trapezoid chessboard square for the given row and column&quot;&quot;&quot;</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotateIndices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
    <span class="n">squareIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="n">ChessTrapezoid</span><span class="o">.</span><span class="n">cols</span> <span class="o">+</span> <span class="n">col</span>
    <span class="n">square</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">[</span><span class="n">squareIndex</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsquares</span><span class="p">[</span><span class="n">square</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.ChessTrapezoid.updatePieces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">updatePieces</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>update the piece positions according to the given FEN</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;update the piece positions according to the given FEN&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">Board</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tsquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">piece_at</span><span class="p">(</span><span class="n">tsquare</span><span class="o">.</span><span class="n">square</span><span class="p">)</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">piece</span> <span class="o">=</span> <span class="n">piece</span>
        <span class="n">tsquare</span><span class="o">.</span><span class="n">fieldState</span> <span class="o">=</span> <span class="n">tsquare</span><span class="o">.</span><span class="n">getFieldState</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.Color" class="doc doc-heading">
            <code>Color</code>


</h3>


    <div class="doc doc-contents ">


      <p>Color definitions with maximum lightness difference and calculation of average color for a sample of square with a given fieldState</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Color</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Color definitions with maximum lightness difference and calculation of average color for a sample of square with a given fieldState&quot;&quot;&quot;</span>

    <span class="n">white</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">lightgrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
    <span class="n">darkgrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
    <span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;pick the average color from the given image&quot;&quot;&quot;</span>
        <span class="c1"># https://stackoverflow.com/a/43112217/1497139</span>
        <span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">meanStdDev</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># exotic case of a totally black picture</span>
        <span class="k">if</span> <span class="n">nonzero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixMeans</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">countNonZero</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
        <span class="c1"># https://stackoverflow.com/a/55163686/1497139</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span>
        <span class="n">nonzerotupel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">nonzero</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nonzerotupel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="n">bs</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stds</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2"> ± </span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2">, </span><span class="si">%3d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">colorRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="p">):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="n">bs</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stds</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">rangeFactor</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">bs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">gs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">)],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">bs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">gs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">)],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>

    <span class="k">def</span> <span class="nf">fixMeans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;fix the zero based means to nonzero based see https://stackoverflow.com/a/58891531/1497139&quot;&quot;&quot;</span>
        <span class="n">gmean</span><span class="p">,</span> <span class="n">bmean</span><span class="p">,</span> <span class="n">rmean</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">gstds</span><span class="p">,</span> <span class="n">bstds</span><span class="p">,</span> <span class="n">rstds</span> <span class="o">=</span> <span class="n">stds</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;means </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gmean</span><span class="p">,</span> <span class="n">bmean</span><span class="p">,</span> <span class="n">rmean</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stds  </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gstds</span><span class="p">,</span> <span class="n">bstds</span><span class="p">,</span> <span class="n">rstds</span><span class="p">))</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">pixels</span> <span class="o">/</span> <span class="n">nonzero</span>
        <span class="n">fgmean</span> <span class="o">=</span> <span class="n">gmean</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">fbmean</span> <span class="o">=</span> <span class="n">bmean</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">frmean</span> <span class="o">=</span> <span class="n">rmean</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;non-zero means </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fgmean</span><span class="p">,</span> <span class="n">fbmean</span><span class="p">,</span> <span class="n">frmean</span><span class="p">))</span>
        <span class="n">fsqsumb</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstds</span> <span class="o">*</span> <span class="n">bstds</span> <span class="o">+</span> <span class="n">bmean</span> <span class="o">*</span> <span class="n">bmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
        <span class="n">fsqsumg</span> <span class="o">=</span> <span class="p">(</span><span class="n">gstds</span> <span class="o">*</span> <span class="n">gstds</span> <span class="o">+</span> <span class="n">gmean</span> <span class="o">*</span> <span class="n">gmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
        <span class="n">fsqsumr</span> <span class="o">=</span> <span class="p">(</span><span class="n">rstds</span> <span class="o">*</span> <span class="n">rstds</span> <span class="o">+</span> <span class="n">rmean</span> <span class="o">*</span> <span class="n">rmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
        <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fsqsum </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fsqsumb</span><span class="p">,</span> <span class="n">fsqsumg</span><span class="p">,</span> <span class="n">fsqsumr</span><span class="p">))</span>
        <span class="n">fstdsb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumb</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">fbmean</span> <span class="o">*</span> <span class="n">fbmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">fstdsg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumg</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">fgmean</span> <span class="o">*</span> <span class="n">fgmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">fstdsr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumr</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">frmean</span> <span class="o">*</span> <span class="n">frmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;non-zero stds </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fstdsb</span><span class="p">,</span> <span class="n">fstdsg</span><span class="p">,</span> <span class="n">fstdsr</span><span class="p">))</span>
        <span class="n">fixedmeans</span> <span class="o">=</span> <span class="n">fgmean</span><span class="p">,</span> <span class="n">fbmean</span><span class="p">,</span> <span class="n">frmean</span>
        <span class="n">fixedstds</span> <span class="o">=</span> <span class="n">fstdsb</span><span class="p">,</span> <span class="n">fstdsg</span><span class="p">,</span> <span class="n">fstdsr</span>
        <span class="k">return</span> <span class="n">fixedmeans</span><span class="p">,</span> <span class="n">fixedstds</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.Color.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>pick the average color from the given image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;pick the average color from the given image&quot;&quot;&quot;</span>
    <span class="c1"># https://stackoverflow.com/a/43112217/1497139</span>
    <span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">meanStdDev</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">countNonZero</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># exotic case of a totally black picture</span>
    <span class="k">if</span> <span class="n">nonzero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixMeans</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.Color.fixMeans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fixMeans</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>fix the zero based means to nonzero based see https://stackoverflow.com/a/58891531/1497139</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fixMeans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;fix the zero based means to nonzero based see https://stackoverflow.com/a/58891531/1497139&quot;&quot;&quot;</span>
    <span class="n">gmean</span><span class="p">,</span> <span class="n">bmean</span><span class="p">,</span> <span class="n">rmean</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">gstds</span><span class="p">,</span> <span class="n">bstds</span><span class="p">,</span> <span class="n">rstds</span> <span class="o">=</span> <span class="n">stds</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;means </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gmean</span><span class="p">,</span> <span class="n">bmean</span><span class="p">,</span> <span class="n">rmean</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stds  </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gstds</span><span class="p">,</span> <span class="n">bstds</span><span class="p">,</span> <span class="n">rstds</span><span class="p">))</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">pixels</span> <span class="o">/</span> <span class="n">nonzero</span>
    <span class="n">fgmean</span> <span class="o">=</span> <span class="n">gmean</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="n">fbmean</span> <span class="o">=</span> <span class="n">bmean</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="n">frmean</span> <span class="o">=</span> <span class="n">rmean</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;non-zero means </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fgmean</span><span class="p">,</span> <span class="n">fbmean</span><span class="p">,</span> <span class="n">frmean</span><span class="p">))</span>
    <span class="n">fsqsumb</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstds</span> <span class="o">*</span> <span class="n">bstds</span> <span class="o">+</span> <span class="n">bmean</span> <span class="o">*</span> <span class="n">bmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
    <span class="n">fsqsumg</span> <span class="o">=</span> <span class="p">(</span><span class="n">gstds</span> <span class="o">*</span> <span class="n">gstds</span> <span class="o">+</span> <span class="n">gmean</span> <span class="o">*</span> <span class="n">gmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
    <span class="n">fsqsumr</span> <span class="o">=</span> <span class="p">(</span><span class="n">rstds</span> <span class="o">*</span> <span class="n">rstds</span> <span class="o">+</span> <span class="n">rmean</span> <span class="o">*</span> <span class="n">rmean</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixels</span>
    <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fsqsum </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fsqsumb</span><span class="p">,</span> <span class="n">fsqsumg</span><span class="p">,</span> <span class="n">fsqsumr</span><span class="p">))</span>
    <span class="n">fstdsb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumb</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">fbmean</span> <span class="o">*</span> <span class="n">fbmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">fstdsg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumg</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">fgmean</span> <span class="o">*</span> <span class="n">fgmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">fstdsr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fsqsumr</span> <span class="o">/</span> <span class="n">nonzero</span> <span class="o">-</span> <span class="n">frmean</span> <span class="o">*</span> <span class="n">frmean</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">Color</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;non-zero stds </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fstdsb</span><span class="p">,</span> <span class="n">fstdsg</span><span class="p">,</span> <span class="n">fstdsr</span><span class="p">))</span>
    <span class="n">fixedmeans</span> <span class="o">=</span> <span class="n">fgmean</span><span class="p">,</span> <span class="n">fbmean</span><span class="p">,</span> <span class="n">frmean</span>
    <span class="n">fixedstds</span> <span class="o">=</span> <span class="n">fstdsb</span><span class="p">,</span> <span class="n">fstdsg</span><span class="p">,</span> <span class="n">fstdsr</span>
    <span class="k">return</span> <span class="n">fixedmeans</span><span class="p">,</span> <span class="n">fixedstds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.FieldColorStats" class="doc doc-heading">
            <code>FieldColorStats</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Color statistics for Fields</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FieldColorStats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Color statistics for Fields&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorPercent</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">FieldState</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span> <span class="o">=</span> <span class="n">MinMaxStats</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldState</span><span class="p">,</span> <span class="n">an</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorPercent</span><span class="p">[</span><span class="n">an</span><span class="p">]</span> <span class="o">=</span> <span class="n">percent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">analyzeStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">whiteEmptyMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">whiteFilledMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_BLACK</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_WHITE</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">whiteSelectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whiteEmptyMin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">whiteFilledMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blackEmptyMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blackFilledMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_BLACK</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_WHITE</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blackSelectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackEmptyMin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackFilledMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minSelectivity</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">whiteSelectivity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackSelectivity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showDebug</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;color check </span><span class="si">%.3f</span><span class="s2"> s with factor </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">time</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">fieldState</span> <span class="ow">in</span> <span class="n">FieldState</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showFieldStateDebug</span><span class="p">(</span><span class="n">fieldState</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showFieldStateDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldState</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">fieldState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">fieldState</span><span class="p">]</span><span class="o">.</span><span class="n">formatMinMax</span><span class="p">(</span>
                    <span class="n">formatR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%2d</span><span class="s2">: </span><span class="si">%4.1f</span><span class="s2"> ± </span><span class="si">%4.1f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formatM</span><span class="o">=</span><span class="s2">&quot; </span><span class="si">%4.1f</span><span class="s2"> - </span><span class="si">%4.1f</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">showStatsDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">s for color check optimization factor: </span><span class="si">%5.1f</span><span class="s2"> selectivity min </span><span class="si">%5.1f</span><span class="s2">,white: </span><span class="si">%5.1f</span><span class="s2"> black: </span><span class="si">%5.1f</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minSelectivity</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">whiteSelectivity</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blackSelectivity</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.SquareChange" class="doc doc-heading">
            <code>SquareChange</code>


</h3>


    <div class="doc doc-contents ">


      <p>keep track of changes of a square over time</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SquareChange</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;keep track of changes of a square over time&quot;&quot;&quot;</span>

    <span class="n">meanFrameCount</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">treshold</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me from the given value with the given running stats&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">variance</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stats</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">SquareChange</span><span class="o">.</span><span class="n">meanFrameCount</span><span class="p">:</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SquareChange</span><span class="o">.</span><span class="n">treshold</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.SquareChange.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me from the given value with the given running stats</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me from the given value with the given running stats&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">variance</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">stats</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">SquareChange</span><span class="o">.</span><span class="n">meanFrameCount</span><span class="p">:</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SquareChange</span><span class="o">.</span><span class="n">treshold</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.Transformation" class="doc doc-heading">
            <code>Transformation</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.IntEnum">IntEnum</span></code></p>


      <p>Transformation kind</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Transformation</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transformation kind&quot;&quot;&quot;</span>

    <span class="n">RELATIVE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 1.0 x 1.0</span>
    <span class="n">IDEAL</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># e.g. 640x640</span>
    <span class="n">ORIGINAL</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># whatever the image size is</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chesstrapezoid.Trapez2Square" class="doc doc-heading">
            <code>Trapez2Square</code>


</h3>


    <div class="doc doc-contents ">


      <p>transform a trapez to a square and back as needed</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Trapez2Square</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a trapez to a square and back as needed&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me from the given corner points&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bl</span> <span class="o">=</span> <span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span>
        <span class="p">)</span>
        <span class="c1"># prepare the perspective transformation</span>
        <span class="c1"># https://stackoverflow.com/questions/27585355/python-open-cv-perspectivetransform</span>
        <span class="c1"># https://stackoverflow.com/a/41768610/1497139</span>
        <span class="c1"># the destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>
        <span class="c1"># the normed square described as a polygon in clockwise direction with an origin at top left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts_normedSquare</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pts_normedSquare</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts_dst</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">relativeToTrapezXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;convert a relative 0-1 based coordinate to a coordinate in the trapez&quot;&quot;&quot;</span>
        <span class="c1"># see https://math.stackexchange.com/questions/2084647/obtain-two-dimensional-linear-space-on-trapezoid-shape</span>
        <span class="c1"># https://stackoverflow.com/a/33303869/1497139</span>
        <span class="n">rxry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="c1"># target array - values are irrelevant because the will be overridden</span>
        <span class="n">xya</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rxry</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="c1"># example result:</span>
        <span class="c1"># ndarray: [[[20. 40.]]]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">xya</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">relativeTrapezToTrapezXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx1</span><span class="p">,</span> <span class="n">ry1</span><span class="p">,</span> <span class="n">rx2</span><span class="p">,</span> <span class="n">ry2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="n">rx1</span><span class="p">,</span> <span class="n">ry1</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="n">rx2</span><span class="p">,</span> <span class="n">ry1</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="n">rx2</span><span class="p">,</span> <span class="n">ry2</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="n">rx1</span><span class="p">,</span> <span class="n">ry2</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.Trapez2Square.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me from the given corner points</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me from the given corner points&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bl</span> <span class="o">=</span> <span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">polygon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span>
    <span class="p">)</span>
    <span class="c1"># prepare the perspective transformation</span>
    <span class="c1"># https://stackoverflow.com/questions/27585355/python-open-cv-perspectivetransform</span>
    <span class="c1"># https://stackoverflow.com/a/41768610/1497139</span>
    <span class="c1"># the destination</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pts_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="p">)</span>
    <span class="c1"># the normed square described as a polygon in clockwise direction with an origin at top left</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pts_normedSquare</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts_normedSquare</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts_dst</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chesstrapezoid.Trapez2Square.relativeToTrapezXY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relativeToTrapezXY</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>convert a relative 0-1 based coordinate to a coordinate in the trapez</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chesstrapezoid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">relativeToTrapezXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;convert a relative 0-1 based coordinate to a coordinate in the trapez&quot;&quot;&quot;</span>
    <span class="c1"># see https://math.stackexchange.com/questions/2084647/obtain-two-dimensional-linear-space-on-trapezoid-shape</span>
    <span class="c1"># https://stackoverflow.com/a/33303869/1497139</span>
    <span class="n">rxry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="c1"># target array - values are irrelevant because the will be overridden</span>
    <span class="n">xya</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rxry</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
    <span class="c1"># example result:</span>
    <span class="c1"># ndarray: [[[20. 40.]]]</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">xya</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.chessvision" class="doc doc-heading">
            <code>chessvision</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-10-10</p>
<p>@author: wf
see e.g. https://www.fide.com/FIDE/handbook/LawsOfChess.pdf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.FieldState" class="doc doc-heading">
            <code>FieldState</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.IntEnum">IntEnum</span></code></p>


      <p>the state of a field is a combination of the field color with a piece color + two empty field color options</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FieldState</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the state of a field is a combination of the field color with a piece color + two empty field color options&quot;&quot;&quot;</span>

    <span class="n">WHITE_EMPTY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">WHITE_WHITE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">WHITE_BLACK</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">BLACK_EMPTY</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">BLACK_WHITE</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">BLACK_BLACK</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">titles</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;white empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;white on white&quot;</span><span class="p">,</span>
            <span class="s2">&quot;black on white&quot;</span><span class="p">,</span>
            <span class="s2">&quot;black empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;white on black&quot;</span><span class="p">,</span>
            <span class="s2">&quot;black on black&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">titles</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IChessBoard" class="doc doc-heading">
            <code>IChessBoard</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>chessboard</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IChessBoard</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;chessboard&quot;&quot;&quot;</span>

    <span class="n">fen</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;Forsyth–Edwards Notation&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">divideInSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;divide the board in squares based on the given width and height&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">genSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generate all my squares&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;update the piece positions according to the given FEN&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoard.divideInSquares" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">divideInSquares</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>divide the board in squares based on the given width and height</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">divideInSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;divide the board in squares based on the given width and height&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoard.genSquares" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">genSquares</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>generate all my squares</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">genSquares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generate all my squares&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoard.updatePieces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">updatePieces</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>update the piece positions according to the given FEN</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">updatePieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;update the piece positions according to the given FEN&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IChessBoardImage" class="doc doc-heading">
            <code>IChessBoardImage</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>a single image of a chessboard</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IChessBoardImage</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a single image of a chessboard&quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;the chessboard image&quot;</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;width of the image&quot;</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;height of the image&quot;</span><span class="p">)</span>
    <span class="n">pixels</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;number of pixels of image = widthxheight&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;title of the image&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">diffBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbOther</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the difference image between me an the other chessboard image&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardImage.diffBoardImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">diffBoardImage</span><span class="p">(</span><span class="n">cbOther</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the difference image between me an the other chessboard image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">diffBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbOther</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the difference image between me an the other chessboard image&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IChessBoardImageSet" class="doc doc-heading">
            <code>IChessBoardImageSet</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>a set of Images</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IChessBoardImageSet</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a set of Images&quot;&quot;&quot;</span>

    <span class="n">frameIndex</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;index of image in a sequence&quot;</span><span class="p">)</span>
    <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">cbImage</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;original chessboard image&quot;</span><span class="p">)</span>
    <span class="n">cbGUI</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;the chessboard image to be displayed in the GUI&quot;</span><span class="p">)</span>
    <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;chessboard image warped to square size&quot;</span><span class="p">)</span>
    <span class="n">cbIdeal</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;ideal chessboard image constructed from parameters&quot;</span><span class="p">)</span>
    <span class="n">cbPreMove</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;chessboard image before move&quot;</span><span class="p">)</span>
    <span class="n">cbDiff</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;chessboard image difference to premove state&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warpAndRotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;warp and rotate the original image&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">prepareGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare the gui output e.g. for debugging&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardImageSet.prepareGUI" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepareGUI</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>prepare the gui output e.g. for debugging</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepareGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;prepare the gui output e.g. for debugging&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardImageSet.warpAndRotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warpAndRotate</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>warp and rotate the original image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">warpAndRotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;warp and rotate the original image&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IChessBoardVision" class="doc doc-heading">
            <code>IChessBoardVision</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IChessBoardVision</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;name/title of the chessboard observation&quot;</span><span class="p">)</span>
    <span class="n">warp</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;the trapzeoid coordinates for warping to a square image&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;the command line arguments/settings&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;true for debugging&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; visual observer of a chessboard e.g. with a camera - a video or still image&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;open the access to the chessboard images via the given device e.g. device number or filepath&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">readChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;read a chessboard Image and return it&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;close the access to the chessboard images&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="pcwawc.chessvision.IChessBoardVision.debug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debug</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s1">&#39;true for debugging&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>visual observer of a chessboard e.g. with a camera - a video or still image</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardVision.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>close the access to the chessboard images</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;close the access to the chessboard images&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardVision.open" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">open</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>open the access to the chessboard images via the given device e.g. device number or filepath</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;open the access to the chessboard images via the given device e.g. device number or filepath&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IChessBoardVision.readChessBoardImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readChessBoardImage</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>read a chessboard Image and return it</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">readChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read a chessboard Image and return it&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IGame" class="doc doc-heading">
            <code>IGame</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>a chess game</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IGame</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a chess game&quot;&quot;&quot;</span>

    <span class="n">pgn</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;Portable game notation&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IMoveDetector" class="doc doc-heading">
            <code>IMoveDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>a detector for moves on a chessboard image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IMoveDetector</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a detector for moves on a chessboard image&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;name of the detector&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;true for debugging&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;setup the detector with the given board, video and arguments&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">onChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;event handler for image events&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IMoveDetector.onChessBoardImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">onChessBoardImage</span><span class="p">(</span><span class="n">imageEvent</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>event handler for image events</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">onChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;event handler for image events&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IMoveDetector.setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>setup the detector with the given board, video and arguments</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;setup the detector with the given board, video and arguments&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IPiece" class="doc doc-heading">
            <code>IPiece</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>a chess piece King,Queen,Bishop,Knight,Rook or Pawn</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IPiece</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a chess piece King,Queen,Bishop,Knight,Rook or Pawn&quot;&quot;&quot;</span>

    <span class="n">color</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;color of the piece&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.ISquare" class="doc doc-heading">
            <code>ISquare</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>one of the 64 square fields of a chessboard</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ISquare</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;one of the 64 square fields of a chessboard&quot;&quot;&quot;</span>

    <span class="n">board</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;the chessboard this square belongs to&quot;</span><span class="p">)</span>
    <span class="n">an</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;algebraic notation&quot;</span><span class="p">)</span>
    <span class="n">fieldColor</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;color of the empty square&quot;</span><span class="p">)</span>
    <span class="n">piece</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s2">&quot;chess piece currently on the square - may be None&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the 1/64 subimage of this square for the given chessboard image&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.ISquare.getSquareImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getSquareImage</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the 1/64 subimage of this square for the given chessboard image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the 1/64 subimage of this square for the given chessboard image&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.chessvision.IWarp" class="doc doc-heading">
            <code>IWarp</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>trapez to square warp point handling</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IWarp</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;trapez to square warp point handling&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;rotate me with the given angle&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">updatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;update the points&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add the given point to the warp point list&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IWarp.addPoint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addPoint</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>add the given point to the warp point list</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;add the given point to the warp point list&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IWarp.rotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>rotate me with the given angle</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rotate me with the given angle&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.chessvision.IWarp.updatePoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">updatePoints</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>update the points</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/chessvision.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">updatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;update the points&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.config" class="doc doc-heading">
            <code>config</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-31</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.config.Config" class="doc doc-heading">
            <code>Config</code>


</h3>


    <div class="doc doc-contents ">


      <p>configuration for Play Chess With a WebCam</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;configuration for Play Chess With a WebCam&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configFile</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configFile</span> <span class="o">=</span> <span class="n">configFile</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">configFile</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is missing please create it if you&#39;d like to e.g. use the lichess bot api&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">configFile</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configFile</span><span class="p">),</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">configName</span><span class="o">=</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="n">configPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/.pcwawc/&quot;</span><span class="p">):</span>
        <span class="n">configFile</span> <span class="o">=</span> <span class="n">configPath</span> <span class="o">+</span> <span class="n">configName</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
        <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="n">configFile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.detectorfactory" class="doc doc-heading">
            <code>detectorfactory</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-14</p>
<p>@author: wf</p>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.detectstate" class="doc doc-heading">
            <code>detectstate</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 27.11.2019</p>
<p>we could have used:
see https://github.com/pytransitions/transitions
see https://www.zeolearn.com/magazine/writing-maintainable-code-using-sate-machines-in-python
but we don't for the time being</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.detectstate.ChangeState" class="doc doc-heading">
            <code>ChangeState</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.IntEnum">IntEnum</span></code></p>


      

              <details class="quote">
                <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ChangeState</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

    <span class="n">CALIBRATING</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">PRE_MOVE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">IN_MOVE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">POTENTIAL_MOVE</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;calibrating&quot;</span><span class="p">,</span> <span class="s2">&quot;pre move&quot;</span><span class="p">,</span> <span class="s2">&quot;in move&quot;</span><span class="p">,</span> <span class="s2">&quot;potential move&quot;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">titles</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.detectstate.DetectColorState" class="doc doc-heading">
            <code>DetectColorState</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>detect state from Color Distribution</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DetectColorState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;detect state from Color Distribution&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trapez</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span> <span class="o">=</span> <span class="n">trapez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preMoveStats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagePath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">debugImagePath</span> <span class="o">+</span> <span class="s2">&quot;states/&quot;</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagePath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">,</span> <span class="n">drawDebug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">startco</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averageColors</span> <span class="o">=</span> <span class="n">averageColors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">optimizeColorCheck</span><span class="p">(</span><span class="n">cbImage</span><span class="p">,</span> <span class="n">averageColors</span><span class="p">)</span>
        <span class="n">endco</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">drawDebug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">showStatsDebug</span><span class="p">(</span><span class="n">endco</span> <span class="o">-</span> <span class="n">startco</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawDebug</span><span class="p">()</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">minSelectivity</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preMoveStats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveStats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tSquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareState</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">preMoveStats</span><span class="p">,</span>
                    <span class="n">tSquare</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">colorPercent</span><span class="p">[</span><span class="n">tSquare</span><span class="o">.</span><span class="n">an</span><span class="p">],</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">inRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check if the given percent value is in the range for the given fieldStats&quot;&quot;&quot;</span>
        <span class="n">minValue</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">fs</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
        <span class="n">maxValue</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">fs</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
        <span class="k">return</span> <span class="n">percent</span> <span class="o">&gt;=</span> <span class="n">minValue</span> <span class="ow">and</span> <span class="n">percent</span> <span class="o">&lt;=</span> <span class="n">maxValue</span>

    <span class="k">def</span> <span class="nf">squareState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldColorStats</span><span class="p">,</span> <span class="n">tSquare</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;determine the state of the given field tSquare with the given percent of pixels that fit the expectation&quot;&quot;&quot;</span>
        <span class="n">fieldState</span> <span class="o">=</span> <span class="n">tSquare</span><span class="o">.</span><span class="n">fieldState</span>
        <span class="n">selectivity</span> <span class="o">=</span> <span class="n">fieldColorStats</span><span class="o">.</span><span class="n">minSelectivity</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="n">fieldState</span><span class="p">,</span> <span class="n">percent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveStats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tSquare</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareState</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="p">,</span>
                    <span class="n">tSquare</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">colorPercent</span><span class="p">[</span><span class="n">tSquare</span><span class="o">.</span><span class="n">an</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">percent</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">colorPercent</span><span class="p">[</span><span class="n">tSquare</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">state</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">drawRCenteredText</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">tSquare</span><span class="o">.</span><span class="n">rcx</span><span class="p">,</span> <span class="n">tSquare</span><span class="o">.</span><span class="n">rcy</span><span class="p">,</span> <span class="n">color</span>
                <span class="p">)</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/colorState-</span><span class="si">%04d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagePath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trapez</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">writeImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.detectstate.DetectColorState.inRange" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inRange</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">percent</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>check if the given percent value is in the range for the given fieldStats</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check if the given percent value is in the range for the given fieldStats&quot;&quot;&quot;</span>
    <span class="n">minValue</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">fs</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
    <span class="n">maxValue</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">fs</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
    <span class="k">return</span> <span class="n">percent</span> <span class="o">&gt;=</span> <span class="n">minValue</span> <span class="ow">and</span> <span class="n">percent</span> <span class="o">&lt;=</span> <span class="n">maxValue</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.detectstate.DetectColorState.squareState" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">squareState</span><span class="p">(</span><span class="n">fieldColorStats</span><span class="p">,</span> <span class="n">tSquare</span><span class="p">,</span> <span class="n">percent</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>determine the state of the given field tSquare with the given percent of pixels that fit the expectation</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">squareState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldColorStats</span><span class="p">,</span> <span class="n">tSquare</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;determine the state of the given field tSquare with the given percent of pixels that fit the expectation&quot;&quot;&quot;</span>
    <span class="n">fieldState</span> <span class="o">=</span> <span class="n">tSquare</span><span class="o">.</span><span class="n">fieldState</span>
    <span class="n">selectivity</span> <span class="o">=</span> <span class="n">fieldColorStats</span><span class="o">.</span><span class="n">minSelectivity</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">fieldColorStats</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="n">fieldState</span><span class="p">,</span> <span class="n">percent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.detectstate.DetectState" class="doc doc-heading">
            <code>DetectState</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>keeps track of the detections state</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DetectState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    keeps track of the detections state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">validDiffSumTreshold</span><span class="p">,</span>
        <span class="n">invalidDiffSumTreshold</span><span class="p">,</span>
        <span class="n">diffSumDeltaTreshold</span><span class="p">,</span>
        <span class="n">onPieceMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">onMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validDiffSumTreshold</span> <span class="o">=</span> <span class="n">validDiffSumTreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidDiffSumTreshold</span> <span class="o">=</span> <span class="n">invalidDiffSumTreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffSumDeltaTreshold</span> <span class="o">=</span> <span class="n">diffSumDeltaTreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onPieceMoveDetected</span> <span class="o">=</span> <span class="n">onPieceMoveDetected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onMoveDetecte</span> <span class="o">=</span> <span class="n">onMoveDetected</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validChanges</span><span class="p">,</span> <span class="n">diffSum</span><span class="p">,</span> <span class="n">diffSumDelta</span><span class="p">,</span> <span class="n">meanFrameCount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check the detection state given the current diffSum and diffSumDelta&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">&gt;</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidStable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">&gt;=</span> <span class="n">meanFrameCount</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validStable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">&gt;=</span> <span class="n">meanFrameCount</span>
        <span class="c1"># trigger statistics push if valid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidStable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">diffSum</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidDiffSumTreshold</span>
                <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diffSumDelta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffSumDeltaTreshold</span>
                <span class="ow">and</span> <span class="n">validChanges</span> <span class="o">&gt;=</span> <span class="mi">62</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span> <span class="o">=</span> <span class="n">diffSum</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">validDiffSumTreshold</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">nextFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">invalidEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">validEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.detectstate.DetectState.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">validDiffSumTreshold</span><span class="p">,</span> <span class="n">invalidDiffSumTreshold</span><span class="p">,</span> <span class="n">diffSumDeltaTreshold</span><span class="p">,</span> <span class="n">onPieceMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">validDiffSumTreshold</span><span class="p">,</span>
    <span class="n">invalidDiffSumTreshold</span><span class="p">,</span>
    <span class="n">diffSumDeltaTreshold</span><span class="p">,</span>
    <span class="n">onPieceMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">onMoveDetected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validDiffSumTreshold</span> <span class="o">=</span> <span class="n">validDiffSumTreshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">invalidDiffSumTreshold</span> <span class="o">=</span> <span class="n">invalidDiffSumTreshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diffSumDeltaTreshold</span> <span class="o">=</span> <span class="n">diffSumDeltaTreshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">onPieceMoveDetected</span> <span class="o">=</span> <span class="n">onPieceMoveDetected</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">onMoveDetecte</span> <span class="o">=</span> <span class="n">onMoveDetected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.detectstate.DetectState.check" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check</span><span class="p">(</span><span class="n">validChanges</span><span class="p">,</span> <span class="n">diffSum</span><span class="p">,</span> <span class="n">diffSumDelta</span><span class="p">,</span> <span class="n">meanFrameCount</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>check the detection state given the current diffSum and diffSumDelta</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/detectstate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validChanges</span><span class="p">,</span> <span class="n">diffSum</span><span class="p">,</span> <span class="n">diffSumDelta</span><span class="p">,</span> <span class="n">meanFrameCount</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check the detection state given the current diffSum and diffSumDelta&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">invalidStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">&gt;</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">invalidStable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">&gt;=</span> <span class="n">meanFrameCount</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validStable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">&gt;=</span> <span class="n">meanFrameCount</span>
    <span class="c1"># trigger statistics push if valid</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidStable</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">diffSum</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidDiffSumTreshold</span>
            <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diffSumDelta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffSumDeltaTreshold</span>
            <span class="ow">and</span> <span class="n">validChanges</span> <span class="o">&gt;=</span> <span class="mi">62</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span> <span class="o">=</span> <span class="n">diffSum</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">validDiffSumTreshold</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validBoard</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validFrames</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidFrames</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.environment" class="doc doc-heading">
            <code>environment</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.environment.Environment" class="doc doc-heading">
            <code>Environment</code>


</h3>


    <div class="doc doc-contents ">


      <p>Runtime Environment</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Environment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runtime Environment&quot;&quot;&quot;</span>

    <span class="n">debugImagePath</span> <span class="o">=</span> <span class="s2">&quot;/tmp/pcwawc/&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the directory in which the testMedia resides&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scriptPath</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testMediaPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span><span class="p">,</span> <span class="s2">&quot;testMedia&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testMediaPath</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">games</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/games&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">checkDir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># print (path)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creation of the directory </span><span class="si">%s</span><span class="s2"> failed&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully created the directory </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inContinuousIntegration</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        are we in a Continuous Integration Environment?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">publicCI</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;travis&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">]</span>
        <span class="n">privateCI</span> <span class="o">=</span> <span class="s2">&quot;capri.bitplan.com&quot;</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">publicCI</span> <span class="ow">or</span> <span class="n">privateCI</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment.Environment.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the directory in which the testMedia resides</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the directory in which the testMedia resides&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scriptPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scriptPath</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">testMediaPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span><span class="p">,</span> <span class="s2">&quot;testMedia&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testMediaPath</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">games</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/games&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment.Environment.inContinuousIntegration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inContinuousIntegration</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>are we in a Continuous Integration Environment?</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">inContinuousIntegration</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    are we in a Continuous Integration Environment?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">publicCI</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;travis&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">]</span>
    <span class="n">privateCI</span> <span class="o">=</span> <span class="s2">&quot;capri.bitplan.com&quot;</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">publicCI</span> <span class="ow">or</span> <span class="n">privateCI</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.environment4test" class="doc doc-heading">
            <code>environment4test</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.environment4test.Environment4Test" class="doc doc-heading">
            <code>Environment4Test</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.environment.Environment" href="#pcwawc.environment.Environment">Environment</a></code></p>


      <p>Test Environment</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Environment4Test</span><span class="p">(</span><span class="n">Environment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Environment&quot;&quot;&quot;</span>

    <span class="n">warpPointList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">([</span><span class="mi">427</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="p">[</span><span class="mi">962</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="p">[</span><span class="mi">952</span><span class="p">,</span> <span class="mi">688</span><span class="p">],</span> <span class="p">[</span><span class="mi">430</span><span class="p">,</span> <span class="mi">691</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">288</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span> <span class="p">[</span><span class="mi">1057</span><span class="p">,</span> <span class="mi">93</span><span class="p">],</span> <span class="p">[</span><span class="mi">1050</span><span class="p">,</span> <span class="mi">870</span><span class="p">],</span> <span class="p">[</span><span class="mi">262</span><span class="p">,</span> <span class="mi">866</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">132</span><span class="p">,</span> <span class="mi">89</span><span class="p">],</span> <span class="p">[</span><span class="mi">492</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="mi">497</span><span class="p">,</span> <span class="mi">451</span><span class="p">],</span> <span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="mi">462</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">143</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span> <span class="p">[</span><span class="mi">511</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="p">[</span><span class="mi">511</span><span class="p">,</span> <span class="mi">387</span><span class="p">],</span> <span class="p">[</span><span class="mi">147</span><span class="p">,</span> <span class="mi">386</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">260</span><span class="p">,</span> <span class="mi">101</span><span class="p">],</span> <span class="p">[</span><span class="mi">962</span><span class="p">,</span> <span class="mi">133</span><span class="p">],</span> <span class="p">[</span><span class="mi">950</span><span class="p">,</span> <span class="mi">815</span><span class="p">],</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">819</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">250</span><span class="p">,</span> <span class="mi">108</span><span class="p">],</span> <span class="p">[</span><span class="mi">960</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span> <span class="p">[</span><span class="mi">947</span><span class="p">,</span> <span class="mi">819</span><span class="p">],</span> <span class="p">[</span><span class="mi">242</span><span class="p">,</span> <span class="mi">828</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">277</span><span class="p">,</span> <span class="mi">106</span><span class="p">],</span> <span class="p">[</span><span class="mi">972</span><span class="p">,</span> <span class="mi">129</span><span class="p">],</span> <span class="p">[</span><span class="mi">957</span><span class="p">,</span> <span class="mi">808</span><span class="p">],</span> <span class="p">[</span><span class="mi">270</span><span class="p">,</span> <span class="mi">800</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">278</span><span class="p">,</span> <span class="mi">88</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">88</span><span class="p">],</span> <span class="p">[</span><span class="mi">1072</span><span class="p">,</span> <span class="mi">808</span><span class="p">],</span> <span class="p">[</span><span class="mi">124</span><span class="p">,</span> <span class="mi">786</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">360</span><span class="p">,</span> <span class="mi">238</span><span class="p">],</span> <span class="p">[</span><span class="mi">2380</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span> <span class="p">[</span><span class="mi">2385</span><span class="p">,</span> <span class="mi">2251</span><span class="p">],</span> <span class="p">[</span><span class="mi">407</span><span class="p">,</span> <span class="mi">2256</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">483</span><span class="p">,</span> <span class="mi">132</span><span class="p">],</span> <span class="p">[</span><span class="mi">1338</span><span class="p">,</span> <span class="mi">124</span><span class="p">],</span> <span class="p">[</span><span class="mi">1541</span><span class="p">,</span> <span class="mi">936</span><span class="p">],</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">953</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">813</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">817</span><span class="p">,</span> <span class="mi">812</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">809</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">522</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">523</span><span class="p">,</span> <span class="mi">523</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">523</span><span class="p">]),</span>
        <span class="p">([</span><span class="mi">678</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span> <span class="p">[</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span> <span class="p">[</span><span class="mi">1571</span><span class="p">,</span> <span class="mi">923</span><span class="p">],</span> <span class="p">[</span><span class="mi">686</span><span class="p">,</span> <span class="mi">896</span><span class="p">]),</span>
    <span class="p">]</span>

    <span class="n">rotations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">270</span><span class="p">]</span>

    <span class="n">fens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">EMPTY_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">START_FEN</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headless</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">headless</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">inContinuousIntegration</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">headless</span>
        <span class="n">rlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">)</span>
        <span class="n">wlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">)</span>
        <span class="n">fenlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">fens</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rlen</span> <span class="o">!=</span> <span class="n">wlen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> rotations for </span><span class="si">%d</span><span class="s2"> warpPoints&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rlen</span><span class="p">,</span> <span class="n">wlen</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fenlen</span> <span class="o">!=</span> <span class="n">wlen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> FENs for </span><span class="si">%d</span><span class="s2"> images&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fenlen</span><span class="p">,</span> <span class="n">wlen</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageInfos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">+</span> <span class="s2">&quot;chessBoard</span><span class="si">%03d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> test files for </span><span class="si">%d</span><span class="s2"> warpPoints/rotations&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">wlen</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">imageInfo</span> <span class="o">=</span> <span class="n">ImageInfo</span><span class="p">(</span>
                <span class="n">num</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;image</span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">),</span>
                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                <span class="n">fen</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">fens</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">warpPoints</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageInfos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageInfo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the image with the given number</span>

<span class="sd">        Args:</span>
<span class="sd">            num(int): the index of the image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageWithVideo</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">image</span>

    <span class="k">def</span> <span class="nf">getVideo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Video</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a Video (potentially headless)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Video: the video handler for openCV</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="n">video</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headless</span>
        <span class="k">return</span> <span class="n">video</span>

    <span class="k">def</span> <span class="nf">getImageWithVideo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the image and video</span>

<span class="sd">        Args:</span>
<span class="sd">            num(int): the number of the image</span>

<span class="sd">        Returns:</span>
<span class="sd">            image: the image</span>
<span class="sd">            video: the video display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideo</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">+</span> <span class="s2">&quot;chessBoard</span><span class="si">%03d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">readImage</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;read image </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span>

    <span class="k">def</span> <span class="nf">prepareFromImageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        prepare a test environment from the given image Inforrmation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warp</span> <span class="o">=</span> <span class="n">Warp</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">imageInfo</span><span class="o">.</span><span class="n">warpPoints</span><span class="p">))</span>
        <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">imageInfo</span><span class="o">.</span><span class="n">rotation</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageWithVideo</span><span class="p">(</span><span class="n">imageInfo</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">warp</span>

    <span class="k">def</span> <span class="nf">loadFromImageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageInfo</span><span class="p">):</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzerFromImageInfo</span><span class="p">(</span><span class="n">imageInfo</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">cbImageSet</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">readChessBoardImage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">hasImage</span><span class="p">()</span>
        <span class="n">analyzer</span><span class="o">.</span><span class="n">processImageSet</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">s for loading image </span><span class="si">%s</span><span class="s2">: </span><span class="si">%4d</span><span class="s2"> x </span><span class="si">%4d</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">),</span> <span class="n">imageInfo</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>

    <span class="k">def</span> <span class="nf">analyzerFromImageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageInfo</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;--input&quot;</span><span class="p">,</span>
                <span class="n">imageInfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                <span class="s2">&quot;--fen&quot;</span><span class="p">,</span>
                <span class="n">imageInfo</span><span class="o">.</span><span class="n">fen</span><span class="p">,</span>
                <span class="s2">&quot;--warp&quot;</span><span class="p">,</span>
                <span class="n">imageInfo</span><span class="o">.</span><span class="n">warpPointsAsString</span><span class="p">(),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">VideoAnalyzer</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">analyzer</span><span class="o">.</span><span class="n">setUpDetector</span><span class="p">()</span>
        <span class="n">analyzer</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">analyzer</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">analyzer</span>

    <span class="k">def</span> <span class="nf">getTestVideos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;baxter.avi&quot;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.avi&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">file</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.Environment4Test.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>constructor</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headless</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">headless</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">inContinuousIntegration</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">headless</span>
    <span class="n">rlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">)</span>
    <span class="n">wlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">)</span>
    <span class="n">fenlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">fens</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rlen</span> <span class="o">!=</span> <span class="n">wlen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> rotations for </span><span class="si">%d</span><span class="s2"> warpPoints&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rlen</span><span class="p">,</span> <span class="n">wlen</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fenlen</span> <span class="o">!=</span> <span class="n">wlen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> FENs for </span><span class="si">%d</span><span class="s2"> images&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fenlen</span><span class="p">,</span> <span class="n">wlen</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">imageInfos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">+</span> <span class="s2">&quot;chessBoard</span><span class="si">%03d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> test files for </span><span class="si">%d</span><span class="s2"> warpPoints/rotations&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">wlen</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">imageInfo</span> <span class="o">=</span> <span class="n">ImageInfo</span><span class="p">(</span>
            <span class="n">num</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;image</span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">fen</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">fens</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">rotations</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">warpPoints</span><span class="o">=</span><span class="n">Environment4Test</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">[</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageInfos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageInfo</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.Environment4Test.getImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getImage</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the image with the given number</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>num(int)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the index of the image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the image with the given number</span>

<span class="sd">    Args:</span>
<span class="sd">        num(int): the index of the image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageWithVideo</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.Environment4Test.getImageWithVideo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getImageWithVideo</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the image and video</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>num(int)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of the image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>image</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the image</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>video</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the video display</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getImageWithVideo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the image and video</span>

<span class="sd">    Args:</span>
<span class="sd">        num(int): the number of the image</span>

<span class="sd">    Returns:</span>
<span class="sd">        image: the image</span>
<span class="sd">        video: the video display</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideo</span><span class="p">()</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMedia</span> <span class="o">+</span> <span class="s2">&quot;chessBoard</span><span class="si">%03d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">readImage</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;read image </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.Environment4Test.getVideo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getVideo</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get a Video (potentially headless)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Video</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="pcwawc.video.Video" href="#pcwawc.video.Video">Video</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the video handler for openCV</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getVideo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Video</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a Video (potentially headless)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Video: the video handler for openCV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
    <span class="n">video</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headless</span>
    <span class="k">return</span> <span class="n">video</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.Environment4Test.prepareFromImageInfo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepareFromImageInfo</span><span class="p">(</span><span class="n">imageInfo</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>prepare a test environment from the given image Inforrmation</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepareFromImageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageInfo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    prepare a test environment from the given image Inforrmation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warp</span> <span class="o">=</span> <span class="n">Warp</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">imageInfo</span><span class="o">.</span><span class="n">warpPoints</span><span class="p">))</span>
    <span class="n">warp</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">imageInfo</span><span class="o">.</span><span class="n">rotation</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageWithVideo</span><span class="p">(</span><span class="n">imageInfo</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">warp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.environment4test.ImageInfo" class="doc doc-heading">
            <code>ImageInfo</code>


</h3>


    <div class="doc doc-contents ">


      <p>information about a chessboard test image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;information about a chessboard test image&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">fen</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">warpPoints</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fen</span> <span class="o">=</span> <span class="n">fen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warpPoints</span> <span class="o">=</span> <span class="n">warpPoints</span>

    <span class="k">def</span> <span class="nf">warpPointsAsString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warpPoints</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.environment4test.ImageInfo.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">fen</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">warpPoints</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>constructor</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/environment4test.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">fen</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">warpPoints</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fen</span> <span class="o">=</span> <span class="n">fen</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">warpPoints</span> <span class="o">=</span> <span class="n">warpPoints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.eventhandling" class="doc doc-heading">
            <code>eventhandling</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-13</p>
<p>@author: wf</p>
<p>Event handling module see https://stackoverflow.com/a/1925836/1497139</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.eventhandling.Event" class="doc doc-heading">
            <code>Event</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>an Event</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/eventhandling.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;an Event&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.eventhandling.Observable" class="doc doc-heading">
            <code>Observable</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>an Observable</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/eventhandling.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Observable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;an Observable&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="n">fn</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.field" class="doc doc-heading">
            <code>field</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.field.Field" class="doc doc-heading">
            <code>Field</code>


</h3>


    <div class="doc doc-contents ">


      <p>a single Field of a chess board as observed from a WebCam</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/field.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">ISquare</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a single Field of a chess board as observed from a WebCam&quot;&quot;&quot;</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="c1"># bgr colors</span>
    <span class="n">white</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">lightGrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="n">grey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">darkGrey</span> <span class="o">=</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">hsv_to_rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">hsv255_to_rgb255</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">v</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>

    <span class="c1"># construct me</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">board</span>
        <span class="c1"># row and column indices from 0-7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">squareIndex</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">square</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">squareIndex</span><span class="p">]</span>
        <span class="c1"># https://python-chess.readthedocs.io/en/latest/core.html - chess.WHITE=True, chess.BLACK=False</span>
        <span class="c1"># https://gamedev.stackexchange.com/a/44998/133453</span>
        <span class="c1"># A8 at 0,0 is white moving an odd number of steps horizontally and vertically will end up on a black</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="c1"># algebraic notation of field</span>
        <span class="c1"># A1 to H8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">an</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">SQUARE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">squareIndex</span><span class="p">]</span>
        <span class="c1"># center pixel position of field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxX</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxY</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgbStats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">luminance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgbColorKey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorKey</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">divideInROIs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">roiLambda</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">roiIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">rois</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">roiIndex</span><span class="p">,</span> <span class="n">roiLambda</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getPiece</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Board not set for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">an</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">chessboard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;board.chessboard not set for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">an</span><span class="p">))</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">chessboard</span><span class="o">.</span><span class="n">piece_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">square</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">piece</span>

    <span class="k">def</span> <span class="nf">getFieldState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPiece</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">piece</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_EMPTY</span>
        <span class="k">elif</span> <span class="n">piece</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_WHITE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_WHITE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldColor</span> <span class="o">==</span> <span class="n">chess</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_BLACK</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">BLACK_BLACK</span>
        <span class="c1"># this can&#39;t happen</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># analyze the color around my center pixel to the given</span>
    <span class="c1"># distance</span>
    <span class="k">def</span> <span class="nf">analyzeColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">hsv</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgbStats</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
                <span class="n">ph</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">hsv</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">+</span> <span class="n">dx</span><span class="p">]</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">+</span> <span class="n">dx</span><span class="p">]</span>
                <span class="c1"># print (&quot;(%3d,%3d)=(%3d,%3d,%3d)&quot; % (self.pcx+dx,self.pcy+dy,ph,ps,pv))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rgbStats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">luminance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span><span class="o">.</span><span class="n">c3Stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgbColorKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbStats</span><span class="o">.</span><span class="n">rgbColorKey</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span><span class="o">.</span><span class="n">colorKey</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getColor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsvStats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">hsv255_to_rgb255</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">bgr</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="c1"># print(&quot;(%3d,%3d)=(%3d,%3d,%3d) (%3d,%3d,%3d)&quot; % (self.pcx,self.pcy,h,s,v,r,g,b))</span>
        <span class="k">return</span> <span class="n">bgr</span>

    <span class="k">def</span> <span class="nf">interPolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;interpolate the given relative coordinate&quot;&quot;&quot;</span>
        <span class="c1"># interpolate the pixel</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="n">rx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">ry</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxX</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxX</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxY</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxY</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pixel</span>

    <span class="k">def</span> <span class="nf">setRect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">fieldWidth</span><span class="p">,</span> <span class="n">fieldHeight</span><span class="p">):</span>
        <span class="n">pcx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fieldWidth</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pcy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fieldHeight</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">fieldWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">fieldHeight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">=</span> <span class="n">pcx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">=</span> <span class="n">pcy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxX</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxY</span> <span class="o">=</span> <span class="n">height</span>

    <span class="k">def</span> <span class="nf">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRect</span><span class="p">()</span>
        <span class="n">squareImage</span> <span class="o">=</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">squareImage</span>

    <span class="k">def</span> <span class="nf">drawDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">detectedFieldState</span><span class="p">):</span>
        <span class="n">pcx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcx</span>
        <span class="n">pcy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcy</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
        <span class="n">fieldState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFieldState</span><span class="p">()</span>
        <span class="n">detectColor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Field</span><span class="o">.</span><span class="n">black</span>
        <span class="p">)</span>  <span class="c1"># Field.green if fieldState == detectedFieldState else Field.red</span>
        <span class="n">fieldColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColor</span><span class="p">()</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pcx</span> <span class="o">-</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span>
            <span class="n">pcy</span> <span class="o">-</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span>
            <span class="n">pcx</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span>
            <span class="n">pcy</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># outer thickness for displaying detect state: green ok red - there is an issue</span>
        <span class="n">ot</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># inner thickness for displaying the field color</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">video</span><span class="o">.</span><span class="n">drawRectangle</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">ot</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">ot</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">ot</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">ot</span><span class="p">),</span>
            <span class="n">thickness</span><span class="o">=</span><span class="n">ot</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">detectColor</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">video</span><span class="o">.</span><span class="n">drawRectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="n">it</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fieldColor</span><span class="p">)</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPiece</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">piece</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">emptyFieldColor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Field</span><span class="o">.</span><span class="n">white</span> <span class="k">if</span> <span class="n">fieldState</span> <span class="o">==</span> <span class="n">FieldState</span><span class="o">.</span><span class="n">WHITE_EMPTY</span> <span class="k">else</span> <span class="n">Field</span><span class="o">.</span><span class="n">black</span>
            <span class="p">)</span>
            <span class="n">video</span><span class="o">.</span><span class="n">drawRectangle</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">it</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">it</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">it</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">it</span><span class="p">),</span>
                <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">emptyFieldColor</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">piece</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>  <span class="c1"># piece.unicode_symbol()</span>
            <span class="n">video</span><span class="o">.</span><span class="n">drawCenteredText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">pcx</span><span class="p">,</span> <span class="n">pcy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.field.Field.interPolate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interPolate</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>interpolate the given relative coordinate</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/field.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interPolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;interpolate the given relative coordinate&quot;&quot;&quot;</span>
    <span class="c1"># interpolate the pixel</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="n">rx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">ry</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.field.FieldROI" class="doc doc-heading">
            <code>FieldROI</code>


</h3>


    <div class="doc doc-contents ">


      <p>a region of interest within the square image area of pixels represented by some pixels</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/field.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FieldROI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a region of interest within the square image area of pixels represented by some pixels&quot;&quot;&quot;</span>

    <span class="c1"># construct me from a field, a generator for relative pixels and the number of x and y steps to generate from</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">roiIndex</span><span class="p">,</span> <span class="n">relPixelLambda</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relPixelLambda</span> <span class="o">=</span> <span class="n">relPixelLambda</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roiIndex</span> <span class="o">=</span> <span class="n">roiIndex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">xsteps</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">ysteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorStats</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="p">()</span>

    <span class="c1"># analyze the given region of interest for the given image</span>
    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pixel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelList</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pixel</span>
            <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorStats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pixelList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generate a pixel list by using the generated relative position from&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">xstep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">xsteps</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ystep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ysteps</span><span class="p">):</span>
                <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relPixelLambda</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roiIndex</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">ystep</span><span class="p">)</span>
                <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shiftSafety</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
                <span class="n">pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">interPolate</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">pixel</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.field.FieldROI.pixelList" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pixelList</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>generate a pixel list by using the generated relative position from</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/field.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pixelList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generate a pixel list by using the generated relative position from&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">xstep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">xsteps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ystep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ysteps</span><span class="p">):</span>
            <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relPixelLambda</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roiIndex</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">ystep</span><span class="p">)</span>
            <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shiftSafety</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
            <span class="n">pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">interPolate</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">pixel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.field.Grid" class="doc doc-heading">
            <code>Grid</code>


</h3>


    <div class="doc doc-contents ">


      <p>Grid Info in the region of interest</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/field.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Grid</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grid Info in the region of interest&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rois</span><span class="p">,</span> <span class="n">xsteps</span><span class="p">,</span> <span class="n">ysteps</span><span class="p">,</span> <span class="n">safetyX</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">safetyY</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="n">rois</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsteps</span> <span class="o">=</span> <span class="n">xsteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysteps</span> <span class="o">=</span> <span class="n">ysteps</span>
        <span class="c1"># safety Margin in percent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safetyX</span> <span class="o">=</span> <span class="n">safetyX</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safetyY</span> <span class="o">=</span> <span class="n">safetyY</span> <span class="o">/</span> <span class="mi">100</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">pStep</span><span class="p">,</span> <span class="n">parts</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">pStep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">parts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">xstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pXStep</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Grid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pXStep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ystep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pYStep</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Grid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pYStep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roiIndex</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">roiIndex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">safeShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">safetyMargin</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">safetyMargin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">safetyMargin</span><span class="p">)</span> <span class="o">+</span> <span class="n">safetyMargin</span>

    <span class="k">def</span> <span class="nf">shiftSafety</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">safeShift</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">safetyX</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">safeShift</span><span class="p">(</span><span class="n">ry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">safetyY</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.field.SquareKind" class="doc doc-heading">
            <code>SquareKind</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.IntEnum">IntEnum</span></code></p>


      <p>kind of Square</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/field.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SquareKind</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;kind of Square&quot;&quot;&quot;</span>

    <span class="n">FIELD_WHITE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">FIELD_BLACK</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">PIECE_WHITE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">PIECE_BLACK</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;white field&quot;</span><span class="p">,</span> <span class="s2">&quot;black field&quot;</span><span class="p">,</span> <span class="s2">&quot;white piece&quot;</span><span class="p">,</span> <span class="s2">&quot;black piece&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">titles</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.fpscheck" class="doc doc-heading">
            <code>fpscheck</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.fpscheck.FPSCheck" class="doc doc-heading">
            <code>FPSCheck</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Frame per second tracker</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/fpscheck.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FPSCheck</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Frame per second tracker&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># store the start time, end time, and total number of frames</span>
        <span class="c1"># that were examined between the start and end intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numFrames</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># start the timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># increment the total number of frames examined during the</span>
        <span class="c1"># start and end intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numFrames</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># update the timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">elapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the total number of seconds between the start and</span>
        <span class="c1"># end interval</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># compute the (approximate) frames per second</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numFrames</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.game" class="doc doc-heading">
            <code>game</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.game.Game" class="doc doc-heading">
            <code>Game</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.jsonablemixin.JsonAbleMixin" href="#pcwawc.jsonablemixin.JsonAbleMixin">JsonAbleMixin</a></code></p>


      <p>keeps track of a games state</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/game.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IGame</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="n">JsonAbleMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;keeps track of a games state&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gameid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span> <span class="o">=</span> <span class="n">gameid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fen</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">STARTING_BOARD_FEN</span>
        <span class="c1"># http://www.saremba.de/chessgml/standards/pgn/pgn-complete.htm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># def __getstate__(self):</span>
    <span class="c1">#    state={}</span>
    <span class="c1">#    state[&quot;gameid&quot;]=self.gameid</span>
    <span class="c1">#    state[&quot;pgn&quot;]=self.pgn</span>
    <span class="c1">#    state[&quot;locked&quot;]=self.locked</span>
    <span class="c1">#    state[&quot;moveIndex&quot;]=self.moveIndex</span>
    <span class="c1">#    return state</span>

    <span class="c1"># def __setstate__(self, state):</span>
    <span class="c1">#    self.gameid=state[&quot;gameid&quot;]</span>
    <span class="c1">#   self.pgn=state[&quot;pgn&quot;]</span>
    <span class="c1">#    self.locked=state[&quot;locked&quot;]</span>
    <span class="c1">#    self.moveIndex=state[&quot;moveIndex&quot;]</span>
    <span class="k">def</span> <span class="nf">updateHeaders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">pgn</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">from_board</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">chessboard</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHeaders</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pgn error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">board</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gameId</span><span class="p">():</span>
        <span class="n">gameid</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;game_%Y-%m-</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gameid</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fen: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fen</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pgn: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgn</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;moveIndex: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveIndex</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.game.WebCamGame" class="doc doc-heading">
            <code>WebCamGame</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.game.Game" href="#pcwawc.game.Game">Game</a></code></p>


      <p>keeps track of a webcam games state</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/game.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WebCamGame</span><span class="p">(</span><span class="n">Game</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;keeps track of a webcam games state&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gameid</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WebCamGame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">gameid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warp</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">checkEnvironment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">games</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;games&quot;</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
        <span class="n">savepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">projectPath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">path</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">savedir</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
        <span class="n">jsonFile</span> <span class="o">=</span> <span class="n">savedir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span> <span class="o">+</span> <span class="s2">&quot;-webcamgame&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeJson</span><span class="p">(</span><span class="n">jsonFile</span><span class="p">)</span>
        <span class="n">gameJsonFile</span> <span class="o">=</span> <span class="n">savedir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeJson</span><span class="p">(</span><span class="n">gameJsonFile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fenFile</span> <span class="o">=</span> <span class="n">savedir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span> <span class="o">+</span> <span class="s2">&quot;.fen&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fen</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fenFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pgn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pgnFile</span> <span class="o">=</span> <span class="n">savedir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameid</span> <span class="o">+</span> <span class="s2">&quot;.pgn&quot;</span>
                <span class="c1"># see https://python-chess.readthedocs.io/en/latest/pgn.html</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgn</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">pgnFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">savedir</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">createNewGame</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">WebCamGame</span><span class="p">(</span><span class="n">Game</span><span class="o">.</span><span class="n">gameId</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromArgs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">game</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">webCamGame</span> <span class="o">=</span> <span class="n">WebCamGame</span><span class="o">.</span><span class="n">createNewGame</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gamepath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">game</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gamepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
                <span class="n">gamepath</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">games</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">gamepath</span>
            <span class="n">webCamGame</span> <span class="o">=</span> <span class="n">WebCamGame</span><span class="o">.</span><span class="n">readJson</span><span class="p">(</span><span class="n">gamepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">webCamGame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># self.videoAnalyzer.log(&quot;could not read %s &quot; % (gamepath))</span>
                <span class="n">webCamGame</span> <span class="o">=</span> <span class="n">webCamGame</span><span class="o">.</span><span class="n">createNewGame</span><span class="p">()</span>
        <span class="n">webCamGame</span><span class="o">.</span><span class="n">checkEnvironment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">webCamGame</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">event</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">site</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">webCamGame</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">site</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">webCamGame</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">round</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">white</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">webCamGame</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;White&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">white</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">black</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">webCamGame</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Black&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">black</span>

        <span class="k">return</span> <span class="n">webCamGame</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getWebCamGames</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">webCamGames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">webCamGame</span> <span class="o">=</span> <span class="n">WebCamGame</span><span class="o">.</span><span class="n">readJson</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">webCamGame</span><span class="p">,</span> <span class="n">WebCamGame</span><span class="p">):</span>
                    <span class="n">webCamGames</span><span class="p">[</span><span class="n">webCamGame</span><span class="o">.</span><span class="n">gameid</span><span class="p">]</span> <span class="o">=</span> <span class="n">webCamGame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;invalid json file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filePath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">webCamGames</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.histogram" class="doc doc-heading">
            <code>histogram</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-11-29</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.histogram.Histogram" class="doc doc-heading">
            <code>Histogram</code>


</h3>


    <div class="doc doc-contents ">


      <p>Image Histogram</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/histogram.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Histogram</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Image Histogram&quot;&quot;&quot;</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">histSize</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me from the given image hist Size and histRange&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="c1"># the upper boundary is exclusive</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Histogram</span><span class="o">.</span><span class="n">colors</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">(</span>
                <span class="p">[</span><span class="n">image</span><span class="p">],</span> <span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">histSize</span><span class="p">],</span> <span class="n">histRange</span><span class="p">,</span> <span class="n">accumulate</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">histindexed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">histSize</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">(</span><span class="n">histindexed</span><span class="p">)</span>
        <span class="n">bstats</span><span class="p">,</span> <span class="n">gstats</span><span class="p">,</span> <span class="n">rstats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxdelta</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">)</span>
        <span class="c1"># here we are using the color information! This should make the difference!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">bstats</span><span class="p">,</span> <span class="n">gstats</span><span class="p">,</span> <span class="n">rstats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">bl</span><span class="p">,</span> <span class="n">bu</span> <span class="o">=</span> <span class="n">bstats</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">relFactor</span><span class="p">)</span>
        <span class="n">gl</span><span class="p">,</span> <span class="n">gu</span> <span class="o">=</span> <span class="n">gstats</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">relFactor</span><span class="p">)</span>
        <span class="n">rl</span><span class="p">,</span> <span class="n">ru</span> <span class="o">=</span> <span class="n">rstats</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">relFactor</span><span class="p">)</span>
        <span class="c1"># return np.array([bl,gl,rl],dtype = &#39;uint8&#39;),np.array([bu,gu,ru],dtype=&#39;uint8&#39;)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">rl</span><span class="p">),</span> <span class="p">(</span><span class="n">bu</span><span class="p">,</span> <span class="n">gu</span><span class="p">,</span> <span class="n">ru</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">colorRangeWithFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="p">):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="n">bs</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">rangeFactor</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">bs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">gs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">)],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">bs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">gs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">rf</span><span class="p">)],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>

    <span class="k">def</span> <span class="nf">colorMask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create a color mask for this histogram and apply it to the given image&quot;&quot;&quot;</span>
        <span class="c1"># lower,upper=self.colorRange(rangeFactor)</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span>
        <span class="n">colorMask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">colorMask</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculation took </span><span class="si">%.4f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Histogram</span><span class="o">.</span><span class="n">colors</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">channel</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">plotRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Histogram</span><span class="o">.</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
            <span class="c1"># ax2.xlim([0,256])</span>

    <span class="k">def</span> <span class="nf">preparePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;color histogram&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preparePlot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotRow</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.histogram.Histogram.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">histSize</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me from the given image hist Size and histRange</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/histogram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">histSize</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">histRange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me from the given image hist Size and histRange&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hist</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="c1"># the upper boundary is exclusive</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Histogram</span><span class="o">.</span><span class="n">colors</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">(</span>
            <span class="p">[</span><span class="n">image</span><span class="p">],</span> <span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">histSize</span><span class="p">],</span> <span class="n">histRange</span><span class="p">,</span> <span class="n">accumulate</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">histindexed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">histSize</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">(</span><span class="n">histindexed</span><span class="p">)</span>
    <span class="n">bstats</span><span class="p">,</span> <span class="n">gstats</span><span class="p">,</span> <span class="n">rstats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maxdelta</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">maxdelta</span><span class="p">)</span>
    <span class="c1"># here we are using the color information! This should make the difference!</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">=</span> <span class="p">(</span><span class="n">bstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">,</span> <span class="n">gstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">,</span> <span class="n">rstats</span><span class="o">.</span><span class="n">stdv</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.histogram.Histogram.colorMask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">colorMask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>create a color mask for this histogram and apply it to the given image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/histogram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">colorMask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">rangeFactor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;create a color mask for this histogram and apply it to the given image&quot;&quot;&quot;</span>
    <span class="c1"># lower,upper=self.colorRange(rangeFactor)</span>
    <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span>
    <span class="n">colorMask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colorMask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.histogram.Stats" class="doc doc-heading">
            <code>Stats</code>


</h3>


    <div class="doc doc-contents ">


      <p>Calculate Histogram statistics see https://math.stackexchange.com/questions/857566/how-to-get-the-standard-deviation-of-a-given-histogram-image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/histogram.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Stats</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Histogram statistics see https://math.stackexchange.com/questions/857566/how-to-get-the-standard-deviation-of-a-given-histogram-image&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">histindexed</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">histindexed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqsum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">histindexed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prod</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">histindexed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqsum</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="c1"># σ²</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqsum</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqsum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxdelta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxdelta</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">255</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return a range relative to my min max range to widen e.g. by 10% use factor 1.1&quot;&quot;&quot;</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">relFactor</span>
        <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;</span> <span class="n">minValue</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">minValue</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">relFactor</span>
        <span class="k">if</span> <span class="n">upper</span> <span class="o">&gt;</span> <span class="n">maxValue</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">maxValue</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.histogram.Stats.range" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">range</span><span class="p">(</span><span class="n">relFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>return a range relative to my min max range to widen e.g. by 10% use factor 1.1</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/histogram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">255</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return a range relative to my min max range to widen e.g. by 10% use factor 1.1&quot;&quot;&quot;</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">relFactor</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;</span> <span class="n">minValue</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">minValue</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">relFactor</span>
    <span class="k">if</span> <span class="n">upper</span> <span class="o">&gt;</span> <span class="n">maxValue</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">maxValue</span>
    <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.jsonablemixin" class="doc doc-heading">
            <code>jsonablemixin</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.jsonablemixin.JsonAbleMixin" class="doc doc-heading">
            <code>JsonAbleMixin</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>allow reading and writing derived objects from a json file</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/jsonablemixin.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">JsonAbleMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;allow reading and writing derived objects from a json file&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># read me from a yaml file</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readJson</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
        <span class="n">jsonFileName</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">postfix</span><span class="p">):</span>
            <span class="n">jsonFileName</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">postfix</span>
        <span class="c1"># is there a jsonFile for the given name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">jsonFileName</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">JsonAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reading </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jsonFileName</span><span class="p">))</span>
            <span class="n">json</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonFileName</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">JsonAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span>

    <span class="c1"># write me to the json file with the given name (without postfix)</span>
    <span class="k">def</span> <span class="nf">writeJson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
        <span class="n">jsonFileName</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">postfix</span>
        <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">JsonAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;writing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jsonFileName</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">jsonFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonFileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">jsonFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
        <span class="n">jsonFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.lichessbridge" class="doc doc-heading">
            <code>lichessbridge</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-21</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.lichessbridge.Account" class="doc doc-heading">
            <code>Account</code>


</h3>


    <div class="doc doc-contents ">


      <p>" Lichess account wrapper</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/lichessbridge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot; Lichess account wrapper&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adict</span> <span class="o">=</span> <span class="n">adict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;username&quot;</span> <span class="ow">in</span> <span class="n">adict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">adict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.lichessbridge.Game" class="doc doc-heading">
            <code>Game</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="threading.Thread">Thread</span></code>, <code><a class="autorefs autorefs-internal" title="pcwawc.eventhandling.Observable" href="#pcwawc.eventhandling.Observable">Observable</a></code></p>


      <p>Lichess game</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/lichessbridge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">,</span> <span class="n">Observable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lichess game&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lichess</span><span class="p">,</span> <span class="n">game_id</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">Observable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">game_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lichess</span> <span class="o">=</span> <span class="n">lichess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">lichess</span><span class="o">.</span><span class="n">getAccount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">lichess</span><span class="o">.</span><span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">stream_game_state</span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">postChat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chat </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">abort_game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">httpError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">httpError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">resign_game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">httpError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">httpError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">make_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">httpError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">httpError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">httpError</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">httpError</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;started thread for user </span><span class="si">%s</span><span class="s2"> game </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># https://lichess.org/api#operation/botGameStream</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
            <span class="c1"># stop if we are flagged to</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isOn</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="n">event</span>
            <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eventtype</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">eventtype</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;gameFull&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">white</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;white&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">black</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">])</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;white:</span><span class="si">%s</span><span class="s2"> black:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">white</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">black</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postChat</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;gameState&quot;</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> stopped thread for game </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.lichessbridge.Lichess" class="doc doc-heading">
            <code>Lichess</code>


</h3>


    <div class="doc doc-contents ">


      <p>Lichess adapter</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/lichessbridge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Lichess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lichess adapter&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenName</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getToken</span><span class="p">(</span><span class="n">tokenName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">berserk</span><span class="o">.</span><span class="n">TokenSession</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">berserk</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getAccount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span>

    <span class="k">def</span> <span class="nf">getToken</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenname</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenname</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no token found in </span><span class="si">%s</span><span class="s2"> please add it&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">configFile</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">tokenname</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pgnImport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgn</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pgn&quot;</span><span class="p">:</span> <span class="n">pgn</span><span class="p">,</span> <span class="s2">&quot;analyse&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://lichess.org/import&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_id</span><span class="p">):</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">lichess</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">game</span>

    <span class="k">def</span> <span class="nf">challenge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oponentUserName</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;challenge </span><span class="si">%s</span><span class="s2"> by </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAccount</span><span class="p">()</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">oponentUserName</span><span class="p">))</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>
        <span class="n">client</span><span class="o">.</span><span class="n">challenges</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">oponentUserName</span><span class="p">,</span> <span class="n">rated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">waitForChallenge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pollInterval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wait for a challend and return the corresponding game&quot;&quot;&quot;</span>
        <span class="c1"># Stream whats happening and continue when we are challenged</span>
        <span class="n">in_game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>
        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAccount</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> waiting for challenge (max </span><span class="si">%d</span><span class="s2"> secs, polling every </span><span class="si">%.1f</span><span class="s2"> secs)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">pollInterval</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">in_game</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">pollInterval</span><span class="p">)</span>
            <span class="n">timeout</span> <span class="o">-=</span> <span class="n">pollInterval</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;time out waiting for challenge&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">stream_incoming_events</span><span class="p">():</span>
                <span class="n">eventtype</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">eventtype</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;gameStart&quot;</span><span class="p">:</span>
                    <span class="n">game_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;game&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                    <span class="n">in_game</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;challenge&quot;</span><span class="p">:</span>
                    <span class="n">challenge</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;challenge&quot;</span><span class="p">]</span>
                    <span class="n">game_id</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                    <span class="n">challenger</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">[</span><span class="s2">&quot;challenger&quot;</span><span class="p">]</span>
                    <span class="c1"># don&#39;t try to play against myself</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">challenger</span> <span class="o">==</span> <span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
                        <span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">accept_challenge</span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span>
                        <span class="n">in_game</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> avoiding to play against myself in game </span><span class="si">%s</span><span class="s2">&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">game_id</span><span class="p">)</span>
                        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The game </span><span class="si">%s</span><span class="s2"> has started!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">game_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">game_id</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.lichessbridge.Lichess.waitForChallenge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">waitForChallenge</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pollInterval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>wait for a challend and return the corresponding game</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/lichessbridge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">waitForChallenge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pollInterval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wait for a challend and return the corresponding game&quot;&quot;&quot;</span>
    <span class="c1"># Stream whats happening and continue when we are challenged</span>
    <span class="n">in_game</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>
    <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAccount</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> waiting for challenge (max </span><span class="si">%d</span><span class="s2"> secs, polling every </span><span class="si">%.1f</span><span class="s2"> secs)&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">pollInterval</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">in_game</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">pollInterval</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">-=</span> <span class="n">pollInterval</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;time out waiting for challenge&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">stream_incoming_events</span><span class="p">():</span>
            <span class="n">eventtype</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">eventtype</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;gameStart&quot;</span><span class="p">:</span>
                <span class="n">game_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;game&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">in_game</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">eventtype</span> <span class="o">==</span> <span class="s2">&quot;challenge&quot;</span><span class="p">:</span>
                <span class="n">challenge</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;challenge&quot;</span><span class="p">]</span>
                <span class="n">game_id</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">challenger</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">[</span><span class="s2">&quot;challenger&quot;</span><span class="p">]</span>
                <span class="c1"># don&#39;t try to play against myself</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">challenger</span> <span class="o">==</span> <span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">bots</span><span class="o">.</span><span class="n">accept_challenge</span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span>
                    <span class="n">in_game</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> avoiding to play against myself in game </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">game_id</span><span class="p">)</span>
                    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The game </span><span class="si">%s</span><span class="s2"> has started!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">game_id</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">game_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.lichessbridge.State" class="doc doc-heading">
            <code>State</code>


</h3>


    <div class="doc doc-contents ">


      <p>Lichess state wrapper</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/lichessbridge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lichess state wrapper&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adict</span> <span class="o">=</span> <span class="n">adict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;gameState&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moves</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;moves&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wtime</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;wtime&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btime</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;btime&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winc</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;winc&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binc</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;binc&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wdraw</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;wdraw&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdraw</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s2">&quot;bdraw&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.plotlib" class="doc doc-heading">
            <code>plotlib</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.plotlib.PlotLib" class="doc doc-heading">
            <code>PlotLib</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>create matplotlib based multipage diagrams e.g. color channel histograms of images</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/plotlib.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PlotLib</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create matplotlib based multipage diagrams e.g. color channel histograms of images</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">pagesize</span><span class="p">,</span> <span class="n">imagesPerPage</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagesize</span> <span class="o">=</span> <span class="n">pagesize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagewidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pagesize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagesPerPage</span> <span class="o">=</span> <span class="n">imagesPerPage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">A4</span><span class="p">(</span><span class="n">turned</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># A4 canvas</span>
        <span class="n">fig_width_cm</span> <span class="o">=</span> <span class="mi">21</span>  <span class="c1"># A4 page size in cm</span>
        <span class="n">fig_height_cm</span> <span class="o">=</span> <span class="mf">29.7</span>
        <span class="n">inches_per_cm</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.54</span>  <span class="c1"># Convert cm to inches</span>
        <span class="n">fig_width</span> <span class="o">=</span> <span class="n">fig_width_cm</span> <span class="o">*</span> <span class="n">inches_per_cm</span>  <span class="c1"># width in inches</span>
        <span class="n">fig_height</span> <span class="o">=</span> <span class="n">fig_height_cm</span> <span class="o">*</span> <span class="n">inches_per_cm</span>  <span class="c1"># height in inches</span>
        <span class="n">fig_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">turned</span><span class="p">:</span>
            <span class="n">fig_size</span> <span class="o">=</span> <span class="n">fig_size</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fig_size</span>

    <span class="k">def</span> <span class="nf">addPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">imageTitle</span><span class="p">,</span> <span class="n">xvalues</span><span class="o">=</span><span class="p">[],</span> <span class="n">yvalues</span><span class="o">=</span><span class="p">[],</span> <span class="n">isBGR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">if</span> <span class="n">isBGR</span><span class="p">:</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rgb</span><span class="p">,</span> <span class="n">imageTitle</span><span class="p">,</span> <span class="n">xvalues</span><span class="p">,</span> <span class="n">yvalues</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plotImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">imageTitle</span><span class="p">,</span> <span class="n">thumbNailSize</span><span class="p">):</span>
        <span class="n">thumbNail</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">thumbNailSize</span><span class="p">,</span> <span class="n">thumbNailSize</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">thumbNail</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">imageTitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">plotChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">prevAx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cImg</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">cImg</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prevAx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use matplotlib&#39;s sharex parameter instead of manually joining axes</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">sharex</span><span class="p">(</span><span class="n">prevAx</span><span class="p">)</span>
            <span class="n">prevAx</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plotHistogramm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">axarr</span><span class="p">,</span> <span class="n">rowIndex</span><span class="p">,</span> <span class="n">colIndex</span><span class="p">):</span>
        <span class="n">hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">image</span>
        <span class="n">prevAx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># hue</span>
        <span class="n">prevAx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span>
            <span class="n">hsv</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
        <span class="p">)</span>  <span class="c1"># saturation</span>
        <span class="n">prevAx3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prevAx1</span><span class="p">)</span>  <span class="c1"># red</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">prevAx2</span><span class="p">)</span>  <span class="c1"># green</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotChannel</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">axarr</span><span class="p">[</span><span class="n">rowIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">prevAx3</span><span class="p">)</span>  <span class="c1"># blue</span>

    <span class="k">def</span> <span class="nf">fixPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">addInfos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">infos</span><span class="p">):</span>
        <span class="n">pdfinfo</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">infodict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pdfinfo</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">inch</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">inch</span> <span class="o">*</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">startPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finishPDFPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">finishPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">infos</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addInfos</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">infos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createHistogramPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">plotType</span><span class="o">=</span><span class="n">PlotType</span><span class="o">.</span><span class="n">HISTOGRAMM</span><span class="p">,</span> <span class="n">infos</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">imageIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">startPDF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesPerPage</span>
            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">colTitles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;hue/blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saturation/green&quot;</span><span class="p">,</span> <span class="s2">&quot;value/red&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="n">PlotType</span><span class="o">.</span><span class="n">PLOT</span><span class="p">:</span>
                    <span class="n">colTitles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;diffSum&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colTitles</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesPerPage</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pagesize</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">colTitle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colTitles</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">colTitle</span><span class="p">)</span>
                <span class="n">thumbNailSize</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># self.pixel(fig,self.pageheight)</span>
                <span class="k">for</span> <span class="n">pageImageIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesPerPage</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">imageIndex</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">):</span>
                        <span class="n">image</span><span class="p">,</span> <span class="n">imageTitle</span><span class="p">,</span> <span class="n">xvalues</span><span class="p">,</span> <span class="n">yvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">imageIndex</span><span class="p">]</span>
                        <span class="c1"># see https://matplotlib.org/3.1.1/tutorials/intermediate/tight_layout_guide.html#sphx-glr-tutorials-intermediate-tight-layout-guide-py</span>
                        <span class="n">axImage</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="p">(</span><span class="n">pageImageIndex</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plotImage</span><span class="p">(</span><span class="n">axImage</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">imageTitle</span><span class="p">,</span> <span class="n">thumbNailSize</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="n">PlotType</span><span class="o">.</span><span class="n">HISTOGRAMM</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">plotHistogramm</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axarr</span><span class="p">,</span> <span class="n">pageImageIndex</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axPlot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span>
                                <span class="p">(</span><span class="n">pageImageIndex</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">axPlot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span> <span class="n">yvalues</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                            <span class="n">axarr</span><span class="p">[</span><span class="n">pageImageIndex</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                            <span class="n">axarr</span><span class="p">[</span><span class="n">pageImageIndex</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                    <span class="n">imageIndex</span> <span class="o">=</span> <span class="n">imageIndex</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># plt.title(&quot;page %d&quot; %(page))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finishPDFPage</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finishPDF</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">infos</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.plotlib.PlotLib.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pagesize</span><span class="p">,</span> <span class="n">imagesPerPage</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Constructor</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/plotlib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">pagesize</span><span class="p">,</span> <span class="n">imagesPerPage</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pagesize</span> <span class="o">=</span> <span class="n">pagesize</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pagewidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pagesize</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">imagesPerPage</span> <span class="o">=</span> <span class="n">imagesPerPage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.plotlib.PlotType" class="doc doc-heading">
            <code>PlotType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.IntEnum">IntEnum</span></code></p>


      <p>kind of Plot</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/plotlib.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PlotType</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;kind of Plot&quot;&quot;&quot;</span>

    <span class="n">HISTOGRAMM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">PLOT</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.runningstats" class="doc doc-heading">
            <code>runningstats</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.runningstats.ColorStats" class="doc doc-heading">
            <code>ColorStats</code>


</h3>


    <div class="doc doc-contents ">


      <p>calculate the RunningStats for 3 color channels like RGB or HSV simultaneously</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IStats</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ColorStats</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculate the RunningStats for 3 color channels like RGB or HSV simultaneously&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span> <span class="o">=</span> <span class="n">RunningStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span> <span class="o">=</span> <span class="n">RunningStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span> <span class="o">=</span> <span class="n">RunningStats</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">colorKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="p">()</span>
        <span class="n">other</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rgbColorKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pcwawc</span> <span class="kn">import</span> <span class="n">ciede2000</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">ciede2000</span><span class="o">.</span><span class="n">ciede2000FromRGB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;simple eucledian color distance see e.g. https://en.wikipedia.org/wiki/Color_difference&quot;&quot;&quot;</span>
        <span class="n">c1s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">c3s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">c1s</span> <span class="o">+</span> <span class="n">c2s</span> <span class="o">+</span> <span class="n">c3s</span>
        <span class="k">return</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.runningstats.ColorStats.distance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distance</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>simple eucledian color distance see e.g. https://en.wikipedia.org/wiki/Color_difference</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;simple eucledian color distance see e.g. https://en.wikipedia.org/wiki/Color_difference&quot;&quot;&quot;</span>
    <span class="n">c1s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c1Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">c2s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c2Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">c3s</span> <span class="o">=</span> <span class="n">ColorStats</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c3Stats</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">c1s</span> <span class="o">+</span> <span class="n">c2s</span> <span class="o">+</span> <span class="n">c3s</span>
    <span class="k">return</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.runningstats.IStats" class="doc doc-heading">
            <code>IStats</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zope.interface.Interface">Interface</span></code></p>


      <p>statistics interface</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IStats</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;statistics interface&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;push a value to the statistics&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get the mean value&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.runningstats.IStats.mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get the mean value</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get the mean value&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.runningstats.IStats.push" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>push a value to the statistics</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;push a value to the statistics&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.runningstats.MinMaxStats" class="doc doc-heading">
            <code>MinMaxStats</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.runningstats.RunningStats" href="#pcwawc.runningstats.RunningStats">RunningStats</a></code>, <code><span title="pcwawc.runningstats.MinMaxMixin">MinMaxMixin</span></code></p>


      <p>running statistics with minimum and maximum</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MinMaxStats</span><span class="p">(</span><span class="n">RunningStats</span><span class="p">,</span> <span class="n">MinMaxMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;running statistics with minimum and maximum&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MinMaxStats</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initMinMax</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pushMinMax</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initMinMax</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">formatMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: </span><span class="si">%.1f</span><span class="s2"> ± </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formatM</span><span class="o">=</span><span class="s2">&quot; </span><span class="si">%.1f</span><span class="s2"> - </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formatR</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">formatMinMax</span><span class="p">(</span><span class="n">formatM</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.runningstats.MovingAverage" class="doc doc-heading">
            <code>MovingAverage</code>


</h3>


    <div class="doc doc-contents ">


      <p>calculate a moving average</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IStats</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MovingAverage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculate a moving average&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">=</span> <span class="n">maxlen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;recalculate the Moving Average based on a new value&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">g</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatM</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">formatM</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.runningstats.MovingAverage.push" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>recalculate the Moving Average based on a new value</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;recalculate the Moving Average based on a new value&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.runningstats.RunningStats" class="doc doc-heading">
            <code>RunningStats</code>


</h3>


    <div class="doc doc-contents ">


      <p>calculate mean, variance and standard deviation in one pass using Welford's algorithm</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/runningstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IStats</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RunningStats</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculate mean, variance and standard deviation in one pass using Welford&#39;s algorithm&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_s</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xvalue</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xvalue</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_s</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">old_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_s</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_m</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_s</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: </span><span class="si">%.1f</span><span class="s2"> ± </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">formatS</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.simpledetector" class="doc doc-heading">
            <code>simpledetector</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-07</p>
<p>@author: tk</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.simpledetector.ImageChange" class="doc doc-heading">
            <code>ImageChange</code>


</h3>


    <div class="doc doc-contents ">


      <p>detect change of a single image</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/simpledetector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageChange</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;detect change of a single image&quot;&quot;&quot;</span>

    <span class="n">thresh</span> <span class="o">=</span> <span class="mi">150</span>
    <span class="n">gradientDelta</span> <span class="o">=</span> <span class="mf">0.725</span>
    <span class="n">averageWindow</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">MinMaxStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movingAverage</span> <span class="o">=</span> <span class="n">MovingAverage</span><span class="p">(</span><span class="n">ImageChange</span><span class="o">.</span><span class="n">averageWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newState</span><span class="o">=</span><span class="n">ChangeState</span><span class="o">.</span><span class="n">CALIBRATING</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbReferenceBW</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeState</span> <span class="o">=</span> <span class="n">newState</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stableCounter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">transitionToPreMove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeState</span> <span class="o">=</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">PRE_MOVE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minInMove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxInMove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeGray</span><span class="p">(</span><span class="n">cbImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcDifference</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasReference</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calcPixelChanges</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">makeGray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbImage</span> <span class="o">=</span> <span class="n">cbImage</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cbImage</span><span class="o">.</span><span class="n">image</span>
        <span class="n">imageGray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbImageGray</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">imageGray</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2BGR</span><span class="p">),</span> <span class="s2">&quot;gray&quot;</span>
        <span class="p">)</span>
        <span class="c1"># @TODO Make the treshold 150 configurable</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">ImageChange</span><span class="o">.</span><span class="n">thresh</span>
        <span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageBW</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">imageGray</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_TRUNC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageBW</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2BGR</span><span class="p">),</span> <span class="s2">&quot;bw&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">calcDifference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateReference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbDiffImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span><span class="o">.</span><span class="n">diffBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbReferenceBW</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageBW</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasReference</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbReferenceBW</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasReference</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbReferenceBW</span> <span class="o">=</span> <span class="n">cbImageBW</span>

    <span class="k">def</span> <span class="nf">calcPixelChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbReferenceBW</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L1</span><span class="p">)</span>
            <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span><span class="o">.</span><span class="n">pixels</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movingAverage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isStable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">movingAverage</span><span class="o">.</span><span class="n">gradient</span><span class="p">())</span>
        <span class="n">stable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">ImageChange</span><span class="o">.</span><span class="n">gradientDelta</span>
        <span class="k">if</span> <span class="n">stable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stableCounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stableCounter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">stable</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movingAverage</span><span class="o">.</span><span class="n">gradient</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%14s</span><span class="s2">: </span><span class="si">%5.1f</span><span class="s2"> Δ: </span><span class="si">%5.1f</span><span class="s2"> Ø: </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">, Σ: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeState</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">,</span>
            <span class="n">delta</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movingAverage</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formatM</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%5.1f</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">formatMinMax</span><span class="p">(</span>
                <span class="n">formatR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%4d</span><span class="s2">: </span><span class="si">%5.1f</span><span class="s2"> ± </span><span class="si">%5.1f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formatM</span><span class="o">=</span><span class="s2">&quot; </span><span class="si">%5.1f</span><span class="s2"> - </span><span class="si">%5.1f</span><span class="s2">&quot;</span>
            <span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbImageBW</span><span class="o">.</span><span class="n">pixels</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.simpledetector.Simple8x8Detector" class="doc doc-heading">
            <code>Simple8x8Detector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.simpledetector.SimpleDetector" href="#pcwawc.simpledetector.SimpleDetector">SimpleDetector</a></code></p>


      <p>a simple treshold per field detector</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/simpledetector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IMoveDetector</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Simple8x8Detector</span><span class="p">(</span><span class="n">SimpleDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a simple treshold per field detector&quot;&quot;&quot;</span>

    <span class="c1"># construct me</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">vision</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vision</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="p">[</span><span class="n">square</span><span class="o">.</span><span class="n">an</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImageChange</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageEvent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">onChessBoardImage</span><span class="p">(</span><span class="n">imageEvent</span><span class="p">)</span>
        <span class="n">cbImageSet</span> <span class="o">=</span> <span class="n">imageEvent</span><span class="o">.</span><span class="n">cbImageSet</span>
        <span class="n">vision</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">vision</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ic</span><span class="o">.</span><span class="n">changeState</span>
        <span class="k">if</span> <span class="n">vision</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">warping</span> <span class="ow">and</span> <span class="n">cs</span> <span class="o">==</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">PRE_MOVE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calcChanges</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ic</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">ImageChange</span><span class="o">.</span><span class="n">gradientDelta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">updateReference</span><span class="p">(</span><span class="n">ic</span><span class="o">.</span><span class="n">cbImageBW</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calcChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
        <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>
        <span class="c1"># TODO only do once ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">divideInSquares</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="c1"># calculate pixelChanges per square based on parts of the bigger images created by the super class</span>
        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
            <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="p">[</span><span class="n">square</span><span class="o">.</span><span class="n">an</span><span class="p">]</span>
            <span class="n">ic</span><span class="o">.</span><span class="n">cbImageBW</span> <span class="o">=</span> <span class="n">ChessBoardImage</span><span class="p">(</span>
                <span class="n">square</span><span class="o">.</span><span class="n">getSquareImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span><span class="o">.</span><span class="n">cbImageBW</span><span class="p">),</span> <span class="n">square</span><span class="o">.</span><span class="n">an</span>
            <span class="p">)</span>
            <span class="n">ic</span><span class="o">.</span><span class="n">updateReference</span><span class="p">(</span><span class="n">ic</span><span class="o">.</span><span class="n">cbImageBW</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ic</span><span class="o">.</span><span class="n">hasReference</span><span class="p">:</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">calcPixelChanges</span><span class="p">()</span>
                <span class="c1"># if self.vision.debug:</span>
                <span class="c1"># print (&quot;%4d %s: %s&quot; % (cbImageSet.frameIndex,square.an,ic))</span>

    <span class="k">def</span> <span class="nf">showDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">changesByValue</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">changesByValue</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="n">limit</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">:</span>
            <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="p">[</span><span class="n">an</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">ic</span><span class="p">))</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">onMoveDetected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcChanges</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>
        <span class="n">changesByValue</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">changesByValue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">changeIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">change</span> <span class="o">=</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keys</span><span class="p">[</span><span class="n">changeIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;frame </span><span class="si">%4d</span><span class="s2">: potential move for squares </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">frameIndex</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">changeToMove</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
            <span class="c1"># did we find a move?</span>
            <span class="k">if</span> <span class="n">move</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;change </span><span class="si">%s</span><span class="s2"> has no valid move&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">change</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showDebug</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">move</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;frame </span><span class="si">%4d</span><span class="s2">: giving up on move detection&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">frameIndex</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">onMoveDetected</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">genSquares</span><span class="p">():</span>
                <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChanges</span><span class="p">[</span><span class="n">square</span><span class="o">.</span><span class="n">an</span><span class="p">]</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fire</span><span class="p">(</span><span class="n">move</span><span class="o">=</span><span class="n">move</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.simpledetector.SimpleDetector" class="doc doc-heading">
            <code>SimpleDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.eventhandling.Observable" href="#pcwawc.eventhandling.Observable">Observable</a></code></p>


      <p>a simple treshold detector</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/simpledetector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@implementer</span><span class="p">(</span><span class="n">IMoveDetector</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SimpleDetector</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a simple treshold detector&quot;&quot;&quot;</span>

    <span class="n">calibrationWindow</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
        <span class="c1"># make me observable</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frameDebug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">vision</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span> <span class="o">=</span> <span class="n">vision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span> <span class="o">=</span> <span class="n">ImageChange</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onChessBoardImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageEvent</span><span class="p">):</span>
        <span class="n">cbImageSet</span> <span class="o">=</span> <span class="n">imageEvent</span><span class="o">.</span><span class="n">cbImageSet</span>
        <span class="n">vision</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">vision</span>
        <span class="k">if</span> <span class="n">vision</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">warping</span><span class="p">:</span>
            <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">cbWarped</span><span class="p">)</span>
            <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span>
            <span class="n">endt</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbDebug</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">debugImage2x2</span><span class="p">(</span>
                <span class="n">cbWarped</span><span class="p">,</span> <span class="n">ic</span><span class="o">.</span><span class="n">cbImageGray</span><span class="p">,</span> <span class="n">ic</span><span class="o">.</span><span class="n">cbImageBW</span><span class="p">,</span> <span class="n">ic</span><span class="o">.</span><span class="n">cbDiffImage</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span><span class="o">.</span><span class="n">hasReference</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDebug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Frame </span><span class="si">%5d</span><span class="s2"> </span><span class="si">%.3f</span><span class="s2"> s:</span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">frameIndex</span><span class="p">,</span> <span class="n">endt</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span>
        <span class="n">ics</span> <span class="o">=</span> <span class="n">ic</span><span class="o">.</span><span class="n">changeState</span>
        <span class="k">if</span> <span class="n">ics</span> <span class="o">==</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">CALIBRATING</span><span class="p">:</span>
            <span class="c1"># leave calibrating when enough stable values are available</span>
            <span class="k">if</span> <span class="n">ic</span><span class="o">.</span><span class="n">isStable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ic</span><span class="o">.</span><span class="n">stableCounter</span> <span class="o">&gt;=</span> <span class="n">SimpleDetector</span><span class="o">.</span><span class="n">calibrationWindow</span><span class="p">:</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">transitionToPreMove</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ics</span> <span class="o">==</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">PRE_MOVE</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ic</span><span class="o">.</span><span class="n">isStable</span><span class="p">():</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">changeState</span> <span class="o">=</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">IN_MOVE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="o">.</span><span class="n">transitionToPreMove</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ics</span> <span class="o">==</span> <span class="n">ChangeState</span><span class="o">.</span><span class="n">IN_MOVE</span><span class="p">:</span>
            <span class="n">ic</span><span class="o">.</span><span class="n">maxInMove</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ic</span><span class="o">.</span><span class="n">maxInMove</span><span class="p">,</span> <span class="n">ic</span><span class="o">.</span><span class="n">pixelChanges</span><span class="p">)</span>
            <span class="n">peak</span> <span class="o">=</span> <span class="n">ic</span><span class="o">.</span><span class="n">maxInMove</span> <span class="o">-</span> <span class="n">ic</span><span class="o">.</span><span class="n">minInMove</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">ic</span><span class="o">.</span><span class="n">pixelChanges</span> <span class="o">-</span> <span class="n">ic</span><span class="o">.</span><span class="n">minInMove</span>
            <span class="k">if</span> <span class="n">peak</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">relativePeak</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">peak</span>
                <span class="k">if</span> <span class="n">ic</span><span class="o">.</span><span class="n">isStable</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDebug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">relativePeak</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
                    <span class="c1"># @TODO make configurable</span>
                    <span class="k">if</span> <span class="n">relativePeak</span> <span class="o">&lt;</span> <span class="mf">0.16</span> <span class="ow">or</span> <span class="p">(</span><span class="n">relativePeak</span> <span class="o">&lt;</span> <span class="mf">0.35</span> <span class="ow">and</span> <span class="n">ic</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">onMoveDetected</span><span class="p">(</span><span class="n">cbImageSet</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onMoveDetected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageChange</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.simpledetector.SimpleDetector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/simpledetector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
    <span class="c1"># make me observable</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SimpleDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frameDebug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.video" class="doc doc-heading">
            <code>video</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.video.Video" class="doc doc-heading">
            <code>Video</code>


</h3>


    <div class="doc doc-contents ">


      <p>Video handling e.g. recording/writing</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/video.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Video</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Video handling e.g. recording/writing&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getVideo</span><span class="p">():</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="n">video</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">inContinuousIntegration</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">video</span>

    <span class="c1"># construct me with no parameters</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;frame&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># current Frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processedFrame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxFrames</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="c1"># still image ass video feature for jpg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoPause</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headless</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">pass</span>

    <span class="c1"># check whether s is an int</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Video</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
            <span class="n">deviceTitle</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deviceTitle</span> <span class="o">=</span> <span class="s2">&quot;camera </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deviceTitle</span>

    <span class="c1"># return if video is paused</span>
    <span class="k">def</span> <span class="nf">paused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span>

    <span class="c1"># pause the video</span>
    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ispaused</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span> <span class="o">=</span> <span class="n">ispaused</span>

    <span class="c1"># capture from the given device</span>
    <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Video</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxFrames</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoPause</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;setup the capturing from the given device&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="n">cap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span> <span class="o">=</span> <span class="n">FPSCheck</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">checkFilePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">raiseException</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raiseException</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ok</span>

    <span class="c1"># capture from the given video filePath</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkFilePath</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keyCheck</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">keyWait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show the image with the given title</span>

<span class="sd">        Args:</span>
<span class="sd">            image: the image to show</span>
<span class="sd">            title(str): the title of the image</span>
<span class="sd">            keyCheck(bool): wait for a a key stroke before continuing?</span>
<span class="sd">            keyWait(int): maximum number of seconds to wait for a key stroke</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span> <span class="ow">is</span> <span class="n">threading</span><span class="o">.</span><span class="n">main_thread</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;can&#39;t show image </span><span class="si">%s</span><span class="s2"> since not on mainthread&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headless</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keyCheck</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="n">keyWait</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">showAndWriteImage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/tmp/&quot;</span><span class="p">,</span> <span class="n">imageFormat</span><span class="o">=</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="n">keyCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keyWait</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">keyCheck</span><span class="p">,</span> <span class="n">keyWait</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="n">imageFormat</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># encode the image</span>
    <span class="k">def</span> <span class="nf">imencode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">imgformat</span><span class="o">=</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
        <span class="c1"># encode the frame in JPEG format</span>
        <span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">encodedImage</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imencode</span><span class="p">(</span><span class="n">imgformat</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">encodedImage</span>

    <span class="c1"># return a video frame as a jpg image</span>
    <span class="k">def</span> <span class="nf">readJpgImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postProcess</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">quitWanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="n">show</span><span class="p">,</span> <span class="n">postProcess</span><span class="p">)</span>
        <span class="n">encodedImage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># ensure the frame was read</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">encodedImage</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imencode</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="c1"># ensure the frame was successfully encoded</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">encodedImage</span><span class="p">,</span> <span class="n">quitWanted</span>

    <span class="c1"># return a video frame as a numpy array</span>
    <span class="k">def</span> <span class="nf">readFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postProcess</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># when pausing repeat previous frame</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span><span class="p">:</span>
            <span class="c1"># simply return the current frame again</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">quitWanted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxFrames</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoPause</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ispaused</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">postProcess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processedFrame</span> <span class="o">=</span> <span class="n">postProcess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># @TODO log exception</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;processing error &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processedFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processedFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="n">quitWanted</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processedFrame</span><span class="p">,</span> <span class="n">quitWanted</span>

    <span class="c1"># play the given capture</span>
    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">quitWanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">quitWanted</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># TODO decide whether to log a warning here</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fileTimeStamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">timeseparator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">timeStamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">timeseparator</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">strftime</span><span class="p">(</span>
            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="s2">&quot;%H&quot;</span> <span class="o">+</span> <span class="n">timeseparator</span> <span class="o">+</span> <span class="s2">&quot;%M&quot;</span> <span class="o">+</span> <span class="n">timeseparator</span> <span class="o">+</span> <span class="s2">&quot;%S&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">checkCap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;Capture is not initialized&quot;</span>

    <span class="c1"># get a still image</span>
    <span class="k">def</span> <span class="nf">still</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">,</span>
        <span class="n">imgformat</span><span class="o">=</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span>
        <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">printHints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">postProcess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTimeStamp</span><span class="p">(),</span> <span class="n">imgformat</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">still2File</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
            <span class="n">close</span><span class="o">=</span><span class="n">close</span><span class="p">,</span>
            <span class="n">printHints</span><span class="o">=</span><span class="n">printHints</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
            <span class="n">postProcess</span><span class="o">=</span><span class="n">postProcess</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># get a still image</span>
    <span class="k">def</span> <span class="nf">still2File</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span>
        <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">printHints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">postProcess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkCap</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">quitWanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="n">show</span><span class="p">,</span> <span class="n">postProcess</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">printHints</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;capture </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writeImage</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span>

    <span class="c1"># read an image</span>
    <span class="k">def</span> <span class="nf">readImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkFilePath</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>

    <span class="k">def</span> <span class="nf">writeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepareRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkCap</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
        <span class="c1"># Define the codec and create VideoWriter object</span>
        <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s2">&quot;XVID&quot;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># record the capture to a file with the given prefix using a timestamp</span>
    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">printHints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.avi&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">())</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareRecording</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">fps</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">printHints</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;recording </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> at </span><span class="si">%d</span><span class="s2"> fps press q to stop recording&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">quitWanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># flip the frame</span>
                <span class="c1"># frame = cv2.flip(frame,0)</span>
                <span class="k">if</span> <span class="n">quitWanted</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1"># write the  frame</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Release everything if job is finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">out</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">printHints</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">)</span>

    <span class="c1"># https://stackoverflow.com/a/22921648/1497139</span>
    <span class="k">def</span> <span class="nf">createBlank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rgb_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new image(numpy array) filled with certain color in RGB&quot;&quot;&quot;</span>
        <span class="c1"># Create black blank image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Since OpenCV uses BGR, convert the color first</span>
        <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rgb_color</span><span class="p">))</span>
        <span class="c1"># Fill image with color</span>
        <span class="n">image</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">color</span>

        <span class="k">return</span> <span class="n">image</span>

    <span class="k">def</span> <span class="nf">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get an empty image with the given width height and channels&quot;&quot;&quot;</span>
        <span class="n">emptyImage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">channels</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">emptyImage</span>

    <span class="k">def</span> <span class="nf">getEmptyImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare a trapezoid/polygon mask to focus on the square chess field seen as a trapezoid&quot;&quot;&quot;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">emptyImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">emptyImage</span>

    <span class="k">def</span> <span class="nf">maskImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the masked image that filters with the given mask&quot;&quot;&quot;</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masked</span>

    <span class="c1"># was: http://www.robindavid.fr/opencv-tutorial/chapter5-line-edge-and-contours-detection.html</span>
    <span class="c1"># is: https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_houghlines/py_houghlines.html</span>
    <span class="c1"># https://docs.opencv.org/3.4/d9/db0/tutorial_hough_lines.html</span>
    <span class="k">def</span> <span class="nf">houghTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs an Hough Transform to given image.</span>

<span class="sd">        Returns: lines&quot;&quot;&quot;</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">apertureSize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLines</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">houghTransformP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a probabilistic Hough Transform to given image.</span>

<span class="sd">        Returns: lines&quot;&quot;&quot;</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">apertureSize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">minLineLength</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">16</span>
        <span class="n">maxLineGap</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">24</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">minLineLength</span><span class="p">,</span> <span class="n">maxLineGap</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">drawTrapezoid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;loop over the given points and draw them on the image&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if there is exactly four points then close the loop</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">prev</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;draw the given polygon onto the given image with the given color&quot;&quot;&quot;</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

    <span class="c1">#  https://docs.opencv.org/4.1.2/d9/db0/tutorial_hough_lines.html</span>
    <span class="k">def</span> <span class="nf">drawLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">rho</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">rho</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">)))</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">)))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="c1"># grab the dimensions of the image</span>
        <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># if the center is None, initialize it as the center of</span>
        <span class="c1"># the image</span>
        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># perform the rotation (clockwise)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="o">-</span><span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

        <span class="c1"># return the rotated image</span>
        <span class="k">return</span> <span class="n">rotated</span>

    <span class="k">def</span> <span class="nf">warp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;apply the four point transform to obtain a birds eye view of the given image&quot;&quot;&quot;</span>
        <span class="n">warped</span> <span class="o">=</span> <span class="n">perspective</span><span class="o">.</span><span class="n">four_point_transform</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squared</span><span class="p">:</span>
            <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">warped</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">side</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">side</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">warped</span>

    <span class="k">def</span> <span class="nf">as2x2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row1col1</span><span class="p">,</span> <span class="n">row1col2</span><span class="p">,</span> <span class="n">row2col1</span><span class="p">,</span> <span class="n">row2col2</span><span class="p">,</span> <span class="n">downScale</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">row1col1</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">image3</span><span class="p">,</span> <span class="n">image4</span> <span class="o">=</span> <span class="n">row1col1</span><span class="p">,</span> <span class="n">row1col2</span><span class="p">,</span> <span class="n">row2col1</span><span class="p">,</span> <span class="n">row2col2</span>
        <span class="k">if</span> <span class="n">downScale</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">,</span> <span class="n">height</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">))</span>
            <span class="n">image2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">,</span> <span class="n">height</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">))</span>
            <span class="n">image3</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image3</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">,</span> <span class="n">height</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">))</span>
            <span class="n">image4</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image4</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">,</span> <span class="n">height</span> <span class="o">//</span> <span class="n">downScale</span><span class="p">))</span>

        <span class="n">combined1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">combined2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">image3</span><span class="p">,</span> <span class="n">image4</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">combined1</span><span class="p">,</span> <span class="n">combined2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combined</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getSubRect</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rect</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rect</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span>

    <span class="c1"># get the intensity sum of a hsv image</span>
    <span class="k">def</span> <span class="nf">sumIntensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">sumResult</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sumResult</span>

    <span class="c1"># add a timeStamp to the given frame fontScale 1.0</span>
    <span class="k">def</span> <span class="nf">addTimeStamp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">withFrames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">withFPS</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">fontScale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
        <span class="n">lineThickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># grab the current time stamp and draw it on the frame</span>
            <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">withFrames</span><span class="p">:</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">withFPS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="s2">&quot;@</span><span class="si">%.0f</span><span class="s2"> fps&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span><span class="o">.</span><span class="n">fps</span><span class="p">())</span>
            <span class="n">fontFactor</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">960</span>
            <span class="n">text_width</span><span class="p">,</span> <span class="n">text_height</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTextSize</span><span class="p">(</span>
                <span class="n">now</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontScale</span> <span class="o">*</span> <span class="n">fontFactor</span><span class="p">,</span> <span class="n">lineThickness</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># https://stackoverflow.com/a/34273603/1497139</span>
            <span class="c1"># frame = frame.copy()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawText</span><span class="p">(</span>
                <span class="n">frame</span><span class="p">,</span>
                <span class="n">now</span><span class="p">,</span>
                <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_width</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_height</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)),</span>
                <span class="n">font</span><span class="p">,</span>
                <span class="n">fontScale</span> <span class="o">*</span> <span class="n">fontFactor</span><span class="p">,</span>
                <span class="n">fontBGRColor</span><span class="p">,</span>
                <span class="n">lineThickness</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">frame</span>

    <span class="k">def</span> <span class="nf">drawCenteredText</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">fontBGRColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">fontScale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
        <span class="n">lineThickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">fontFactor</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">960</span>
        <span class="n">text_width</span><span class="p">,</span> <span class="n">text_height</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTextSize</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontScale</span> <span class="o">*</span> <span class="n">fontFactor</span><span class="p">,</span> <span class="n">lineThickness</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawText</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">text_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">font</span><span class="p">,</span>
            <span class="n">fontScale</span> <span class="o">*</span> <span class="n">fontFactor</span><span class="p">,</span>
            <span class="n">fontBGRColor</span><span class="p">,</span>
            <span class="n">lineThickness</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">drawText</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">bottomLeftCornerOfText</span><span class="p">,</span>
        <span class="n">font</span><span class="p">,</span>
        <span class="n">fontScale</span><span class="p">,</span>
        <span class="n">fontBGRColor</span><span class="p">,</span>
        <span class="n">lineThickness</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">bottomLeftCornerOfText</span><span class="p">,</span>
            <span class="n">font</span><span class="p">,</span>
            <span class="n">fontScale</span><span class="p">,</span>
            <span class="n">fontBGRColor</span><span class="p">,</span>
            <span class="n">lineThickness</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.createBlank" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">createBlank</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rgb_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create new image(numpy array) filled with certain color in RGB</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">createBlank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rgb_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create new image(numpy array) filled with certain color in RGB&quot;&quot;&quot;</span>
    <span class="c1"># Create black blank image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Since OpenCV uses BGR, convert the color first</span>
    <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rgb_color</span><span class="p">))</span>
    <span class="c1"># Fill image with color</span>
    <span class="n">image</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">color</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.drawPolygon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawPolygon</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>draw the given polygon onto the given image with the given color</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw the given polygon onto the given image with the given color&quot;&quot;&quot;</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.drawTrapezoid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawTrapezoid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>loop over the given points and draw them on the image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drawTrapezoid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;loop over the given points and draw them on the image&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># if there is exactly four points then close the loop</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">prev</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">)</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.getEmptyImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEmptyImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>prepare a trapezoid/polygon mask to focus on the square chess field seen as a trapezoid</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getEmptyImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;prepare a trapezoid/polygon mask to focus on the square chess field seen as a trapezoid&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">emptyImage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">emptyImage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.getEmptyImage4WidthAndHeight" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>get an empty image with the given width height and channels</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getEmptyImage4WidthAndHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get an empty image with the given width height and channels&quot;&quot;&quot;</span>
    <span class="n">emptyImage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">channels</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">emptyImage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.houghTransform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">houghTransform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Performs an Hough Transform to given image.</p>
<p>Returns: lines</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">houghTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs an Hough Transform to given image.</span>

<span class="sd">    Returns: lines&quot;&quot;&quot;</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">apertureSize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLines</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.houghTransformP" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">houghTransformP</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Performs a probabilistic Hough Transform to given image.</p>
<p>Returns: lines</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">houghTransformP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a probabilistic Hough Transform to given image.</span>

<span class="sd">    Returns: lines&quot;&quot;&quot;</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">apertureSize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">minLineLength</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">maxLineGap</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">24</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">minLineLength</span><span class="p">,</span> <span class="n">maxLineGap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.maskImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">maskImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>return the masked image that filters with the given mask</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">maskImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return the masked image that filters with the given mask&quot;&quot;&quot;</span>
    <span class="n">masked</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">masked</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="n">cap</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>setup the capturing from the given device</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cap</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;setup the capturing from the given device&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="n">cap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span> <span class="o">=</span> <span class="n">FPSCheck</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fpsCheck</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.showImage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">showImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">keyCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keyWait</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>show the image with the given title</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>image</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the image to show</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title(str)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the title of the image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keyCheck(bool)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wait for a a key stroke before continuing?</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keyWait(int)</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of seconds to wait for a key stroke</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keyCheck</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">keyWait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    show the image with the given title</span>

<span class="sd">    Args:</span>
<span class="sd">        image: the image to show</span>
<span class="sd">        title(str): the title of the image</span>
<span class="sd">        keyCheck(bool): wait for a a key stroke before continuing?</span>
<span class="sd">        keyWait(int): maximum number of seconds to wait for a key stroke</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span> <span class="ow">is</span> <span class="n">threading</span><span class="o">.</span><span class="n">main_thread</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;can&#39;t show image </span><span class="si">%s</span><span class="s2"> since not on mainthread&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headless</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keyCheck</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="n">keyWait</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.video.Video.warp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>apply the four point transform to obtain a birds eye view of the given image</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">warp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;apply the four point transform to obtain a birds eye view of the given image&quot;&quot;&quot;</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">perspective</span><span class="o">.</span><span class="n">four_point_transform</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">squared</span><span class="p">:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">warped</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">side</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">side</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">warped</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pcwawc.video.VideoStream" class="doc doc-heading">
            <code>VideoStream</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>run videograbbing in separate stream</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/video.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VideoStream</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;run videograbbing in separate stream&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postProcess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;VideoStream&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">show</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># initialize the thread name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postProcess</span> <span class="o">=</span> <span class="n">postProcess</span>

        <span class="c1"># initialize the variable used to indicate if the thread should</span>
        <span class="c1"># be stopped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># start the thread to read frames from the video stream</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
        <span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># keep looping infinitely until the thread is stopped</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># if the thread indicator variable is set, stop the thread</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">quitWanted</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">readFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">postProcess</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">quitWanted</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the frame most recently read</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># indicate that the thread should be stopped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.videoanalyze" class="doc doc-heading">
            <code>videoanalyze</code>


</h2>

    <div class="doc doc-contents ">

      <p>Created on 2019-12-08</p>
<p>@author: wf</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.videoanalyze.VideoAnalyzer" class="doc doc-heading">
            <code>VideoAnalyzer</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.eventhandling.Observable" href="#pcwawc.eventhandling.Observable">Observable</a></code></p>


      <p>analyzer for chessboard videos - may be used from command line or web app</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/videoanalyze.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VideoAnalyzer</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;analyzer for chessboard videos - may be used from command line or web app&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">vision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VideoAnalyzer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vision</span> <span class="o">=</span> <span class="n">ChessBoardVision</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vision</span> <span class="o">=</span> <span class="n">vision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Warp: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">warpPointList</span><span class="p">))</span>

        <span class="c1"># not recording</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videopath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">startframe</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skipping first </span><span class="si">%d</span><span class="s2"> frames&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">startframe</span><span class="p">))</span>
            <span class="k">while</span> <span class="n">video</span><span class="o">.</span><span class="n">frames</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">startframe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">readFrame</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stopVideoRecording</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">hasImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">hasImage</span>

    <span class="k">def</span> <span class="nf">hasImageSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImageSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">isRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">startVideoRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videofilename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c1"># make sure the path exists</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videopath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">videofilename</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">stopVideoRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videopath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">videofilename</span>

    <span class="k">def</span> <span class="nf">videoPause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ispaused</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">paused</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="n">ispaused</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ispaused</span>

    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">autowarp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoWarp</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">cbImageSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextImageSet</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cbImageSet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">showImage</span><span class="p">(</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">debugImage</span><span class="p">()</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">pgn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">pgn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pgn</span>

    <span class="k">def</span> <span class="nf">nextImageSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbImageSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">readChessBoardImage</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">hasImage</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processImageSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbImageSet</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbImageSet</span>

    <span class="k">def</span> <span class="nf">processImageSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbImageSet</span><span class="p">):</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">warpAndRotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nowarp</span><span class="p">)</span>
        <span class="c1"># analyze the board if warping is active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire</span><span class="p">(</span><span class="n">cbImageSet</span><span class="o">=</span><span class="n">cbImageSet</span><span class="p">)</span>
        <span class="n">cbImageSet</span><span class="o">.</span><span class="n">prepareGUI</span><span class="p">()</span>
        <span class="c1"># do we need to record?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">videopath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbWarped</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbWarped</span>
            <span class="c1"># is the output open?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># create correctly sized output</span>
                <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">prepareRecording</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">videopath</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cbWarped</span><span class="o">.</span><span class="n">height</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">videoout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cbWarped</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;wrote frame </span><span class="si">%d</span><span class="s2"> to recording &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">frames</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">findChessBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findTheChessBoard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">findTheChessBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="p">):</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="n">BoardFinder</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">findOuterCorners</span><span class="p">()</span>
        <span class="c1"># @FIXME - use property title and frame count instead</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;corners_</span><span class="si">%s</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">fileTimeStamp</span><span class="p">())</span>
        <span class="n">histograms</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">getHistograms</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="n">finder</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">showDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">finder</span><span class="o">.</span><span class="n">showPolygonDebug</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
            <span class="n">finder</span><span class="o">.</span><span class="n">showHistogramDebug</span><span class="p">(</span><span class="n">histograms</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
        <span class="n">trapez</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">trapez8x8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">pointList</span> <span class="o">=</span> <span class="n">trapez</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">corners</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="n">BoardFinder</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="n">Corners</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>

    <span class="k">def</span> <span class="nf">onMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">move</span>
        <span class="n">san</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">san</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;invalid move </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">autoWarp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nextImageSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findChessBoard</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setUpDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span> <span class="o">=</span> <span class="n">MoveDetectorFactory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">detector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vision</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span><span class="o">.</span><span class="n">onChessBoardImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onMove</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">changeDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newDetector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span><span class="o">.</span><span class="n">onChessBoardImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span> <span class="o">=</span> <span class="n">newDetector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveDetector</span><span class="o">.</span><span class="n">onChessBoardImage</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromArgs</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
        <span class="n">cmdLineArgs</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="s2">&quot;Chessboard Video analyzer&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdLineArgs</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">videoAnalyzer</span> <span class="o">=</span> <span class="n">VideoAnalyzer</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">setUpDetector</span><span class="p">()</span>
        <span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">videoAnalyzer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.webapp" class="doc doc-heading">
            <code>webapp</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.webapp.WebApp" class="doc doc-heading">
            <code>WebApp</code>


</h3>


    <div class="doc doc-contents ">


      <p>actual Play Chess with a WebCam Application - Flask calls are routed here</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/webapp.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WebApp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;actual Play Chess with a WebCam Application - Flask calls are routed here&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># construct me with the given settings</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoStream</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span> <span class="o">=</span> <span class="n">VideoAnalyzer</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">setUpDetector</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># return the index.html template content with the given message</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">game</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">game</span>
        <span class="n">game</span><span class="o">.</span><span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
        <span class="n">game</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">gameid</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">gameid</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
            <span class="s2">&quot;index.html&quot;</span><span class="p">,</span>
            <span class="n">detector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">moveDetector</span><span class="p">,</span>
            <span class="n">detectors</span><span class="o">=</span><span class="n">MoveDetectorFactory</span><span class="o">.</span><span class="n">detectors</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
            <span class="n">timeStamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">(),</span>
            <span class="n">gameid</span><span class="o">=</span><span class="n">gameid</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Home&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">photoDownload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="c1">#  https://stackoverflow.com/a/24578372/1497139</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
        <span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>

    <span class="c1"># toggle the debug flag</span>
    <span class="k">def</span> <span class="nf">chessDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="ow">not</span> <span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;debug &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;on&quot;</span> <span class="k">if</span> <span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># automatically find the chess board</span>
    <span class="k">def</span> <span class="nf">chessFindBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">hasImage</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">findChessBoard</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2"> found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;can&#39;t find chess board - video is not active&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessTakeback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;take back&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">takeback</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;can not take back any more moves&quot;</span>
            <span class="k">if</span> <span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">showDebug</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gameid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">lockGame</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;chess game &lt;a href=&#39;/chess/games/</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt; saved(locked)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">gameid</span><span class="p">,</span>
            <span class="n">gameid</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessGameColors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;color update in progress&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;forward&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">indexException</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&lt;span style=&#39;color:red&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/span&gt;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">move</span><span class="p">:</span>
                <span class="n">move</span> <span class="o">=</span> <span class="n">move</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">ucimove</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;move </span><span class="si">%s</span><span class="s2"> -&gt; fen= </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">showDebug</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">timeStamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessGameState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gameid</span><span class="p">):</span>
        <span class="n">fen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">fen</span>
        <span class="n">pgn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">pgn</span>
        <span class="n">gameStateJson</span> <span class="o">=</span> <span class="n">jsonify</span><span class="p">(</span>
            <span class="n">fen</span><span class="o">=</span><span class="n">fen</span><span class="p">,</span>
            <span class="n">pgn</span><span class="o">=</span><span class="n">pgn</span><span class="p">,</span>
            <span class="n">gameid</span><span class="o">=</span><span class="n">gameid</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">WebApp</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="c1"># if WebApp.debug:</span>
        <span class="c1">#    self.log(gameStateJson)</span>
        <span class="k">return</span> <span class="n">gameStateJson</span>

    <span class="k">def</span> <span class="nf">chessSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;settings&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;detector&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">newDetectorName</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;detector&quot;</span><span class="p">]</span>
            <span class="n">newDetector</span> <span class="o">=</span> <span class="n">MoveDetectorFactory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">newDetectorName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">changeDetector</span><span class="p">(</span><span class="n">newDetector</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;changing detector to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newDetectorName</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessFEN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fen</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">fen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">updatePieces</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;game update from fen </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fen</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chessPgn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgn</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">setPgn</span><span class="p">(</span><span class="n">pgn</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;game updated from pgn&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># picture has been clicked</span>
    <span class="k">def</span> <span class="nf">chessWebCamClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">hasImage</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;no video available&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">video</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="n">w</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">video</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="n">h</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">py</span><span class="p">,</span> <span class="n">px</span><span class="p">]</span>
            <span class="n">colorInfo</span> <span class="o">=</span> <span class="s2">&quot;r:</span><span class="si">%x</span><span class="s2"> g:</span><span class="si">%x</span><span class="s2"> b:</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
            <span class="n">warp</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;clicked warppoint </span><span class="si">%d</span><span class="s2"> pixel </span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> mouseclick </span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2"> in image </span><span class="si">%d</span><span class="s2"> x </span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">warp</span><span class="o">.</span><span class="n">pointList</span><span class="p">),</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">colorInfo</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">photo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">hasImageSet</span><span class="p">():</span>
                <span class="c1"># make sure the path exists</span>
                <span class="n">Environment</span><span class="o">.</span><span class="n">checkDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;chessboard_</span><span class="si">%s</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">fileTimeStamp</span><span class="p">())</span>
                <span class="n">video</span><span class="o">.</span><span class="n">writeImage</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbGUI</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;still image &lt;a href=&#39;/photo/</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt; taken from input </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;no imageset for photo available&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">videoRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">isRecording</span><span class="p">():</span>
            <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">startVideoRecording</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;chessgame_</span><span class="si">%s</span><span class="s2">.avi&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">fileTimeStamp</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;started recording </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">stopVideoRecording</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;finished recording &quot;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">videoRotate90</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">warp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">warp</span>
            <span class="n">warp</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;rotation: </span><span class="si">%d</span><span class="s2">°&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">warp</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">videoPause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ispaused</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">videoPause</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;video &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;paused&quot;</span> <span class="k">if</span> <span class="n">ispaused</span> <span class="k">else</span> <span class="s2">&quot;running&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">videoFeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="c1"># return the response generated along with the specific media</span>
        <span class="c1"># type (mime type)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genVideo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="p">),</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;multipart/x-mixed-replace; boundary=frame&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># https://html.spec.whatwg.org/multipage/server-sent-events.html</span>
    <span class="c1"># https://stackoverflow.com/a/51969441/1497139</span>
    <span class="k">def</span> <span class="nf">getEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;this could be any function that blocks until data is ready&quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">eventFeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genEventStream</span><span class="p">(),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;text/event-stream&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">genEventStream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># wait for source data to be available, then push it</span>
            <span class="k">yield</span> <span class="s2">&quot;data: </span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEvent</span><span class="p">())</span>

    <span class="c1"># streamed video generator</span>
    <span class="c1"># @TODO fix this non working code</span>
    <span class="c1"># def genVideoStreamed(self, video):</span>
    <span class="c1">#    if self.videoStream is None:</span>
    <span class="c1">#        self.videoStream = VideoStream(self.video, show=True, postProcess=self.video.addTimeStamp)</span>
    <span class="c1">#        self.videoStream.start()</span>
    <span class="c1">#    while True:</span>
    <span class="c1">#        frame = self.videoStream.read()</span>
    <span class="c1">#        if frame is not None:</span>
    <span class="c1">#            flag, encodedImage = self.video.imencode(frame)</span>
    <span class="c1">#            # ensure we got a valid image</span>
    <span class="c1">#            if not flag:</span>
    <span class="c1">#                continue</span>
    <span class="c1">#            # yield the output frame in the byte format</span>
    <span class="c1">#            yield(b&#39;--frame\r\n&#39; b&#39;Content-Type: image/jpeg\r\n\r\n&#39; +</span>
    <span class="c1">#                  bytearray(encodedImage) + b&#39;\r\n&#39;)</span>

    <span class="c1"># video generator</span>
    <span class="k">def</span> <span class="nf">genVideo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">autowarp</span><span class="p">:</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">autoWarp</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">cbImageSet</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">nextImageSet</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cbImageSet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">guiImage</span> <span class="o">=</span> <span class="n">cbImageSet</span><span class="o">.</span><span class="n">cbGUI</span><span class="o">.</span><span class="n">image</span>
            <span class="k">if</span> <span class="n">guiImage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">encodedImage</span><span class="p">)</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">imencode</span><span class="p">(</span><span class="n">guiImage</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;encoding failed&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># yield the output frame in the byte format</span>
                    <span class="k">yield</span> <span class="p">(</span>
                        <span class="sa">b</span><span class="s2">&quot;--frame</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                        <span class="sa">b</span><span class="s2">&quot;Content-Type: image/jpeg</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">encodedImage</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="pcwawc.webapp.WebApp.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>construct me</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/webapp.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;construct me&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">videoStream</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span> <span class="o">=</span> <span class="n">VideoAnalyzer</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">setUpDetector</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoAnalyzer</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">board</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setDebug</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pcwawc.webapp.WebApp.getEvent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEvent</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>this could be any function that blocks until data is ready</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/webapp.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;this could be any function that blocks until data is ready&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.webchesscam" class="doc doc-heading">
            <code>webchesscam</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.webchesscam.WebChessCamArgs" class="doc doc-heading">
            <code>WebChessCamArgs</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pcwawc.args.Args" href="#pcwawc.args.Args">Args</a></code></p>


      <p>This class parses command line arguments and generates a usage.</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/webchesscam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WebChessCamArgs</span><span class="p">(</span><span class="n">Args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class parses command line arguments and generates a usage.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;WebChessCam&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;5003&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;port to run server at&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--host&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;host to allow access for&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="pcwawc.webchesscam.chessUpdate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chessUpdate</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>set game status from the given pgn, fen or move</p>

            <details class="quote">
              <summary>Source code in <code>pcwawc/webchesscam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/chess/update&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">chessUpdate</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;set game status from the given pgn, fen or move&quot;&quot;&quot;</span>
    <span class="n">updateGame</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updateGame&quot;</span><span class="p">)</span>
    <span class="n">updateFEN</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updateFEN&quot;</span><span class="p">)</span>
    <span class="n">updateMove</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updateMove&quot;</span><span class="p">)</span>
    <span class="n">pgn</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pgn&quot;</span><span class="p">)</span>
    <span class="n">fen</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fen&quot;</span><span class="p">)</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">updateFEN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">webApp</span><span class="o">.</span><span class="n">chessFEN</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">updateGame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">webApp</span><span class="o">.</span><span class="n">chessPgn</span><span class="p">(</span><span class="n">pgn</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">updateMove</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">webApp</span><span class="o">.</span><span class="n">chessMove</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">webApp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s2">&quot;expected updateGame,updateFEN or updateMove but no such request found&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="pcwawc.yamlablemixin" class="doc doc-heading">
            <code>yamlablemixin</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pcwawc.yamlablemixin.YamlAbleMixin" class="doc doc-heading">
            <code>YamlAbleMixin</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>allow reading and writing derived objects from a yaml file</p>

              <details class="quote">
                <summary>Source code in <code>pcwawc/yamlablemixin.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">YamlAbleMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;allow reading and writing derived objects from a yaml file&quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># read me from a yaml file</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readYaml</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">yamlFile</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yamlFile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yaml&quot;</span><span class="p">):</span>
            <span class="n">yamlFile</span> <span class="o">=</span> <span class="n">yamlFile</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
        <span class="c1"># is there a yamlFile for the given name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">yamlFile</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">yamlFile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">YamlAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reading </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yamlFile</span><span class="p">))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">YamlAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># write me to my yaml file</span>
    <span class="k">def</span> <span class="nf">writeYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">yamlFile</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yamlFile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yaml&quot;</span><span class="p">):</span>
            <span class="n">yamlFile</span> <span class="o">=</span> <span class="n">yamlFile</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">yamlFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">YamlAbleMixin</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>